<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>DLS 2025 - Player Stats & Team Builder</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #000000 0%, #1a1a1a 25%, #0f1419 50%, #1a1a1a 75%, #000000 100%);
      min-height: 100vh;
      position: relative;
      overflow-x: hidden;
      color: #ffffff;
    }

    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: 
        radial-gradient(circle at 30% 20%, rgba(34, 197, 94, 0.15) 0%, transparent 50%),
        radial-gradient(circle at 70% 80%, rgba(16, 185, 129, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 20% 70%, rgba(5, 150, 105, 0.1) 0%, transparent 50%);
      pointer-events: none;
      z-index: -1;
    }

.hero-section {
  background: linear-gradient(135deg, rgba(0, 0, 0, 0.5), rgba(15, 20, 25, 0.4));
  backdrop-filter: blur(12px);
  border: 1px solid rgba(34, 197, 94, 0.15);
  border-radius: 20px;
  padding: 2rem;
  margin-bottom: 2rem;
  position: relative;
  overflow: hidden;
  text-align: center;
}

.hero-section::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(45deg, rgba(34, 197, 94, 0.05), rgba(16, 185, 129, 0.05));
  animation: pulse 4s ease-in-out infinite;
  z-index: 0;
}

@keyframes pulse {
  0%, 100% { opacity: 0.3; }
  50% { opacity: 0.7; }
}

.hero-title {
  font-size: 2.25rem; /* nhỏ hơn trước */
  font-weight: 800;
  background: linear-gradient(135deg, #22c55e, #10b981, #059669);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  margin-bottom: 0.5rem;
  position: relative;
  z-index: 1;
}

.hero-subtitle {
  font-size: 1rem; /* gọn hơn */
  font-weight: 300;
  color: rgba(255, 255, 255, 0.65);
  position: relative;
  z-index: 1;
}


    .nav-tabs {
      display: flex;
      gap: 1rem;
      margin-bottom: 2rem;
      justify-content: center;
    }

    .nav-tab {
      background: rgba(0, 0, 0, 0.6);
      border: 1px solid rgba(34, 197, 94, 0.2);
      border-radius: 12px;
      padding: 1rem 2rem;
      color: rgba(255, 255, 255, 0.7);
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 600;
      width: 230px;
      text-align: center;
    }

    .nav-tab.active {
      background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
      color: white;
      border-color: #22c55e;
    }

    .nav-tab:hover:not(.active) {
      border-color: rgba(34, 197, 94, 0.5);
      color: rgba(255, 255, 255, 0.9);
    }

    .filters-section {
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(34, 197, 94, 0.2);
      border-radius: 20px;
      padding: 2rem;
      margin-bottom: 2rem;
    }

    .filter-group {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      align-items: center;
    }

    .filter-input, .filter-select {
      background: rgba(0, 0, 0, 0.7);
      border: 1px solid rgba(34, 197, 94, 0.3);
      border-radius: 12px;
      padding: 0.75rem 1rem;
      color: white;
      font-weight: 500;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
    }

    .filter-input:focus, .filter-select:focus {
      outline: none;
      border-color: #22c55e;
      box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.2);
    }

    .filter-input::placeholder {
      color: rgba(255, 255, 255, 0.5);
    }

    .filter-select option {
      background: #1a1a1a;
      color: white;
    }

    .clear-filters, .build-team-btn {
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      color: white;
      border: none;
      border-radius: 12px;
      padding: 0.75rem 1.5rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .build-team-btn {
      background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
    }

    .clear-filters:hover, .build-team-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(239, 68, 68, 0.4);
    }

    .build-team-btn:hover {
      box-shadow: 0 8px 25px rgba(34, 197, 94, 0.4);
    }

    .player-card {
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(34, 197, 94, 0.2);
      border-radius: 20px;
      padding: 1.5rem;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
      display: flex;
      align-items: center;
      gap: 1.5rem;
      min-height: 140px;
    }

    .player-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, rgba(34, 197, 94, 0.1), rgba(16, 185, 129, 0.1));
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .player-card:hover::before {
      opacity: 1;
    }

    .player-card:hover {
      transform: translateY(-4px);
      border-color: rgba(34, 197, 94, 0.5);
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4);
    }

    .player-rank {
      background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
      color: #000;
      font-weight: 900;
      font-size: 1.2rem;
      padding: 0.5rem 1rem;
      border-radius: 15px;
      text-align: center;
      min-width: 60px;
      box-shadow: 0 4px 15px rgba(251, 191, 36, 0.4);
      flex-shrink: 0;
      position: relative;
      z-index: 2;
    }

    .player-rank.top10 {
      background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
      color: white;
      box-shadow: 0 4px 15px rgba(220, 38, 38, 0.4);
    }

    .player-rank.top50 {
      background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%);
      color: white;
      box-shadow: 0 4px 15px rgba(124, 58, 237, 0.4);
    }

    .player-info-section {
      flex: 1;
      min-width: 0;
      position: relative;
      z-index: 1;
    }

    .player-name {
      font-size: 1.5rem;
      font-weight: 700;
      color: white;
      margin-bottom: 0.5rem;
      word-wrap: break-word;
      line-height: 1.3;
    }

    .player-details {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      margin-bottom: 1rem;
    }

    .player-info {
      font-size: 0.875rem;
      color: rgba(255, 255, 255, 0.6);
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }

    .rating-badge {
      background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
      color: white;
      font-weight: 900;
      font-size: 2rem;
      padding: 1rem 1.5rem;
      border-radius: 20px;
      text-align: center;
      min-width: 100px;
      box-shadow: 0 8px 25px rgba(34, 197, 94, 0.3);
      flex-shrink: 0;
      position: relative;
      z-index: 1;
    }

    .rating-legendary {
      background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
      box-shadow: 0 8px 25px rgba(251, 191, 36, 0.4);
    }

    .rating-elite {
      background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
      box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
    }

    .rating-good {
      background: linear-gradient(135deg, #cd7f32 0%, #b8860b 100%);
      box-shadow: 0 8px 25px rgba(205, 127, 50, 0.4);
    }

    .rating-basic {
      background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
      color: #374151;
      box-shadow: 0 8px 25px rgba(156, 163, 175, 0.4);
    }

    .stats-container {
      flex: 2;
      position: relative;
      z-index: 1;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 0.75rem;
    }

    .stat-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.5rem 0.75rem;
      background: rgba(34, 197, 94, 0.1);
      border-radius: 10px;
      border: 1px solid rgba(34, 197, 94, 0.2);
    }

    .stat-name {
      font-weight: 600;
      color: rgba(255, 255, 255, 0.8);
      font-size: 0.8rem;
    }

    .stat-value {
      font-weight: 700;
      font-size: 0.9rem;
    }

    .gk-stats {
      border-color: rgba(59, 130, 246, 0.3);
      background: rgba(59, 130, 246, 0.1);
    }

    /* Team Builder Styles */
    .team-builder-section {
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(34, 197, 94, 0.2);
      border-radius: 20px;
      padding: 2rem;
    }

    .formation-selector {
      display: flex;
      gap: 1rem;
      margin-bottom: 2rem;
      flex-wrap: wrap;
    }

    .formation-btn {
      background: rgba(0, 0, 0, 0.7);
      border: 1px solid rgba(34, 197, 94, 0.3);
      border-radius: 12px;
      padding: 0.75rem 1.5rem;
      color: white;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 600;
    }

    .formation-btn.active {
      background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
      border-color: #22c55e;
    }

    .formation-btn:hover:not(.active) {
      border-color: rgba(34, 197, 94, 0.5);
    }

    .team-criteria {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    .criteria-item {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
      min-height: 80px;
      margin: 10px 0 10px;
    }

    .criteria-label {
      font-weight: 600;
      color: rgba(255, 255, 255, 0.9);
      font-size: 1rem;
      white-space: nowrap;
      overflow: visible;
      line-height: 1.4;
    }

    .team-stats {
      background: rgba(34, 197, 94, 0.1);
      border: 1px solid rgba(34, 197, 94, 0.2);
      border-radius: 16px;
      padding: 1.5rem;
      margin-bottom: 2rem;
    }

    .team-stats h3 {
      color: #22c55e;
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 1rem;
      text-align: center;
    }

    .team-stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 1rem;
    }

    .team-stat {
      text-align: center;
      padding: 0.75rem;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 10px;
    }

    .team-stat-value {
      font-size: 1.5rem;
      font-weight: 700;
      color: #22c55e;
    }

    .team-stat-label {
      font-size: 0.875rem;
      color: rgba(255, 255, 255, 0.7);
      margin-top: 0.25rem;
    }

    /* Formation Display */
    .formation-container {
      background: 
        linear-gradient(135deg, rgba(34, 197, 94, 0.1) 0%, rgba(16, 185, 129, 0.05) 100%),
        linear-gradient(45deg, 
          rgba(34, 197, 94, 0.03) 25%, 
          transparent 25%, 
          transparent 75%, 
          rgba(34, 197, 94, 0.03) 75%);
      background-size: 100% 100%, 40px 40px;
      border: 2px solid rgba(34, 197, 94, 0.3);
      border-radius: 24px;
      padding: 2rem;
      margin: 2rem 0;
      position: relative;
      overflow: hidden;
    }

    .formation-container::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 0;
      right: 0;
      height: 2px;
      background: linear-gradient(90deg, transparent, rgba(34, 197, 94, 0.4), transparent);
      transform: translateY(-50%);
    }

    .formation-container::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 120px;
      height: 120px;
      border: 2px solid rgba(34, 197, 94, 0.3);
      border-radius: 50%;
      transform: translate(-50%, -50%);
    }

    .formation-display {
      display: flex;
      flex-direction: column;
      gap: 2rem;
      align-items: center;
      position: relative;
      z-index: 10;
    }

    .formation-line {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 1.5rem;
      flex-wrap: wrap;
    }

    .formation-line.defense {
      order: 1;
    }

    .formation-line.midfield {
      order: 2;
    }

    .formation-line.attack {
      order: 3;
    }

    .player-position {
      width: 120px;
      height: 120px;
      background: linear-gradient(135deg, rgba(0, 0, 0, 0.7) 0%, rgba(31, 41, 55, 0.8) 100%);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: #EEDC82;
      font-weight: 600;
      font-size: 0.7rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
      backdrop-filter: blur(10px);
      padding: 0.25rem;
      line-height: 1.1;
    }

    .player-position:hover {
      transform: translateY(-4px) scale(1.05);
      border-color: #22c55e;
      box-shadow: 0 10px 30px rgba(34, 197, 94, 0.4);
    }

    .player-position.filled {
  padding: 0;
  background: none;
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
}

.player-grid {
  display: grid;
    grid-template-rows: auto auto;
    height: 100%;
    width: 100%;
    overflow: hidden;
    background-color: #000000aa;
    box-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
}
  
.flag-image {
    height: 90px;
    background-size: cover;
    background-position: center;
}

.player-grid .name {
  font-size: 1rem;
  font-weight: 700;
  text-align: center;
  background-color: #EEDC82;
  color: #000;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;


  /* Center text vertically & horizontally */
  display: flex;
  align-items: center;
  justify-content: center;

  height: 30px;
  padding: 0 4px;
}

    .player-position .position-label {
      font-size:1rem;
      font-weight: 600;
      color: rgba(255, 255, 255, 0.8);
      line-height: 1.1;
    }

    .loading-spinner {
      border: 3px solid rgba(34, 197, 94, 0.3);
      border-top: 3px solid #22c55e;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
      margin: 2rem auto;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .no-results {
      text-align: center;
      padding: 4rem 2rem;
      color: rgba(255, 255, 255, 0.6);
    }

    .no-results-icon {
      font-size: 4rem;
      margin-bottom: 1rem;
    }

    .error-message {
      background: rgba(239, 68, 68, 0.1);
      border: 1px solid rgba(239, 68, 68, 0.3);
      border-radius: 16px;
      padding: 2rem;
      margin: 2rem 0;
      color: #fca5a5;
      text-align: center;
    }

    .fade-in {
      animation: fadeIn 0.6s ease-out forwards;
      opacity: 0;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .hidden {
      display: none !important;
    }

    /* Donate Section Styles */
.donate-container {
  background: rgba(0, 0, 0, 0.6);
  border: 1px solid rgba(34, 197, 94, 0.2);
  border-radius: 20px;
  padding: 2rem;
  text-align: center;
  backdrop-filter: blur(20px);
  margin-bottom: 2rem;
}

.donate-title {
  font-size: 1rem;
  font-weight: 700;
  color: #fffff0;
  margin-bottom: 1.5rem;
}

.qr-wrapper {
  display: flex;
  justify-content: center;
  gap: 2rem;
  flex-wrap: wrap;
}

.qr-box {
  background: rgba(0, 0, 0, 0.7);
  border: 1px solid rgba(34, 197, 94, 0.2);
  border-radius: 16px;
  padding: 1rem;
  text-align: center;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
  transition: transform 0.3s ease;
  justify-items: center;
}

.qr-box img {
  width: 160px;
  height: auto;
  border-radius: 8px;
  margin-bottom: 0.5rem;
}

.qr-box p {
  color: rgba(255, 255, 255, 0.8);
  font-weight: 500;
  font-size: 1rem;
}

.qr-box:hover {
  transform: translateY(-4px);
  border-color: #22c55e;
  box-shadow: 0 8px 30px rgba(34, 197, 94, 0.3);
}

#builtTeam {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background-color: #fff;
  border-radius: 0px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
  z-index: 1000;
  width: 300px;
  text-align: center;
  font-family: Arial, sans-serif;
  display: none;
  background: linear-gradient(180deg, #f5f5dc 0%, #eedc82 100%);
  color: #000;
  overflow: hidden;
}

#builtTeam.show {
  display: block;
}

#builtTeamOverlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.5);
  z-index: 999;
  display: none;
}

#builtTeamOverlay.show {
  display: block;
}

.close-btn {
  position: absolute;
  top: 5px;
  right: 5px;
  background-color: #ff4444;
  color: white;
  border: none;
  border-radius: 50%;
  width: 30px;
  height: 30px;
  font-size: 18px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 10; /* Thêm z-index cao để nút hiển thị trên tất cả */
}

.close-btn:hover {
  background-color: #cc0000 20%;
}

.player-detail-card {
  position: relative;
  width: 100%;
  height: 400px;
  background: no-repeat center;
  background-size: cover;
  overflow: hidden;
}

.flag-background {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-size: auto;
  z-index: 1; /* Z-index thấp cho lá cờ */
}

.player-overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(to bottom, rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.7));
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  padding: 10px;
  z-index: 2; /* Z-index trung bình cho overlay */
}

.overall-rating {
  font-size: 24px;
  font-weight: bold;
  color: #fff;
  background: #ffd700;
  border: 2px solid #000;
  border-radius: 50%;
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  position: absolute;
  top: 10px;
  left: 10px;
  z-index: 3; /* Z-index cho rating */
}

.player-stat-container {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 5px;
  position: absolute;
  bottom: 50px;
  left: 50%;
  transform: translateX(-50%);
  width: 90%;
  z-index: 3; /* Z-index cho stats */
}

.player-stat-item {
  background-color: #000;
  padding: 2px 6px;
  border-radius: 3px;
  font-size: 12px;
  color: #fff;
  display: flex;
  align-items: flex-start;
  width: 55px;
  font-weight: bold
}

.player-stat-value {
  font-weight: bold;
  margin-left: auto;
  align-items: end;
}

.text-center {
    text-align: center;
    margin: 20px;
}

.player-info-name {
  font-size: 1.5rem;
  font-weight: bold;
  background: #eedc82 50%;
  position: absolute;
  bottom: 0;
  left: 0;
  width: 100%;
  text-align: center;
  color: #0f1419		;
  z-index: 3; /* Z-index cho tên */
}

.player-detail-info {
  font-size: 12px;
  color: #fff;
  display: flex;
  align-items: center;
  gap: 5px;
}

.height-foot {
  position: absolute;
  display: grid;
  top: 85px;
  left: 10px;
  z-index: 3; /* Z-index cho thông tin chiều cao */
  width: 40px;
}

.height-foot-column {
  display: grid;
 text-align: center;
  align-items: center;
  justify-content: center;
}

.height-foot-column div {
  display: flex;
  align-items: center;
  gap: 5px;
   width: 40px;
       justify-content: center;

}

.flag-icon {
 width: 40px;
}

.position {
  position: absolute;
  top: 55px;
  width: 40px; /* Ô nhỏ hơn */
  text-align: center;
  align-items: center;
  justify-content: center;
  z-index: 3; /* Z-index cho vị trí */
}

        /* Form Container Styles */
        .player-form-container {
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(34, 197, 94, 0.2);
            border-radius: 20px;
            padding: 2rem;
            margin: 2rem auto;
            max-width: 1000px;
        }

        .player-form-header {
            text-align: center;
            margin-bottom: 2rem;
            position: relative;
        }

        .player-form-header h1 {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, #22c55e, #10b981, #059669);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
        }

        .player-form-header p {
            font-size: 1.1rem;
            font-weight: 300;
            color: rgba(255, 255, 255, 0.65);
        }

        /* Form Grid */
        .player-form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .player-form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .player-form-group label {
            font-weight: 600;
            color: rgba(255, 255, 255, 0.9);
            font-size: 1rem;
        }

        .player-form-input, .player-form-select {
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid rgba(34, 197, 94, 0.3);
            border-radius: 12px;
            padding: 0.75rem 1rem;
            color: white;
            font-weight: 500;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            font-size: 1rem;
            width: 100%;
            outline: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }

        .player-form-input:focus, .player-form-select:focus {
            outline: none;
            border-color: #22c55e;
            box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.2);
            background: rgba(0, 0, 0, 0.8);
        }

        .player-form-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .player-form-input::-webkit-input-placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .player-form-input::-moz-placeholder {
            color: rgba(255, 255, 255, 0.5);
            opacity: 1;
        }

        .player-form-select option {
            background: #1a1a1a;
            color: white;
        }

        /* Stats Section */
        .player-stats-section {
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.2);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .player-stats-section h3 {
            color: #22c55e;
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .player-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
        }

        .player-range-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .player-range-group label {
            font-weight: 600;
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.95rem;
        }

        .player-range-container {
            display: flex;
            align-items: center;
            gap: 1rem;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            padding: 0.75rem;
        }

        .player-range-input {
            flex: 1;
            height: 8px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            outline: none;
            -webkit-appearance: none;
            appearance: none;
        }

        .player-range-input::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: linear-gradient(135deg, #22c55e, #16a34a);
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 2px 8px rgba(34, 197, 94, 0.3);
        }

        .player-range-input::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: linear-gradient(135deg, #22c55e, #16a34a);
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 2px 8px rgba(34, 197, 94, 0.3);
        }

        .player-range-value {
            background: linear-gradient(135deg, #22c55e, #16a34a);
            color: white;
            font-weight: 700;
            font-size: 0.9rem;
            padding: 0.25rem 0.75rem;
            border-radius: 8px;
            min-width: 40px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(34, 197, 94, 0.3);
        }

        /* GK Section */
        .player-gk-section {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.2);
        }

        .player-gk-section h3 {
            color: #3b82f6;
        }

        .player-gk-section .player-range-input::-webkit-slider-thumb {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
        }

        .player-gk-section .player-range-input::-moz-range-thumb {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
        }

        .player-gk-section .player-range-value {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
        }

        /* Submit Button */
        .player-submit-btn {
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            color: white;
            border: none;
            border-radius: 16px;
            padding: 1rem 2rem;
            font-weight: 700;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 1rem;
            box-shadow: 0 8px 25px rgba(34, 197, 94, 0.3);
        }

        .player-submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 35px rgba(34, 197, 94, 0.4);
        }

        .player-submit-btn:active {
            transform: translateY(0);
        }

        /* Hidden class */
        .hidden {
            display: none !important;
        }

        /* Notification Styles */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            animation: slideInRight 0.3s ease-out;
        }
        
        .notification-content {
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(20px);
            border-radius: 12px;
            padding: 1rem 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            min-width: 300px;
        }
        
        .notification-success .notification-content {
            border-color: rgba(34, 197, 94, 0.3);
            background: rgba(0, 0, 0, 0.9);
        }
        
        .notification-error .notification-content {
            border-color: rgba(239, 68, 68, 0.3);
            background: rgba(0, 0, 0, 0.9);
        }
        
        .notification-icon {
            font-size: 1.2rem;
        }
        
        .notification-message {
            color: white;
            font-weight: 500;
            flex: 1;
        }
        
        .notification-close {
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.6);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.2s ease;
        }
        
        .notification-close:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }
        
        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Submit Button Loading State */
        .player-submit-btn:disabled {
            cursor: not-allowed;
            transform: none !important;
        }

        /* Responsive */
        @media (max-width: 1000px) {
            .player-form-container {
                margin: 1rem;
                padding: 1.5rem;
            }

            .player-form-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .player-stats-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .player-form-header h1 {
                font-size: 2rem;
            }
        }

        /* Animation */
        .fade-in {
            animation: fadeIn 0.6s ease-out forwards;
            opacity: 0;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .gk-value {
  font-weight: 600;
  border: 1px solid #3b82f6;
  padding: 2px 6px;
  border-radius: 6px;
  background: #3b82f6;
}


/* Responsive cho mobile (<1000px) */
@media only screen and (max-width: 1000px) {
  body {
    font-size: 14px; /* Giảm font-size cho mobile */
  }

  /* Hero Section */
  .hero-section {
    padding: 1.5rem; /* Giảm padding */
    margin: 1rem; /* Giảm margin */
    border-radius: 16px; /* Bo góc nhỏ hơn */
    background: linear-gradient(135deg, rgba(0, 0, 0, 0.6), rgba(15, 20, 25, 0.5));
    backdrop-filter: blur(8px); /* Giảm blur để tối ưu hiệu suất */
  }

  .hero-title {
    font-size: 1.75rem; /* Giảm kích thước tiêu đề */
    margin-bottom: 0.3rem;
  }

  .hero-subtitle {
    font-size: 0.9rem; /* Font nhỏ hơn */
  }

  /* Navigation Tabs */
  .nav-tabs {
    flex-direction: column; /* Xếp dọc trên mobile */
    gap: 0.5rem;
    margin-bottom: 1rem;
  }

  .nav-tab {
    padding: 0.75rem 1.5rem; /* Giảm padding */
    font-size: 0.9rem;
    border-radius: 10px;
  }

  /* Filters Section */
  .filters-section {
    padding: 1.5rem;
    margin: 1rem;
    border-radius: 16px;
  }

  .filter-group {
    flex-direction: column; /* Xếp dọc các input */
    gap: 0.75rem;
  }

  .filter-input, .filter-select {
    padding: 0.5rem 0.75rem;
    font-size: 0.9rem;
    border-radius: 10px;
  }

  .clear-filters, .build-team-btn {
    padding: 0.5rem 1rem;
    font-size: 0.9rem;
    border-radius: 10px;
  }

  /* Player Card */
  .player-card {
    padding: 1rem;
    margin: 1rem;
    border-radius: 16px;
    flex-direction: column; /* Xếp dọc trên mobile */
    gap: 1rem;
    min-height: 120px;
  }

  .player-rank {
    font-size: 1rem;
    padding: 0.4rem 0.8rem;
    min-width: 50px;
    border-radius: 12px;
  }

  .player-name {
    font-size: 1.25rem;
    margin-bottom: 0.3rem;
  }

  .player-details {
    gap: 0.5rem;
  }

  .player-info {
    font-size: 0.8rem;
  }

  .rating-badge {
    font-size: 1.5rem;
    padding: 0.75rem 1rem;
    min-width: 80px;
    border-radius: 16px;
  }

  .stats-grid {
    grid-template-columns: 1fr; /* Một cột trên mobile */
    gap: 0.5rem;
  }

  .stat-item {
    padding: 0.4rem 0.6rem;
    font-size: 0.75rem;
    width: 70px;
  }

  /* Team Builder Section */
  .team-builder-section {
    padding: 1.5rem;
    margin: 1rem;
    border-radius: 16px;
  }

  .formation-selector {
    flex-direction: column;
    gap: 0.5rem;
  }

  .formation-btn {
    padding: 0.5rem 1rem;
    font-size: 0.9rem;
    border-radius: 10px;
  }

  .team-criteria {
    grid-template-columns: 1fr; /* Một cột */
    gap: 1rem;
  }

  .team-stats-grid {
    grid-template-columns: 1fr;
    gap: 0.75rem;
  }

  .team-stat {
    padding: 0.5rem;
  }

  .team-stat-value {
    font-size: 1.25rem;
  }

  .team-stat-label {
    font-size: 0.8rem;
  }

  /* Formation Display */
  .formation-container {
    padding: 1.5rem;
    margin: 1rem;
    border-radius: 16px;
  }

  .formation-line {
    gap: 1rem;
  }

  .player-position {
    width: 100px;
    height: 100px;
    font-size: 0.6rem;
    border-radius: 12px;
  }

  .player-position.filled {
    padding: 0;
  }

  .flag-image {
    height: 70px; /* Giảm kích thước cờ */
  }

  .player-grid .name {
    font-size: 0.9rem;
    height: 25px;
  }

  /* Donate Section */
  .donate-container {
    padding: 1.5rem;
    margin: 1rem;
    border-radius: 16px;
  }

  .donate-title {
    font-size: 0.9rem;
  }

  .qr-box {
    padding: 0.75rem;
  }

  .qr-box img {
    width: 120px; /* Giảm kích thước QR */
  }

  .qr-box p {
    font-size: 0.9rem;
  }

  /* Built Team Popup */
  #builtTeam {
    width: 90%; /* Full-width trên mobile */
    max-width: 280px;
    padding: 1rem;
  }

  .close-btn {
    width: 25px;
    height: 25px;
    font-size: 16px;
  }

  /* Player Detail Card */
  .player-detail-card {
    height: 350px; /* Giảm chiều cao */
  }

  .overall-rating {
    font-size: 20px;
    width: 35px;
    height: 35px;
  }

  .player-stat-item {
    font-size: 10px;
    width: 50px;
    padding: 2px 4px;
  }

  .player-info-name {
    font-size: 1.25rem;
  }

  .height-foot {
    top: 75px;
    width: 35px;
  }

  .flag-icon {
    width: 35px;
  }

  .position {
    top: 50px;
    width: 35px;
  }

  /* Player Form Container */
  .player-form-container {
    padding: 1.5rem;
    margin: 1rem;
    border-radius: 16px;
  }

  .player-form-header h1 {
    font-size: 2rem;
  }

  .player-form-header p {
    font-size: 1rem;
  }

  .player-form-grid {
    grid-template-columns: 1fr;
    gap: 1rem;
  }

  .player-stats-grid {
    grid-template-columns: 1fr;
    gap: 1rem;
  }

  .player-range-container {
    padding: 0.5rem;
  }

  .player-range-input::-webkit-slider-thumb {
    width: 16px;
    height: 16px;
  }

  .player-range-input::-moz-range-thumb {
    width: 16px;
    height: 16px;
  }

  .player-range-value {
    font-size: 0.8rem;
    padding: 0.2rem 0.6rem;
  }

  .player-submit-btn {
    padding: 0.75rem 1.5rem;
    font-size: 1rem;
    border-radius: 12px;
  }

  /* Notification */
  .notification {
    top: 10px;
    right: 10px;
  }

  .notification-content {
    min-width: 250px;
    padding: 0.75rem 1rem;
  }

  .notification-icon {
    font-size: 1rem;
  }

  .notification-message {
    font-size: 0.9rem;
  }

  .notification-close {
    width: 20px;
    height: 20px;
    font-size: 1.2rem;
  }

  /* Loading Spinner */
  .loading-spinner {
    width: 40px;
    height: 40px;
    margin: 1.5rem auto;
  }

  /* No Results & Error */
  .no-results {
    padding: 2rem 1rem;
  }

  .no-results-icon {
    font-size: 3rem;
  }

  .error-message {
    padding: 1.5rem;
    margin: 1rem;
    border-radius: 12px;
  }
}

/* Responsive cho màn hình rất nhỏ (<600px) */
@media only screen and (max-width: 600px) {
  body {
    font-size: 12px;
  }

  .hero-section, .filters-section, .team-builder-section, .formation-container, .donate-container, .player-form-container {
    padding: 1rem;
    margin: 0.5rem;
    border-radius: 12px;
  }

  .hero-title {
    font-size: 1.5rem;
  }

  .hero-subtitle {
    font-size: 0.8rem;
  }

  .nav-tab, .formation-btn, .filter-input, .filter-select, .clear-filters, .build-team-btn, .player-submit-btn {
    padding: 0.5rem 1rem;
    font-size: 0.8rem;
    border-radius: 8px;
  }

  .player-card {
    padding: 0.75rem;
    min-height: 100px;
  }

  .player-rank {
    font-size: 0.9rem;
    min-width: 40px;
    padding: 0.3rem 0.6rem;
  }

  .player-name {
    font-size: 1rem;
  }

  .rating-badge {
    font-size: 1.25rem;
    padding: 0.5rem 0.75rem;
    min-width: 60px;
  }

  .player-position {
    width: 80px;
    height: 80px;
    font-size: 0.55rem;
  }

  .flag-image {
    height: 50px;
  }

  .player-grid .name {
    font-size: 0.8rem;
    height: 20px;
  }

  .player-detail-card {
    height: 300px;
  }

  .overall-rating {
    font-size: 18px;
    width: 30px;
    height: 30px;
  }

  .player-stat-item {
    font-size: 9px;
    width: 45px;
  }

  .player-info-name {
    font-size: 1rem;
  }

  .height-foot, .position, .flag-icon {
    width: 30px;
  }

  .height-foot {
    top: 65px;
  }

  .position {
    top: 40px;
  }

  .player-form-header h1 {
    font-size: 1.75rem;
  }

  .player-form-header p {
    font-size: 0.9rem;
  }


/* Giữ nguyên các style gốc không bị ghi đè */
.hero-section {
  background: linear-gradient(135deg, rgba(0, 0, 0, 0.5), rgba(15, 20, 25, 0.4));
  backdrop-filter: blur(12px);
  border: 1px solid rgba(34, 197, 94, 0.15);
  border-radius: 20px;
  padding: 2rem;
  margin-bottom: 2rem;
  position: relative;
  overflow: hidden;
  text-align: center;
}

.hero-section::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(45deg, rgba(34, 197, 94, 0.05), rgba(16, 185, 129, 0.05));
  animation: pulse 4s ease-in-out infinite;
  z-index: 0;
}

@keyframes pulse {
  0%, 100% { opacity: 0.3; }
  50% { opacity: 0.7; }
}

.hero-title {
  font-size: 2.25rem;
  font-weight: 800;
  background: linear-gradient(135deg, #22c55e, #10b981, #059669);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  margin-bottom: 0.5rem;
  position: relative;
  z-index: 1;
}

.hero-subtitle {
  font-size: 1rem;
  font-weight: 300;
  color: rgba(255, 255, 255, 0.65);
  position: relative;
  z-index: 1;
}

.nav-tabs {
  display: flex;
  gap: 1rem;
  margin-bottom: 2rem;
  justify-content: center;
  align-items: center;
}

.nav-tab {
  background: rgba(0, 0, 0, 0.6);
  border: 1px solid rgba(34, 197, 94, 0.2);
  border-radius: 12px;
  padding: 1rem 2rem;
  color: rgba(255, 255, 255, 0.7);
  cursor: pointer;
  transition: all 0.3s ease;
  font-weight: 600;
}

.nav-tab.active {
  background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
  color: white;
  border-color: #22c55e;
}

.nav-tab:hover:not(.active) {
  border-color: rgba(34, 197, 94, 0.5);
  color: rgba(255, 255, 255, 0.9);
}

.filters-section {
  background: rgba(0, 0, 0, 0.6);
  backdrop-filter: blur(20px);
  border: 1px solid rgba(34, 197, 94, 0.2);
  border-radius: 20px;
  padding: 2rem;
  margin-bottom: 2rem;
}

.filter-group {
  display: flex;
  flex-wrap: wrap;
  gap: 1rem;
  align-items: center;
}

.filter-input, .filter-select {
  background: rgba(0, 0, 0, 0.7);
  border: 1px solid rgba(34, 197, 94, 0.3);
  border-radius: 12px;
  padding: 0.75rem 1rem;
  color: white;
  font-weight: 500;
  transition: all 0.3s ease;
  backdrop-filter: blur(10px);
}

.filter-input:focus, .filter-select:focus {
  outline: none;
  border-color: #22c55e;
  box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.2);
}

.filter-input::placeholder {
  color: rgba(255, 255, 255, 0.5);
}

.filter-select option {
  background: #1a1a1a;
  color: white;
}

.clear-filters, .build-team-btn {
  background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
  color: white;
  border: none;
  border-radius: 12px;
  padding: 0.75rem 1.5rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
}

.build-team-btn {
  background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
}

.clear-filters:hover, .build-team-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(239, 68, 68, 0.4);
}

.build-team-btn:hover {
  box-shadow: 0 8px 25px rgba(34, 197, 94, 0.4);
}

.player-card {
  background: rgba(0, 0, 0, 0.7);
  backdrop-filter: blur(20px);
  border: 1px solid rgba(34, 197, 94, 0.2);
  border-radius: 20px;
  padding: 1.5rem;
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  display: flex;
  align-items: center;
  gap: 1.5rem;
  min-height: 140px;
}

.player-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(135deg, rgba(34, 197, 94, 0.1), rgba(16, 185, 129, 0.1));
  opacity: 0;
  transition: opacity 0.3s ease;
}

.player-card:hover::before {
  opacity: 1;
}

.player-card:hover {
  transform: translateY(-4px);
  border-color: rgba(34, 197, 94, 0.5);
  box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4);
}

.player-rank {
  background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
  color: #000;
  font-weight: 900;
  font-size: 1.2rem;
  padding: 0.5rem 1rem;
  border-radius: 15px;
  text-align: center;
  min-width: 60px;
  box-shadow: 0 4px 15px rgba(251, 191, 36, 0.4);
  flex-shrink: 0;
  position: relative;
  z-index: 2;
}

.player-rank.top10 {
  background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
  color: white;
  box-shadow: 0 4px 15px rgba(220, 38, 38, 0.4);
}

.player-rank.top50 {
  background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%);
  color: white;
  box-shadow: 0 4px 15px rgba(124, 58, 237, 0.4);
}

.player-info-section {
  flex: 1;
  min-width: 0;
  position: relative;
  z-index: 1;
}

.player-name {
  font-size: 1.5rem;
  font-weight: 700;
  color: white;
  margin-bottom: 0.5rem;
  word-wrap: break-word;
  line-height: 1.3;
}

.player-details {
  display: flex;
  flex-wrap: wrap;
  gap: 1rem;
  margin-bottom: 1rem;
}

.player-info {
  font-size: 0.875rem;
  color: rgba(255, 255, 255, 0.6);
  font-weight: 500;
  display: flex;
  align-items: center;
  gap: 0.25rem;
}

.rating-badge {
  background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
  color: white;
  font-weight: 900;
  font-size: 2rem;
  padding: 1rem 1.5rem;
  border-radius: 20px;
  text-align: center;
  min-width: 100px;
  box-shadow: 0 8px 25px rgba(34, 197, 94, 0.3);
  flex-shrink: 0;
  position: relative;
  z-index: 1;
}

.rating-legendary {
  background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
  box-shadow: 0 8px 25px rgba(251, 191, 36, 0.4);
}

.rating-elite {
  background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
  box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
}

.rating-good {
  background: linear-gradient(135deg, #cd7f32 0%, #b8860b 100%);
  box-shadow: 0 8px 25px rgba(205, 127, 50, 0.4);
}

.rating-basic {
  background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
  color: #374151;
  box-shadow: 0 8px 25px rgba(156, 163, 175, 0.4);
}

.stats-container {
  flex:2;
  position: relative;
  z-index: 1;
}

.stats-grid {
  display: grid;
  grid-template-columns: repeat(4, minmax(140px, 1fr));
  gap: 0.75rem;
}

.stat-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0.5rem 0.75rem;
  background: rgba(34, 197, 94, 0.1);
  border-radius: 10px;
  border: 1px solid rgba(34, 197, 94, 0.2);
}

.stat-name {
  font-weight: 600;
  color: rgba(255, 255, 255, 0.8);
  font-size: 0.6rem;
  justify-self: flex-start;
}

.stat-value {
  font-weight: 700;
  font-size: 0.8rem;
  justify-self: flex-end;

}

.gk-stats {
  border-color: rgba(59, 130, 246, 0.3);
  background: rgba(59, 130, 246, 0.1);
}

.team-builder-section {
  background: rgba(0, 0, 0, 0.7);
  backdrop-filter: blur(20px);
  border: 1px solid rgba(34, 197, 94, 0.2);
  border-radius: 20px;
  padding: 2rem;
}

.formation-selector {
  display: flex;
  gap: 1rem;
  margin-bottom: 2rem;
  flex-wrap: wrap;
}

.formation-btn {
  background: rgba(0, 0, 0, 0.7);
  border: 1px solid rgba(34, 197, 94, 0.3);
  border-radius: 12px;
  padding: 0.75rem 1.5rem;
  color: white;
  cursor: pointer;
  transition: all 0.3s ease;
  font-weight: 600;
}

.formation-btn.active {
  background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
  border-color: #22c55e;
}

.formation-btn:hover:not(.active) {
  border-color: rgba(34, 197, 94, 0.5);
}

.team-criteria {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 1.5rem;
  margin-bottom: 2rem;
}

.criteria-item {
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
  min-height: 80px;
  margin: 10px 0 10px;
}

.criteria-label {
  font-weight: 600;
  color: rgba(255, 255, 255, 0.9);
  font-size: 1rem;
  white-space: nowrap;
  overflow: visible;
  line-height: 1.4;
}

.team-stats {
  background: rgba(34, 197, 94, 0.1);
  border: 1px solid rgba(34, 197, 94, 0.2);
  border-radius: 16px;
  padding: 1.5rem;
  margin-bottom: 2rem;
}

.team-stats h3 {
  color: #22c55e;
  font-size: 1.5rem;
  font-weight: 700;
  margin-bottom: 1rem;
  text-align: center;
}

.team-stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  gap: 1rem;
}

.team-stat {
  text-align: center;
  padding: 0.75rem;
  background: rgba(0, 0, 0, 0.3);
  border-radius: 10px;
}

.team-stat-value {
  font-size: 1.5rem;
  font-weight: 700;
  color: #22c55e;
}

.team-stat-label {
  font-size: 0.875rem;
  color: rgba(255, 255, 255, 0.7);
  margin-top: 0.25rem;
}

.formation-container {
  background: 
    linear-gradient(135deg, rgba(34, 197, 94, 0.1) 0%, rgba(16, 185, 129, 0.05) 100%),
    linear-gradient(45deg, 
      rgba(34, 197, 94, 0.03) 25%, 
      transparent 25%, 
      transparent 75%, 
      rgba(34, 197, 94, 0.03) 75%);
  background-size: 100% 100%, 40px 40px;
  border: 2px solid rgba(34, 197, 94, 0.3);
  border-radius: 24px;
  padding: 2rem;
  margin: 2rem 0;
  position: relative;
  overflow: hidden;
}

.formation-container::before {
  content: '';
  position: absolute;
  top: 50%;
  left: 0;
  right: 0;
  height: 2px;
  background: linear-gradient(90deg, transparent, rgba(34, 197, 94, 0.4), transparent);
  transform: translateY(-50%);
}

.formation-container::after {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: 120px;
  height: 120px;
  border: 2px solid rgba(34, 197, 94, 0.3);
  border-radius: 50%;
  transform: translate(-50%, -50%);
}

.formation-display {
  display: flex;
  flex-direction: column;
  gap: 2rem;
  align-items: center;
  position: relative;
  z-index: 10;
}

.formation-line {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 1.5rem;
  flex-wrap: wrap;
}

.formation-line.defense {
  order: 1;
}

.formation-line.midfield {
  order: 2;
}

.formation-line.attack {
  order: 3;
}

.player-position {
  width: 120px;
  height: 120px;
  background: linear-gradient(135deg, rgba(0, 0, 0, 0.7) 0%, rgba(31, 41, 55, 0.8) 100%);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  color: #EEDC82;
  font-weight: 600;
  font-size: 0.7rem;
  text-align: center;
  cursor: pointer;
  transition: all 0.3s ease;
  position: relative;
  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
  backdrop-filter: blur(10px);
  padding: 0.25rem;
  line-height: 1.1;
}

.player-position:hover {
  transform: translateY(-4px) scale(1.05);
  border-color: #22c55e;
  box-shadow: 0 10px 30px rgba(34, 197, 94, 0.4);
}

.player-position.filled {
  padding: 0;
  background: none;
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
}

.player-grid {
  display: grid;
  grid-template-rows: auto auto;
  height: 100%;
  width: 100%;
  overflow: hidden;
  background-color: #000000aa;
  box-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
}

.flag-image {
  height: 90px;
  background-size: cover;
  background-position: center;
}

.player-grid .name {
  font-size: 1rem;
  font-weight: 700;
  text-align: center;
  background-color: #EEDC82;
  color: #000;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  display: flex;
  align-items: center;
  justify-content: center;
  height: 30px;
  padding: 0 4px;
}

.player-position .position-label {
  font-size: 1rem;
  font-weight: 600;
  color: rgba(255, 255, 255, 0.8);
  line-height: 1.1;
}

.loading-spinner {
  border: 3px solid rgba(34, 197, 94, 0.3);
  border-top: 3px solid #22c55e;
  border-radius: 50%;
  width: 50px;
  height: 50px;
  animation: spin 1s linear infinite;
  margin: 2rem auto;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.no-results {
  text-align: center;
  padding: 4rem 2rem;
  color: rgba(255, 255, 255, 0.6);
}

.no-results-icon {
  font-size: 4rem;
  margin-bottom: 1rem;
}

.error-message {
  background: rgba(239, 68, 68, 0.1);
  border: 1px solid rgba(239, 68, 68, 0.3);
  border-radius: 16px;
  padding: 2rem;
  margin: 2rem 0;
  color: #fca5a5;
  text-align: center;
}

.fade-in {
  animation: fadeIn 0.6s ease-out forwards;
  opacity: 0;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(30px); }
  to { opacity: 1; transform: translateY(0); }
}

.hidden {
  display: none !important;
}

.donate-container {
  background: rgba(0, 0, 0, 0.6);
  border: 1px solid rgba(34, 197, 94, 0.2);
  border-radius: 20px;
  padding: 2rem;
  text-align: center;
  backdrop-filter: blur(20px);
  margin-bottom: 2rem;
}

.donate-title {
  font-size: 1rem;
  font-weight: 700;
  color: #fffff0;
  margin-bottom: 1.5rem;
}

.qr-wrapper {
  display: flex;
  justify-content: center;
  gap: 2rem;
  flex-wrap: wrap;
}

.qr-box {
  background: rgba(0, 0, 0, 0.7);
  border: 1px solid rgba(34, 197, 94, 0.2);
  border-radius: 16px;
  padding: 1rem;
  text-align: center;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
  transition: transform 0.3s ease;
  justify-items: center;
}

.qr-box img {
  width: 160px;
  height: auto;
  border-radius: 8px;
  margin-bottom: 0.5rem;
}

.qr-box p {
  color: rgba(255, 255, 255, 0.8);
  font-weight: 500;
  font-size: 1rem;
}

.qr-box:hover {
  transform: translateY(-4px);
  border-color: #22c55e;
  box-shadow: 0 8px 30px rgba(34, 197, 94, 0.3);
}

#builtTeam {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: linear-gradient(180deg, #f5f5dc 0%, #eedc82 100%);
  border-radius: 0px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
  z-index: 1000;
  width: 300px;
  text-align: center;
  font-family: Arial, sans-serif;
  display: none;
  color: #000;
  overflow: hidden;
}

#builtTeam.show {
  display: block;
}

#builtTeamOverlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.5);
  z-index: 999;
  display: none;
}

#builtTeamOverlay.show {
  display: block;
}

.close-btn {
  position: absolute;
  top: 5px;
  right: 5px;
  background-color: #ff4444;
  color: white;
  border: none;
  border-radius: 50%;
  width: 30px;
  height: 30px;
  font-size: 18px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 10;
}

.close-btn:hover {
  background-color: #cc0000;
}

.player-detail-card {
  position: relative;
  width: 100%;
  height: 400px;
  background: no-repeat center;
  background-size: cover;
  overflow: hidden;
}

.flag-background {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-size: auto;
  z-index: 1;
}

.player-overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(to bottom, rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.7));
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  padding: 10px;
  z-index: 2;
}

.overall-rating {
  font-size: 24px;
  font-weight: bold;
  color: #fff;
  background: #ffd700;
  border: 2px solid #000;
  border-radius: 50%;
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  position: absolute;
  top: 10px;
  left: 10px;
  z-index: 3;
}

.player-stat-container {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 5px;
  position: absolute;
  bottom: 50px;
  left: 50%;
  transform: translateX(-50%);
  width: 90%;
  z-index: 3;
}

.player-stat-item {
  background-color: #000;
  padding: 2px 6px;
  border-radius: 3px;
  font-size: 12px;
  color: #fff;
  display: flex;
  align-items: flex-start;
  width: 55px;
  font-weight: bold;
}

.player-stat-value {
  font-weight: bold;
  margin-left: auto;
  align-items: end;
}

.text-center {
  text-align: center;
  margin: 20px;
}

.player-info-name {
  font-size: 1.5rem;
  font-weight: bold;
  background: #eedc82;
  position: absolute;
  bottom: 0;
  left: 0;
  width: 100%;
  text-align: center;
  color: #0f1419;
  z-index: 3;
}

.player-detail-info {
  font-size: 12px;
  color: #fff;
  display: flex;
  align-items: center;
  gap: 5px;
}

.height-foot {
  position: absolute;
  display: grid;
  top: 85px;
  left: 10px;
  z-index: 3;
  width: 40px;
}

.height-foot-column {
  display: grid;
  text-align: center;
  align-items: center;
  justify-content: center;
}

.height-foot-column div {
  display: flex;
  align-items: center;
  gap: 5px;
  width: 40px;
  justify-content: center;
}

.flag-icon {
  width: 40px;
}

.position {
  position: absolute;
  top: 55px;
  width: 40px;
  text-align: center;
  align-items: center;
  justify-content: center;
  z-index: 3;
}

.player-form-container {
  background: rgba(0, 0, 0, 0.7);
  backdrop-filter: blur(20px);
  border: 1px solid rgba(34, 197, 94, 0.2);
  border-radius: 20px;
  padding: 2rem;
  margin: 2rem auto;
  max-width: 1000px;
}

.player-form-header {
  text-align: center;
  margin-bottom: 2rem;
  position: relative;
}

.player-form-header h1 {
  font-size: 2.5rem;
  font-weight: 800;
  background: linear-gradient(135deg, #22c55e, #10b981, #059669);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  margin-bottom: 0.5rem;
}

.player-form-header p {
  font-size: 1.1rem;
  font-weight: 300;
  color: rgba(255, 255, 255, 0.65);
}

.player-form-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 1.5rem;
  margin-bottom: 2rem;
}

.player-form-group {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.player-form-group label {
  font-weight: 600;
  color: rgba(255, 255, 255, 0.9);
  font-size: 1rem;
}

.player-form-input, .player-form-select {
  background: rgba(0, 0, 0, 0.7);
  border: 1px solid rgba(34, 197, 94, 0.3);
  border-radius: 12px;
  padding: 0.75rem 1rem;
  color: white;
  font-weight: 500;
  transition: all 0.3s ease;
  backdrop-filter: blur(10px);
  font-size: 1rem;
  width: 100%;
  outline: none;
  -webkit-appearance: none;
  -moz-appearance: none;
  appearance: none;
}

.player-form-input:focus, .player-form-select:focus {
  outline: none;
  border-color: #22c55e;
  box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.2);
  background: rgba(0, 0, 0, 0.8);
}

.player-form-input::placeholder {
  color: rgba(255, 255, 255, 0.5);
}

.player-form-input::-webkit-input-placeholder {
  color: rgba(255, 255, 255, 0.5);
}

.player-form-input::-moz-placeholder {
  color: rgba(255, 255, 255, 0.5);
  opacity: 1;
}

.player-form-select option {
  background: #1a1a1a;
  color: white;
}

.player-stats-section {
  background: rgba(34, 197, 94, 0.1);
  border: 1px solid rgba(34, 197, 94, 0.2);
  border-radius: 16px;
  padding: 2rem;
  margin-bottom: 2rem;
}

.player-stats-section h3 {
  color: #22c55e;
  font-size: 1.5rem;
  font-weight: 700;
  margin-bottom: 1.5rem;
  text-align: center;
}

.player-stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 1.5rem;
}

.player-range-group {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.player-range-group label {
  font-weight: 600;
  color: rgba(255, 255, 255, 0.9);
  font-size: 0.95rem;
}

.player-range-container {
  display: flex;
  align-items: center;
  gap: 1rem;
  background: rgba(0, 0, 0, 0.3);
  border-radius: 12px;
  padding: 0.75rem;
}

.player-range-input {
  flex: 1;
  height: 8px;
  background: rgba(255, 255, 255, 0.2);
  border-radius: 6px;
  outline: none;
  -webkit-appearance: none;
  appearance: none;
}

.player-range-input::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 20px;
  height: 20px;
  background: linear-gradient(135deg, #22c55e, #16a34a);
  border-radius: 50%;
  cursor: pointer;
  border: 2px solid white;
  box-shadow: 0 2px 8px rgba(34, 197, 94, 0.3);
}

.player-range-input::-moz-range-thumb {
  width: 20px;
  height: 20px;
  background: linear-gradient(135deg, #22c55e, #16a34a);
  border-radius: 50%;
  cursor: pointer;
  border: 2px solid white;
  box-shadow: 0 2px 8px rgba(34, 197, 94, 0.3);
}

.player-range-value {
  background: linear-gradient(135deg, #22c55e, #16a34a);
  color: white;
  font-weight: 700;
  font-size: 0.9rem;
  padding: 0.25rem 0.75rem;
  border-radius: 8px;
  min-width: 40px;
  text-align: center;
  box-shadow: 0 2px 8px rgba(34, 197, 94, 0.3);
}

.player-gk-section {
  background: rgba(59, 130, 246, 0.1);
  border: 1px solid rgba(59, 130, 246, 0.2);
}

.player-gk-section h3 {
  color: #3b82f6;
}

.player-gk-section .player-range-input::-webkit-slider-thumb {
  background: linear-gradient(135deg, #3b82f6, #2563eb);
  box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
}

.player-gk-section .player-range-input::-moz-range-thumb {
  background: linear-gradient(135deg, #3b82f6, #2563eb);
  box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
}

.player-gk-section .player-range-value {
  background: linear-gradient(135deg, #3b82f6, #2563eb);
  box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
}

.player-submit-btn {
  background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
  color: white;
  border: none;
  border-radius: 16px;
  padding: 1rem 2rem;
  font-weight: 700;
  font-size: 1.1rem;
  cursor: pointer;
  transition: all 0.3s ease;
  width: 100%;
  margin-top: 1rem;
  box-shadow: 0 8px 25px rgba(34, 197, 94, 0.3);
}

.player-submit-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 12px 35px rgba(34, 197, 94, 0.4);
}

.player-submit-btn:active {
  transform: translateY(0);
}

.player-submit-btn:disabled {
  cursor: not-allowed;
  transform: none !important;
}

.notification {
  position: fixed;
  top: 20px;
  right: 20px;
  z-index: 10000;
  animation: slideInRight 0.3s ease-out;
}

.notification-content {
  background: rgba(0, 0, 0, 0.9);
  backdrop-filter: blur(20px);
  border-radius: 12px;
  padding: 1rem 1.5rem;
  display: flex;
  align-items: center;
  gap: 0.75rem;
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
  border: 1px solid rgba(255, 255, 255, 0.1);
  min-width: 300px;
}

.notification-success .notification-content {
  border-color: rgba(34, 197, 94, 0.3);
  background: rgba(0, 0, 0, 0.9);
}

.notification-error .notification-content {
  border-color: rgba(239, 68, 68, 0.3);
  background: rgba(0, 0, 0, 0.9);
}

.notification-icon {
  font-size: 1.2rem;
}

.notification-message {
  color: white;
  font-weight: 500;
  flex: 1;
}

.notification-close {
  background: none;
  border: none;
  color: rgba(255, 255, 255, 0.6);
  font-size: 1.5rem;
  cursor: pointer;
  padding: 0;
  width: 24px;
  height: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
  transition: all 0.2s ease;
}

.notification-close:hover {
  background: rgba(255, 255, 255, 0.1);
  color: white;
}

@keyframes slideInRight {
  from {
    transform: translateX(100%);
    opacity: 0;
  }
  to {
    transform: translateX(0);
    opacity: 1;
  }
  }
}

  </style>
</head>
<body>
<div class="container mx-auto px-4 py-8 max-w-7xl">
  <!-- Hero Section -->
  <div class="hero-section">
    <h1 class="hero-title">DLS 2025</h1> 
    <p class="hero-subtitle">Players Data & Build Formation</p> 
  </div>



    <!-- Navigation Tabs -->
<div class="nav-tabs">
  <div class="nav-tab active" onclick="switchTab('players', this)">
    🔍 Players Database
  </div>
  <div class="nav-tab" onclick="switchTab('team-builder', this)">
    ⚽ Team Builder
  </div>
  <div class="nav-tab" onclick="switchTab('donate', this)">
    💖 Input Form
  </div>
</div>

    <!-- Players Tab -->
    <div id="playersTab">
      <!-- Filters Section -->
      <div class="filters-section">
        <div class="filter-group">
          <input 
            type="text" 
            id="searchInput" 
            placeholder="🔍 Search players..." 
            class="filter-input flex-1 min-w-64"
          />
          
          <input 
            type="text"
            id="countryFilter"
            placeholder="🌍 Filter by Country..."
            class="filter-input"
          />

          <input 
  type="text"
  id="clubFilter"
  placeholder="🏟️ Filter by Club..."
  class="filter-input"
/>


          <select id="positionFilter" class="filter-select">
            <option value="">⚽ All Positions</option>
            <option value="GK">GK - Goalkeeper</option>
            <option value="CB">CB - Center Back</option>
            <option value="LB">LB - Left Back</option>
            <option value="RB">RB - Right Back</option>
            <option value="LWB">LWB - Left Wing Back</option>
            <option value="RWB">RWB - Right Wing Back</option>
            <option value="DM">DM - Defensive Midfielder</option>
            <option value="CM">CM - Central Midfielder</option>
            <option value="AM">AM - Attacking Midfielder</option>
            <option value="LM">LM - Left Midfielder</option>
            <option value="RM">RM - Right Midfielder</option>
            <option value="LW">LW - Left Winger</option>
            <option value="RW">RW - Right Winger</option>
            <option value="CF">CF - Center Forward</option>
            <option value="SS">SS - Second Striker</option>
          </select>

          <select id="priceFilter" class="filter-select">
            <option value="">💰 All Prices</option>
            <option value="0-100">Under 100</option>
            <option value="100-500">100 - 500</option>
            <option value="500-1000">500 - 1000</option>
            <option value="1000-1500">1000 - 1500</option>
            <option value="1500-2000">1500 - 2000</option>
            <option value="2000-2500">2000 - 2500</option>
            <option value="2500+">Over 2500</option>
          </select>

          <select id="sortFilter" class="filter-select">
            <option value="rating-high">🔄 Rating (High to Low)</option>
            <option value="rating-low">Rating (Low to High)</option>
            <option value="price-high">Price (High to Low)</option>
            <option value="price-low">Price (Low to High)</option>
            <option value="name">Name (A-Z)</option>
          </select>
          
          <button id="clearFilters" class="clear-filters">
            Clear Filters
          </button>
        </div>
      </div>

      <!-- Players Grid -->
      <div id="playersGrid" class="flex flex-col gap-4 hidden"></div>
    </div>

    <!-- Team Builder Tab -->
    <div id="teamBuilderTab" class="hidden">
      <div class="team-builder-section">
        <h2 class="text-3xl font-bold text-center mb-6 text-white">🏆 Build Your Ultimate Team</h2>
        
        <!-- Formation Selector -->
        <div class="formation-selector">
          <button class="formation-btn active" onclick="selectFormation('4-3-3')">4-3-3</button>
          <button class="formation-btn" onclick="selectFormation('4-4-2')">4-4-2</button>
          <button class="formation-btn" onclick="selectFormation('4-5-1')">4-5-1</button>
          <button class="formation-btn" onclick="selectFormation('5-3-2')">5-3-2</button>
          <button class="formation-btn" onclick="selectFormation('5-2-3')">5-2-3</button>
          <button class="formation-btn" onclick="selectFormation('5-4-1')">5-4-1</button>
          <button class="formation-btn" onclick="selectFormation('3-5-2')">3-5-2</button>
          <button class="formation-btn" onclick="selectFormation('3-4-3')">3-4-3</button>
        </div>

        <!-- Formation Variants -->
        <div id="formationVariants" class="formation-selector" style="margin-top: 1rem; border-top: 1px solid rgba(34, 197, 94, 0.2); padding-top: 1rem;">
          <!-- Variants will be populated by JavaScript -->
        </div>

        <!-- Team Building Criteria -->

  <div class="criteria-item">
    <label class="criteria-label">🎯 Priority</label>
<select id="buildPriority" class="filter-select">
<option value="most-expensive-sub">Most Expensive (with substitutions)</option>
<option value="cheapest-sub">Cheapest (with substitutions)</option>
<option value="most-expensive-exact">Most Expensive (exact position)</option>
<option value="cheapest-exact">Cheapest (exact position)</option>
<option value="tallest">Tallest Height</option>
<option value="shortest">Shortest Height</option>
<option value="right-foot">Right Footed</option>
<option value="left-foot">Left Footed</option>
<option value="both-feet">Both-Footed</option>
</select>
  </div>

          <div class="criteria-item">
            <label class="criteria-label">🌍 Country Preference</label>
            <select id="teamCountryFilter" class="filter-select">
              <option value="">Any Country</option>
            </select>
          </div>
          
          <div class="criteria-item">
            <label class="criteria-label">🏟️ Club Preference</label>
            <select id="teamClubFilter" class="filter-select">
              <option value="">Any Club</option>
            </select>
          </div>
          
          <div class="criteria-item">
            <label class="criteria-label">🌐 Continent Preference</label>
            <select id="teamContinentFilter" class="filter-select">
              <option value="">Any Continent</option>
              <option value="Africa">Africa</option>
              <option value="Asia">Asia</option>
              <option value="Europe">Europe</option>
              <option value="North America">North America</option>
              <option value="South America">South America</option>
              <option value="Oceania">Oceania</option>
            </select>
          </div>
        </div>

        <div class="text-center">
          <button id="buildTeamBtn" class="build-team-btn text-lg px-6 py-3">
            🚀 Build Team
          </button>
        </div>
      </div>

      <!-- Team Stats -->
      <div id="teamStats" class="team-stats hidden">
        <h3>📊 Team Statistics</h3>
        <div class="team-stats-grid">
          <div class="team-stat">
            <div class="team-stat-value" id="teamRating">0</div>
            <div class="team-stat-label">Average Rating</div>
          </div>
          <div class="team-stat">
            <div class="team-stat-value" id="teamCost">0</div>
            <div class="team-stat-label">Total Coins</div>
          </div>
          <div class="team-stat">
            <div class="team-stat-value" id="teamCountries">0</div>
            <div class="team-stat-label">Countries</div>
          </div>
          <div class="team-stat">
            <div class="team-stat-value" id="teamClubs">0</div>
            <div class="team-stat-label">Clubs</div>
          </div>
        </div>
      </div>

      <!-- Formation Display -->
      <div id="formationDisplay" class="formation-container hidden">
        <h3 class="text-2xl font-bold text-center mb-4 text-white">
          🏆 Your <span id="currentFormationTitle">4-3-3</span> Team
        </h3>
        <div class="formation-display" id="formationField">
          <!-- Formation will be populated by JavaScript -->
        </div>
      </div>

      <!-- Built Team Display -->
       <div id="builtTeamOverlay" class="hidden"></div>
      <div id="builtTeam" class="flex flex-col gap-4 hidden"></div>
    </div>

    <!-- Loading State -->
    <div id="loading" class="text-center">
      <div class="loading-spinner"></div>
      <p class="text-gray-400 mt-4 text-lg">Loading player data...</p>
    </div>

    <!-- Error State -->
    <div id="error" class="error-message hidden">
      <h3 class="font-bold text-xl mb-3">❌ Data Loading Error</h3>
    </div>

    <!-- No Results -->
    <div id="noResults" class="no-results hidden">
      <div class="no-results-icon">🔍</div>
      <h3 class="text-2xl font-bold mb-3">No Players Found</h3>
      <p class="text-lg">Try adjusting your filters or search terms</p>
    </div>

    <div id="donateTab" class="hidden">
      <div class="donate-container">
        <h2 class="donate-title">Love the updates?
        <br>Drop a donation if you wanna support me — helps me keep this going and take care of my fam.
        <br>Appreciate you, bros!</h2>
        <div class="qr-wrapper">
          <div class="qr-box">
            <img src="momo-qr.jpg" alt="QR MoMo" />
            <p>MoMo</p>
          </div>
          <div class="qr-box">
            <img src="bank-qr.jpg" alt="QR Banking" />
            <p>Visa Banking</p>
          </div>
        </div>
      </div>
      <div class="player-form-container fade-in">
          <div class="player-form-header">
              <h1>⚽ Data contribution form</h1>
              <p>Enter complete information to create player profile</p>
          </div>

          <form id="playerForm">
              <div class="player-form-grid">
                  <div class="player-form-group">
                      <label for="name">Player Name</label>
                      <input type="text" id="name" name="name" class="player-form-input" required>
                  </div>

                  <div class="player-form-group">
                      <label for="price">Price</label>
                      <input type="number" id="price" name="price" class="player-form-input" min="0">
                  </div>

                  <div class="player-form-group">
                      <label for="nationality">Nationality</label>
                      <input type="text" id="nationality" name="nationality" class="player-form-input">
                  </div>

                  <div class="player-form-group">
                      <label for="club">Club</label>
                      <input type="text" id="club" name="club" class="player-form-input">
                  </div>

                  <div class="player-form-group">
                      <label for="position">Position</label>
                      <select id="position" name="position" class="player-form-select" required>
                          <option value="">Select Position</option>
                          <option value="GK">Goalkeeper (GK)</option>
                          <option value="CB">Center Back (CB)</option>
                          <option value="LB">Left Back (LB)</option>
                          <option value="RB">Right Back (RB)</option>
                          <option value="DM">Defensive Midfielder (DM)</option>
                          <option value="CM">Central Midfielder (CM)</option>
                          <option value="AM">Attacking Midfielder (AM)</option>
                          <option value="LM">Left Midfielder (LM)</option>
                          <option value="RM">Right Midfielder (RM)</option>
                          <option value="LW">Left Winger (LW)</option>
                          <option value="RW">Right Winger (RW)</option>
                          <option value="SS">Second Striker (SS)</option>
                          <option value="CF">Center Forward (CF)</option>
                      </select>
                  </div>

                  <div class="player-form-group">
                      <label for="foot">Preferred Foot</label>
                      <select id="foot" name="foot" class="player-form-select">
                          <option value="">Select Foot</option>
                          <option value="Left">Left Foot</option>
                          <option value="Right">Right Foot</option>
                          <option value="Both">Both Feet</option>
                      </select>
                  </div>

                  <div class="player-form-group">
                      <label for="height">Height (cm)</label>
                      <input type="number" id="height" name="height" class="player-form-input" min="150" max="220">
                  </div>

                  <div class="player-form-group">
                      <label for="rating">Overall Rating</label>
                      <input type="number" id="rating" name="rating" class="player-form-input" min="1" max="100">
                  </div>
              </div>

              <div class="player-stats-section">
                  <h3>⚡ Technical Attributes</h3>
                  <div class="player-stats-grid">
                      <div class="player-range-group">
                          <label for="speed">Speed</label>
                          <div class="player-range-container">
                              <input type="range" id="speed" name="speed" class="player-range-input" min="1" max="100" value="50">
                              <div class="player-range-value" id="speedValue">50</div>
                          </div>
                      </div>

                      <div class="player-range-group">
                          <label for="acceleration">Acceleration</label>
                          <div class="player-range-container">
                              <input type="range" id="acceleration" name="acceleration" class="player-range-input" min="1" max="100" value="50">
                              <div class="player-range-value" id="accelerationValue">50</div>
                          </div>
                      </div>

<div class="player-range-group">
  <label id="attrLabel1" for="attrInput1">Stamina</label>
  <div class="player-range-container">
    <input type="range" id="attrInput1" name="stamina" class="player-range-input" min="1" max="100" value="50">
    <div class="player-range-value" id="attrValue1">50</div>
  </div>
</div>

                      <div class="player-range-group">
                          <label for="strength">Strength</label>
                          <div class="player-range-container">
                              <input type="range" id="strength" name="strength" class="player-range-input" min="1" max="100" value="50">
                              <div class="player-range-value" id="strengthValue">50</div>
                          </div>
                      </div>

                      <div class="player-range-group">
                          <label for="control">Ball Control</label>
                          <div class="player-range-container">
                              <input type="range" id="control" name="control" class="player-range-input" min="1" max="100" value="50">
                              <div class="player-range-value" id="controlValue">50</div>
                          </div>
                      </div>

                      <div class="player-range-group">
                          <label for="passing">Passing</label>
                          <div class="player-range-container">
                              <input type="range" id="passing" name="passing" class="player-range-input" min="1" max="100" value="50">
                              <div class="player-range-value" id="passingValue">50</div>
                          </div>
                      </div>

<div class="player-range-group">
  <label id="attrLabel2" for="attrInput2">Shooting</label>
  <div class="player-range-container">
    <input type="range" id="attrInput2" name="shooting" class="player-range-input" min="1" max="100" value="50">
    <div class="player-range-value" id="attrValue2">50</div>
  </div>
</div>
                      <div class="player-range-group">
                          <label for="tackling">Tackling</label>
                          <div class="player-range-container">
                              <input type="range" id="tackling" name="tackling" class="player-range-input" min="1" max="100" value="50">
                              <div class="player-range-value" id="tacklingValue">50</div>
                          </div>
                      </div>
                  </div>
              </div>

              <button type="submit" class="player-submit-btn">
                  Create Player Profile
              </button>
          </form>
      </div>
  </div>
</div>
  </div>

  <script>
    const sheetId = "11AlXgZFlKkASFkvcgp1cxcu72aL7nfR74BjNes--gNw";
    const apiKey = "AIzaSyCI6bXgK-_l0bU1F0bJaYH-idxAuNQW1YM";
    const range = "players!A1:Z1000";
    const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${range}?key=${apiKey}`;
    // Đầu file JavaScript (ví dụ: player_popup_normalized.js)
const script = document.createElement('script');
script.src = 'https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js';
document.head.appendChild(script);

// Đảm bảo Chart.js được tải trước khi gọi hàm vẽ biểu đồ
script.onload = () => {
  // Các hàm khác như createPlayerCard, showPlayerPopup, v.v.
};
  
    let allPlayers = [];
    let filteredPlayers = [];
    let currentTab = 'players';
    let currentFormation = '4-3-3';
    let builtTeam = [];
  
    const statLabels = {
  SPE: "Speed",
  ACC: "Acceleration",
  GKR: "Reactions (GK)",
  STR: "Strength",
  CON: "Control",
  PAS: "Passing",
  GKH: "Handling (GK)",
  TAC: "Tackling",
  STA: "Stamina",
  SHO: "Shooting"
};

// Định nghĩa countryMap (nên đặt ngoài hàm hoặc trong file script chung)
const countryMap = {
  'afghanistan': 'https://flagcdn.com/w40/af.png',
  'albania': 'https://flagcdn.com/w40/al.png',
  'algeria': 'https://flagcdn.com/w40/dz.png',
  'andorra': 'https://flagcdn.com/w40/ad.png',
  'angola': 'https://flagcdn.com/w40/ao.png',
  'anguilla': 'https://flagcdn.com/w40/ai.png',
  'antigua and barbuda': 'https://flagcdn.com/w40/ag.png',
  'argentina': 'https://flagcdn.com/w40/ar.png',
  'armenia': 'https://flagcdn.com/w40/am.png',
  'aruba': 'https://flagcdn.com/w40/aw.png',
  'australia': 'https://flagcdn.com/w40/au.png',
  'austria': 'https://flagcdn.com/w40/at.png',
  'azerbaijan': 'https://flagcdn.com/w40/az.png',
  'bahamas': 'https://flagcdn.com/w40/bs.png',
  'bahrain': 'https://flagcdn.com/w40/bh.png',
  'bangladesh': 'https://flagcdn.com/w40/bd.png',
  'barbados': 'https://flagcdn.com/w40/bb.png',
  'belarus': 'https://flagcdn.com/w40/by.png',
  'belgium': 'https://flagcdn.com/w40/be.png',
  'belize': 'https://flagcdn.com/w40/bz.png',
  'benin': 'https://flagcdn.com/w40/bj.png',
  'bermuda': 'https://flagcdn.com/w40/bm.png',
  'bhutan': 'https://flagcdn.com/w40/bt.png',
  'bolivia': 'https://flagcdn.com/w40/bo.png',
  'bosnia and herzegovina': 'https://flagcdn.com/w40/ba.png',
  'botswana': 'https://flagcdn.com/w40/bw.png',
  'brazil': 'https://flagcdn.com/w40/br.png',
  'british virgin islands': 'https://flagcdn.com/w40/vg.png',
  'brunei': 'https://flagcdn.com/w40/bn.png',
  'bulgaria': 'https://flagcdn.com/w40/bg.png',
  'burkina faso': 'https://flagcdn.com/w40/bf.png',
  'burundi': 'https://flagcdn.com/w40/bi.png',
  'cabo verde': 'https://flagcdn.com/w40/cv.png',
  'cambodia': 'https://flagcdn.com/w40/kh.png',
  'cameroon': 'https://flagcdn.com/w40/cm.png',
  'canada': 'https://flagcdn.com/w40/ca.png',
  'cayman islands': 'https://flagcdn.com/w40/ky.png',
  'central african republic': 'https://flagcdn.com/w40/cf.png',
  'chad': 'https://flagcdn.com/w40/td.png',
  'chile': 'https://flagcdn.com/w40/cl.png',
  'china pr': 'https://flagcdn.com/w40/cn.png',
  'chinese taipei (taiwan)': 'https://flagcdn.com/w40/tw.png',
  'colombia': 'https://flagcdn.com/w40/co.png',
  'comoros': 'https://flagcdn.com/w40/km.png',
  'congo': 'https://flagcdn.com/w40/cg.png',
  'dr congo': 'https://flagcdn.com/w40/cd.png',
  'cook islands': 'https://flagcdn.com/w40/ck.png',
  'costa rica': 'https://flagcdn.com/w40/cr.png',
  'côte d\'ivoire': 'https://flagcdn.com/w40/ci.png',
  'croatia': 'https://flagcdn.com/w40/hr.png',
  'cuba': 'https://flagcdn.com/w40/cu.png',
  'curaçao': 'https://flagcdn.com/w40/cw.png',
  'cyprus': 'https://flagcdn.com/w40/cy.png',
  'czech republic': 'https://flagcdn.com/w40/cz.png',
  'denmark': 'https://flagcdn.com/w40/dk.png',
  'djibouti': 'https://flagcdn.com/w40/dj.png',
  'dominica': 'https://flagcdn.com/w40/dm.png',
  'dominican republic': 'https://flagcdn.com/w40/do.png',
  'ecuador': 'https://flagcdn.com/w40/ec.png',
  'egypt': 'https://flagcdn.com/w40/eg.png',
  'el salvador': 'https://flagcdn.com/w40/sv.png',
  'england': 'https://upload.wikimedia.org/wikipedia/en/b/be/Flag_of_England.svg',
  'equatorial guinea': 'https://flagcdn.com/w40/gq.png',
  'eritrea': 'https://flagcdn.com/w40/er.png',
  'estonia': 'https://flagcdn.com/w40/ee.png',
  'eswatini': 'https://flagcdn.com/w40/sz.png',
  'ethiopia': 'https://flagcdn.com/w40/et.png',
  'faroe islands': 'https://flagcdn.com/w40/fo.png',
  'fiji': 'https://flagcdn.com/w40/fj.png',
  'finland': 'https://flagcdn.com/w40/fi.png',
  'france': 'https://flagcdn.com/w40/fr.png',
  'gabon': 'https://flagcdn.com/w40/ga.png',
  'gambia': 'https://flagcdn.com/w40/gm.png',
  'georgia': 'https://flagcdn.com/w40/ge.png',
  'germany': 'https://flagcdn.com/w40/de.png',
  'ghana': 'https://flagcdn.com/w40/gh.png',
  'gibraltar': 'https://flagcdn.com/w40/gi.png',
  'greece': 'https://flagcdn.com/w40/gr.png',
  'grenada': 'https://flagcdn.com/w40/gd.png',
  'guam': 'https://flagcdn.com/w40/gu.png',
  'guatemala': 'https://flagcdn.com/w40/gt.png',
  'guinea': 'https://flagcdn.com/w40/gn.png',
  'guinea-bissau': 'https://flagcdn.com/w40/gw.png',
  'guyana': 'https://flagcdn.com/w40/gy.png',
  'haiti': 'https://flagcdn.com/w40/ht.png',
  'honduras': 'https://flagcdn.com/w40/hn.png',
  'hong kong': 'https://flagcdn.com/w40/hk.png',
  'hungary': 'https://flagcdn.com/w40/hu.png',
  'iceland': 'https://flagcdn.com/w40/is.png',
  'india': 'https://flagcdn.com/w40/in.png',
  'indonesia': 'https://flagcdn.com/w40/id.png',
  'iran': 'https://flagcdn.com/w40/ir.png',
  'iraq': 'https://flagcdn.com/w40/iq.png',
  'ireland': 'https://flagcdn.com/w40/ie.png',
  'israel': 'https://flagcdn.com/w40/il.png',
  'italy': 'https://flagcdn.com/w40/it.png',
  'jamaica': 'https://flagcdn.com/w40/jm.png',
  'japan': 'https://flagcdn.com/w40/jp.png',
  'jordan': 'https://flagcdn.com/w40/jo.png',
  'kazakhstan': 'https://flagcdn.com/w40/kz.png',
  'kenya': 'https://flagcdn.com/w40/ke.png',
  'kiribati': 'https://flagcdn.com/w40/ki.png',
  'north korea': 'https://flagcdn.com/w40/kp.png',
  'south korea': 'https://flagcdn.com/w40/kr.png',
  'kosovo': 'https://flagcdn.com/w40/xk.png',
  'kuwait': 'https://flagcdn.com/w40/kw.png',
  'kyrgyz republic': 'https://flagcdn.com/w40/kg.png',
  'laos': 'https://flagcdn.com/w40/la.png',
  'latvia': 'https://flagcdn.com/w40/lv.png',
  'lebanon': 'https://flagcdn.com/w40/lb.png',
  'lesotho': 'https://flagcdn.com/w40/ls.png',
  'liberia': 'https://flagcdn.com/w40/lr.png',
  'libya': 'https://flagcdn.com/w40/ly.png',
  'liechtenstein': 'https://flagcdn.com/w40/li.png',
  'lithuania': 'https://flagcdn.com/w40/lt.png',
  'luxembourg': 'https://flagcdn.com/w40/lu.png',
  'macau': 'https://flagcdn.com/w40/mo.png',
  'madagascar': 'https://flagcdn.com/w40/mg.png',
  'malawi': 'https://flagcdn.com/w40/mw.png',
  'malaysia': 'https://flagcdn.com/w40/my.png',
  'maldives': 'https://flagcdn.com/w40/mv.png',
  'mali': 'https://flagcdn.com/w40/ml.png',
  'malta': 'https://flagcdn.com/w40/mt.png',
  'marshall islands': 'https://flagcdn.com/w40/mh.png',
  'mauritania': 'https://flagcdn.com/w40/mr.png',
  'mauritius': 'https://flagcdn.com/w40/mu.png',
  'mexico': 'https://flagcdn.com/w40/mx.png',
  'micronesia': 'https://flagcdn.com/w40/fm.png',
  'moldova': 'https://flagcdn.com/w40/md.png',
  'monaco': 'https://flagcdn.com/w40/mc.png',
  'mongolia': 'https://flagcdn.com/w40/mn.png',
  'montenegro': 'https://flagcdn.com/w40/me.png',
  'morocco': 'https://flagcdn.com/w40/ma.png',
  'mozambique': 'https://flagcdn.com/w40/mz.png',
  'myanmar': 'https://flagcdn.com/w40/mm.png',
  'namibia': 'https://flagcdn.com/w40/na.png',
  'nauru': 'https://flagcdn.com/w40/nr.png',
  'nepal': 'https://flagcdn.com/w40/np.png',
  'netherlands': 'https://flagcdn.com/w40/nl.png',
  'new caledonia': 'https://flagcdn.com/w40/nc.png',
  'new zealand': 'https://flagcdn.com/w40/nz.png',
  'nicaragua': 'https://flagcdn.com/w40/ni.png',
  'niger': 'https://flagcdn.com/w40/ne.png',
  'nigeria': 'https://flagcdn.com/w40/ng.png',
  'north macedonia': 'https://flagcdn.com/w40/mk.png',
  'northern ireland': 'https://upload.wikimedia.org/wikipedia/commons/d/d0/Ulster_Banner.svg',
  'norway': 'https://flagcdn.com/w40/no.png',
  'oman': 'https://flagcdn.com/w40/om.png',
  'pakistan': 'https://flagcdn.com/w40/pk.png',
  'palestine': 'https://flagcdn.com/w40/ps.png',
  'panama': 'https://flagcdn.com/w40/pa.png',
  'papua new guinea': 'https://flagcdn.com/w40/pg.png',
  'paraguay': 'https://flagcdn.com/w40/py.png',
  'peru': 'https://flagcdn.com/w40/pe.png',
  'philippines': 'https://flagcdn.com/w40/ph.png',
  'poland': 'https://flagcdn.com/w40/pl.png',
  'portugal': 'https://flagcdn.com/w40/pt.png',
  'puerto rico': 'https://flagcdn.com/w40/pr.png',
  'qatar': 'https://flagcdn.com/w40/qa.png',
  'romania': 'https://flagcdn.com/w40/ro.png',
  'russia': 'https://flagcdn.com/w40/ru.png',
  'rwanda': 'https://flagcdn.com/w40/rw.png',
  'samoa': 'https://flagcdn.com/w40/ws.png',
  'san marino': 'https://flagcdn.com/w40/sm.png',
  'são tomé and príncipe': 'https://flagcdn.com/w40/st.png',
  'saudi arabia': 'https://flagcdn.com/w40/sa.png',
  'scotland': 'https://upload.wikimedia.org/wikipedia/commons/1/10/Flag_of_Scotland.svg',
  'senegal': 'https://flagcdn.com/w40/sn.png',
  'serbia': 'https://flagcdn.com/w40/rs.png',
  'seychelles': 'https://flagcdn.com/w40/sc.png',
  'sierra leone': 'https://flagcdn.com/w40/sl.png',
  'singapore': 'https://flagcdn.com/w40/sg.png',
  'slovakia': 'https://flagcdn.com/w40/sk.png',
  'slovenia': 'https://flagcdn.com/w40/si.png',
  'solomon islands': 'https://flagcdn.com/w40/sb.png',
  'somalia': 'https://flagcdn.com/w40/so.png',
  'south africa': 'https://flagcdn.com/w40/za.png',
  'south sudan': 'https://flagcdn.com/w40/ss.png',
  'spain': 'https://flagcdn.com/w40/es.png',
  'sri lanka': 'https://flagcdn.com/w40/lk.png',
  'st. kitts and nevis': 'https://flagcdn.com/w40/kn.png',
  'st. lucia': 'https://flagcdn.com/w40/lc.png',
  'st. vincent / grenadines': 'https://flagcdn.com/w40/vc.png',
  'sudan': 'https://flagcdn.com/w40/sd.png',
  'suriname': 'https://flagcdn.com/w40/sr.png',
  'sweden': 'https://flagcdn.com/w40/se.png',
  'switzerland': 'https://flagcdn.com/w40/ch.png',
  'syria': 'https://flagcdn.com/w40/sy.png',
  'tajikistan': 'https://flagcdn.com/w40/tj.png',
  'tanzania': 'https://flagcdn.com/w40/tz.png',
  'thailand': 'https://flagcdn.com/w40/th.png',
  'timor-leste': 'https://flagcdn.com/w40/tl.png',
  'togo': 'https://flagcdn.com/w40/tg.png',
  'tonga': 'https://flagcdn.com/w40/to.png',
  'trinidad and tobago': 'https://flagcdn.com/w40/tt.png',
  'tunisia': 'https://flagcdn.com/w40/tn.png',
  'turkey': 'https://flagcdn.com/w40/tr.png',
  'turkmenistan': 'https://flagcdn.com/w40/tm.png',
  'tuvalu': 'https://flagcdn.com/w40/tv.png',
  'uganda': 'https://flagcdn.com/w40/ug.png',
  'ukraine': 'https://flagcdn.com/w40/ua.png',
  'united arab emirates': 'https://flagcdn.com/w40/ae.png',
  'united states': 'https://flagcdn.com/w40/us.png',
  'uruguay': 'https://flagcdn.com/w40/uy.png',
  'uzbekistan': 'https://flagcdn.com/w40/uz.png',
  'vanuatu': 'https://flagcdn.com/w40/vu.png',
  'vatican': 'https://flagcdn.com/w40/va.png',
  'venezuela': 'https://flagcdn.com/w40/ve.png',
  'vietnam': 'https://flagcdn.com/w40/vn.png',
  'wales': 'https://upload.wikimedia.org/wikipedia/commons/d/dc/Flag_of_Wales.svg',
  'yemen': 'https://flagcdn.com/w40/ye.png',
  'zambia': 'https://flagcdn.com/w40/zm.png',
  'zimbabwe': 'https://flagcdn.com/w40/zw.png'
};

    // Formation configurations with positions and variants
    const formations = {
      // 4-4-2 Family
      '4-4-2': {
        lines: [
          { positions: ['GK'], line: 'defense' },
          { positions: ['LB', 'CB', 'CB', 'RB'], line: 'defense' },
          { positions: ['LM', 'CM', 'CM', 'RM'], line: 'midfield' },
          { positions: ['CF', 'CF'], line: 'attack' }
        ]
      },
      '4-1-2-1-2': {
        lines: [
          { positions: ['GK'], line: 'defense' },
          { positions: ['LB', 'CB', 'CB', 'RB'], line: 'defense' },
          { positions: ['DM'], line: 'midfield' },
          { positions: ['CM', 'CM'], line: 'midfield' },
          { positions: ['AM'], line: 'midfield' },
          { positions: ['CF', 'CF'], line: 'attack' }
        ]
      },
      '4-3-1-2': {
        lines: [
          { positions: ['GK'], line: 'defense' },
          { positions: ['LB', 'CB', 'CB', 'RB'], line: 'defense' },
          { positions: ['CM', 'CM', 'CM'], line: 'midfield' },
          { positions: ['AM'], line: 'midfield' },
          { positions: ['CF', 'CF'], line: 'attack' }
        ]
      },
      '4-2-2-2': {
        lines: [
          { positions: ['GK'], line: 'defense' },
          { positions: ['LB', 'CB', 'CB', 'RB'], line: 'defense' },
          { positions: ['DM', 'DM'], line: 'midfield' },
          { positions: ['AM', 'AM'], line: 'midfield' },
          { positions: ['CF', 'CF'], line: 'attack' }
        ]
      },
      '4-4-1-1': {
        lines: [
          { positions: ['GK'], line: 'defense' },
          { positions: ['LB', 'CB', 'CB', 'RB'], line: 'defense' },
          { positions: ['LM', 'CM', 'CM', 'RM'], line: 'midfield' },
          { positions: ['SS'], line: 'midfield' },
          { positions: ['CF'], line: 'attack' }
        ]
      },
      '4-1-3-2': {
        lines: [
          { positions: ['GK'], line: 'defense' },
          { positions: ['LB', 'CB', 'CB', 'RB'], line: 'defense' },
          { positions: ['DM'], line: 'midfield' },
          { positions: ['LM', 'AM', 'RM'], line: 'midfield' },
          { positions: ['CF', 'CF'], line: 'attack' }
        ]
      },

      // 4-5-1 Family
      '4-5-1': {
        lines: [
          { positions: ['GK'], line: 'defense' },
          { positions: ['LB', 'CB', 'CB', 'RB'], line: 'defense' },
          { positions: ['LM', 'CM', 'CM', 'CM', 'RM'], line: 'midfield' },
          { positions: ['CF'], line: 'attack' }
        ]
      },
      '4-1-4-1': {
        lines: [
          { positions: ['GK'], line: 'defense' },
          { positions: ['LB', 'CB', 'CB', 'RB'], line: 'defense' },
          { positions: ['DM'], line: 'midfield' },
          { positions: ['LM', 'CM', 'CM', 'RM'], line: 'midfield' },
          { positions: ['CF'], line: 'attack' }
        ]
      },
      '4-2-3-1': {
        lines: [
          { positions: ['GK'], line: 'defense' },
          { positions: ['LB', 'CB', 'CB', 'RB'], line: 'defense' },
          { positions: ['DM', 'DM'], line: 'midfield' },
          { positions: ['LW', 'AM', 'RW'], line: 'midfield' },
          { positions: ['CF'], line: 'attack' }
        ]
      },
      '4-3-2-1': {
        lines: [
          { positions: ['GK'], line: 'defense' },
          { positions: ['LB', 'CB', 'CB', 'RB'], line: 'defense' },
          { positions: ['CM', 'CM', 'CM'], line: 'midfield' },
          { positions: ['LW', 'RW'], line: 'midfield' },
          { positions: ['CF'], line: 'attack' }
        ]
      },

      // 4-3-3 Family
      '4-3-3': {
        lines: [
          { positions: ['GK'], line: 'defense' },
          { positions: ['LB', 'CB', 'CB', 'RB'], line: 'defense' },
          { positions: ['CM', 'CM', 'CM'], line: 'midfield' },
          { positions: ['LW', 'CF', 'RW'], line: 'attack' }
        ]
      },
      '4-1-2-3': {
        lines: [
          { positions: ['GK'], line: 'defense' },
          { positions: ['LB', 'CB', 'CB', 'RB'], line: 'defense' },
          { positions: ['DM'], line: 'midfield' },
          { positions: ['CM', 'CM'], line: 'midfield' },
          { positions: ['LW', 'CF', 'RW'], line: 'attack' }
        ]
      },
      '4-2-1-3': {
        lines: [
          { positions: ['GK'], line: 'defense' },
          { positions: ['LB', 'CB', 'CB', 'RB'], line: 'defense' },
          { positions: ['DM', 'DM'], line: 'midfield' },
          { positions: ['AM'], line: 'midfield' },
          { positions: ['LW', 'CF', 'RW'], line: 'attack' }
        ]
      },

      // 5-3-2 Family
      '5-3-2': {
        lines: [
          { positions: ['GK'], line: 'defense' },
          { positions: ['LWB', 'CB', 'CB', 'CB', 'RWB'], line: 'defense' },
          { positions: ['CM', 'CM', 'CM'], line: 'midfield' },
          { positions: ['CF', 'CF'], line: 'attack' }
        ]
      },
      '5-2-1-2': {
        lines: [
          { positions: ['GK'], line: 'defense' },
          { positions: ['LWB', 'CB', 'CB', 'CB', 'RWB'], line: 'defense' },
          { positions: ['DM', 'DM'], line: 'midfield' },
          { positions: ['AM'], line: 'midfield' },
          { positions: ['CF', 'CF'], line: 'attack' }
        ]
      },

      // 5-2-3 Family
      '5-2-3': {
        lines: [
          { positions: ['GK'], line: 'defense' },
          { positions: ['LWB', 'CB', 'CB', 'CB', 'RWB'], line: 'defense' },
          { positions: ['DM', 'DM'], line: 'midfield' },
          { positions: ['LW', 'CF', 'RW'], line: 'attack' }
        ]
      },
      '5-2-2-1': {
        lines: [
          { positions: ['GK'], line: 'defense' },
          { positions: ['LWB', 'CB', 'CB', 'CB', 'RWB'], line: 'defense' },
          { positions: ['DM', 'DM'], line: 'midfield' },
          { positions: ['LW', 'RW'], line: 'midfield' },
          { positions: ['CF'], line: 'attack' }
        ]
      },

      // 5-4-1 Family
      '5-4-1': {
        lines: [
          { positions: ['GK'], line: 'defense' },
          { positions: ['LWB', 'CB', 'CB', 'CB', 'RWB'], line: 'defense' },
          { positions: ['LM', 'CM', 'CM', 'RM'], line: 'midfield' },
          { positions: ['CF'], line: 'attack' }
        ]
      },
      '5-1-2-1-1': {
        lines: [
          { positions: ['GK'], line: 'defense' },
          { positions: ['LWB', 'CB', 'CB', 'CB', 'RWB'], line: 'defense' },
          { positions: ['DM'], line: 'midfield' },
          { positions: ['CM', 'CM'], line: 'midfield' },
          { positions: ['AM'], line: 'midfield' },
          { positions: ['CF'], line: 'attack' }
        ]
      },

      // 3-5-2 Family
      '3-5-2': {
        lines: [
          { positions: ['GK'], line: 'defense' },
          { positions: ['CB', 'CB', 'CB'], line: 'defense' },
          { positions: ['LWB', 'CM', 'CM', 'CM', 'RWB'], line: 'midfield' },
          { positions: ['CF', 'CF'], line: 'attack' }
        ]
      },
      '3-2-3-2': {
        lines: [
          { positions: ['GK'], line: 'defense' },
          { positions: ['CB', 'CB', 'CB'], line: 'defense' },
          { positions: ['DM', 'DM'], line: 'midfield' },
          { positions: ['LM', 'AM', 'RM'], line: 'midfield' },
          { positions: ['CF', 'CF'], line: 'attack' }
        ]
      },
      '3-1-4-2': {
        lines: [
          { positions: ['GK'], line: 'defense' },
          { positions: ['CB', 'CB', 'CB'], line: 'defense' },
          { positions: ['DM'], line: 'midfield' },
          { positions: ['LM', 'CM', 'CM', 'RM'], line: 'midfield' },
          { positions: ['CF', 'CF'], line: 'attack' }
        ]
      },
      '3-4-1-2': {
        lines: [
          { positions: ['GK'], line: 'defense' },
          { positions: ['CB', 'CB', 'CB'], line: 'defense' },
          { positions: ['LM', 'CM', 'CM', 'RM'], line: 'midfield' },
          { positions: ['AM'], line: 'midfield' },
          { positions: ['CF', 'CF'], line: 'attack' }
        ]
      },
      '3-5-1-1': {
        lines: [
          { positions: ['GK'], line: 'defense' },
          { positions: ['CB', 'CB', 'CB'], line: 'defense' },
          { positions: ['LWB', 'CM', 'CM', 'CM', 'RWB'], line: 'midfield' },
          { positions: ['SS'], line: 'midfield' },
          { positions: ['CF'], line: 'attack' }
        ]
      },

      // 3-4-3 Family
      '3-4-3': {
        lines: [
          { positions: ['GK'], line: 'defense' },
          { positions: ['CB', 'CB', 'CB'], line: 'defense' },
          { positions: ['LM', 'CM', 'CM', 'RM'], line: 'midfield' },
          { positions: ['LW', 'CF', 'RW'], line: 'attack' }
        ]
      },
      '3-4-2-1': {
        lines: [
          { positions: ['GK'], line: 'defense' },
          { positions: ['CB', 'CB', 'CB'], line: 'defense' },
          { positions: ['LM', 'CM', 'CM', 'RM'], line: 'midfield' },
          { positions: ['LW', 'RW'], line: 'midfield' },
          { positions: ['CF'], line: 'attack' }
        ]
      },
      '3-1-2-1-3': {
        lines: [
          { positions: ['GK'], line: 'defense' },
          { positions: ['CB', 'CB', 'CB'], line: 'defense' },
          { positions: ['DM'], line: 'midfield' },
          { positions: ['CM', 'CM'], line: 'midfield' },
          { positions: ['AM'], line: 'midfield' },
          { positions: ['LW', 'CF', 'RW'], line: 'attack' }
        ]
      },
      '3-3-1-3': {
        lines: [
          { positions: ['GK'], line: 'defense' },
          { positions: ['CB', 'CB', 'CB'], line: 'defense' },
          { positions: ['LM', 'CM', 'RM'], line: 'midfield' },
          { positions: ['AM'], line: 'midfield' },
          { positions: ['LW', 'CF', 'RW'], line: 'attack' }
        ]
      }
    };

    // Formation families for variant selection
    const formationFamilies = {
      '4-4-2': ['4-4-2', '4-1-2-1-2', '4-3-1-2', '4-2-2-2', '4-4-1-1', '4-1-3-2'],
      '4-5-1': ['4-5-1', '4-1-4-1', '4-2-3-1', '4-3-2-1'],
      '4-3-3': ['4-3-3', '4-1-2-3', '4-2-1-3'],
      '5-3-2': ['5-3-2', '5-2-1-2'],
      '5-2-3': ['5-2-3', '5-2-2-1'],
      '5-4-1': ['5-4-1', '5-1-2-1-1'],
      '3-5-2': ['3-5-2', '3-2-3-2', '3-1-4-2', '3-4-1-2', '3-5-1-1'],
      '3-4-3': ['3-4-3', '3-4-2-1', '3-1-2-1-3', '3-3-1-3']
    };
  
    // Enhanced position mappings with flexible substitution rules
    const positionSubstitutions = {
      // Left side positions can substitute for each other
      'LW': ['LW', 'LWB', 'LM'],
      'LWB': ['LWB', 'LW', 'LB', 'LM'],
      'LB': ['LB', 'LWB'],
      'LM': ['LM', 'LW', 'LWB'],
      
      // Right side positions can substitute for each other  
      'RW': ['RW', 'RWB', 'RM'],
      'RWB': ['RWB', 'RW', 'RB', 'RM'],
      'RB': ['RB', 'RWB'],
      'RM': ['RM', 'RW', 'RWB'],
      
      // Midfield positions can substitute for each other
      'CM': ['CM', 'DM', 'AM'],
      'AM': ['AM', 'CM', 'SS'],
      'DM': ['DM', 'CM'],
      
      // Forward positions can substitute for each other
      'CF': ['CF', 'SS'],
      'SS': ['SS', 'CF', 'AM'],
      
      // Goalkeeper and center back are position-specific
      'GK': ['GK'],
      'CB': ['CB']
    };

    // Country to continent mapping
    const countryToContinent = {
      'Algeria': 'Africa', 'Angola': 'Africa', 'Benin': 'Africa', 'Botswana': 'Africa', 'Burkina Faso': 'Africa',
      'Burundi': 'Africa', 'Cabo Verde': 'Africa', 'Cameroon': 'Africa', 'Central African Republic': 'Africa',
      'Chad': 'Africa', 'Comoros': 'Africa', 'Congo': 'Africa', 'Djibouti': 'Africa', 'Egypt': 'Africa',
      'Equatorial Guinea': 'Africa', 'Eritrea': 'Africa', 'Eswatini': 'Africa', 'Ethiopia': 'Africa',
      'Gabon': 'Africa', 'Gambia': 'Africa', 'Ghana': 'Africa', 'Guinea': 'Africa', 'Guinea-Bissau': 'Africa',
      'Ivory Coast': 'Africa', 'Kenya': 'Africa', 'Lesotho': 'Africa', 'Liberia': 'Africa', 'Libya': 'Africa',
      'Madagascar': 'Africa', 'Malawi': 'Africa', 'Mali': 'Africa', 'Mauritania': 'Africa', 'Mauritius': 'Africa',
      'Morocco': 'Africa', 'Mozambique': 'Africa', 'Namibia': 'Africa', 'Niger': 'Africa', 'Nigeria': 'Africa',
      'Rwanda': 'Africa', 'Senegal': 'Africa', 'Seychelles': 'Africa', 'Sierra Leone': 'Africa', 'Somalia': 'Africa',
      'South Africa': 'Africa', 'South Sudan': 'Africa', 'Sudan': 'Africa', 'Tanzania': 'Africa', 'Togo': 'Africa',
      'Tunisia': 'Africa', 'Uganda': 'Africa', 'Zambia': 'Africa', 'Zimbabwe': 'Africa',

      'Afghanistan': 'Asia', 'Azerbaijan': 'Asia', 'Bahrain': 'Asia', 'Bangladesh': 'Asia',
      'Bhutan': 'Asia', 'Brunei': 'Asia', 'Cambodia': 'Asia', 'China': 'Asia', 'Cyprus': 'Asia',
      'East Timor': 'Asia', 'Georgia': 'Asia', 'India': 'Asia', 'Indonesia': 'Asia', 'Iran': 'Asia',
      'Iraq': 'Asia', 'Israel': 'Asia', 'Japan': 'Asia', 'Jordan': 'Asia', 'Kazakhstan': 'Asia',
      'Kuwait': 'Asia', 'Kyrgyzstan': 'Asia', 'Laos': 'Asia', 'Lebanon': 'Asia', 'Malaysia': 'Asia',
      'Maldives': 'Asia', 'Mongolia': 'Asia', 'Myanmar': 'Asia', 'Nepal': 'Asia', 'North Korea': 'Asia',
      'Oman': 'Asia', 'Pakistan': 'Asia', 'Palestine': 'Asia', 'Philippines': 'Asia', 'Qatar': 'Asia',
      'Russia': 'Asia', 'Saudi Arabia': 'Asia', 'Singapore': 'Asia', 'South Korea': 'Asia', 'Sri Lanka': 'Asia',
      'Syria': 'Asia', 'Tajikistan': 'Asia', 'Thailand': 'Asia', 'Turkmenistan': 'Asia',
      'United Arab Emirates': 'Asia', 'Uzbekistan': 'Asia', 'Vietnam': 'Asia', 'Yemen': 'Asia',

      'Albania': 'Europe', 'Andorra': 'Europe', 'Austria': 'Europe', 'Belarus': 'Europe', 'Belgium': 'Europe',
      'Bosnia and Herzegovina': 'Europe', 'Bulgaria': 'Europe', 'Croatia': 'Europe', 'Czech Republic': 'Europe',
      'Denmark': 'Europe', 'Estonia': 'Europe', 'Finland': 'Europe', 'France': 'Europe', 'Germany': 'Europe',
      'Greece': 'Europe', 'Hungary': 'Europe', 'Iceland': 'Europe', 'Ireland': 'Europe', 'Italy': 'Europe',
      'Latvia': 'Europe', 'Liechtenstein': 'Europe', 'Lithuania': 'Europe', 'Luxembourg': 'Europe',
      'Malta': 'Europe', 'Moldova': 'Europe', 'Monaco': 'Europe', 'Montenegro': 'Europe', 'Netherlands': 'Europe',
      'North Macedonia': 'Europe', 'Norway': 'Europe', 'Poland': 'Europe', 'Portugal': 'Europe',
      'Romania': 'Europe', 'San Marino': 'Europe', 'Serbia': 'Europe', 'Slovakia': 'Europe', 'Slovenia': 'Europe',
      'Spain': 'Europe', 'Sweden': 'Europe', 'Switzerland': 'Europe', 'Ukraine': 'Europe', 'United Kingdom': 'Europe',
      'Vatican City': 'Europe', 'England': 'Europe', 'Scotland': 'Europe', 'Wales': 'Europe', 'Turkey': 'Europe', 'Armenia': 'Europe',

      'Antigua and Barbuda': 'North America', 'Bahamas': 'North America', 'Barbados': 'North America',
      'Belize': 'North America', 'Canada': 'North America', 'Costa Rica': 'North America', 'Cuba': 'North America',
      'Dominica': 'North America', 'Dominican Republic': 'North America', 'El Salvador': 'North America',
      'Grenada': 'North America', 'Guatemala': 'North America', 'Haiti': 'North America', 'Honduras': 'North America',
      'Jamaica': 'North America', 'Mexico': 'North America', 'Nicaragua': 'North America', 'Panama': 'North America',
      'Saint Kitts and Nevis': 'North America', 'Saint Lucia': 'North America', 'Saint Vincent and the Grenadines': 'North America',
      'Trinidad and Tobago': 'North America', 'United States': 'North America',

      'Argentina': 'South America', 'Bolivia': 'South America', 'Brazil': 'South America', 'Chile': 'South America',
      'Colombia': 'South America', 'Ecuador': 'South America', 'Guyana': 'South America', 'Paraguay': 'South America',
      'Peru': 'South America', 'Suriname': 'South America', 'Uruguay': 'South America', 'Venezuela': 'South America',

      'Australia': 'Oceania', 'Fiji': 'Oceania', 'Kiribati': 'Oceania', 'Marshall Islands': 'Oceania',
      'Micronesia': 'Oceania', 'Nauru': 'Oceania', 'New Zealand': 'Oceania', 'Palau': 'Oceania',
      'Papua New Guinea': 'Oceania', 'Samoa': 'Oceania', 'Solomon Islands': 'Oceania', 'Tonga': 'Oceania',
      'Tuvalu': 'Oceania', 'Vanuatu': 'Oceania'
    };
  
    // DOM Elements
    const loading = document.getElementById('loading');
    const error = document.getElementById('error');
    const playersGrid = document.getElementById('playersGrid');
    const noResults = document.getElementById('noResults');
    const searchInput = document.getElementById('searchInput');
    const countryFilter = document.getElementById('countryFilter');
    const priceFilter = document.getElementById('priceFilter');
    const clearFilters = document.getElementById('clearFilters');
    const playersTab = document.getElementById('playersTab');
    const teamBuilderTab = document.getElementById('teamBuilderTab');
    const donateTab = document.getElementById('donateTab');
    const buildTeamBtn = document.getElementById('buildTeamBtn');
    const builtTeamDiv = document.getElementById('builtTeam');
    const teamStats = document.getElementById('teamStats');
    const formationDisplay = document.getElementById('formationDisplay');
    const formationField = document.getElementById('formationField');
  
    async function loadData() {
      try {
        const response = await fetch(url);
        
        if (!response.ok) {
          const errorText = await response.text();
          throw new Error(`Network error: ${response.status} ${response.statusText} - ${errorText}`);
        }
  
        const data = await response.json();
        if (!data.values || data.values.length === 0) {
          throw new Error('No data found in the selected range');
        }
  
        const [headers, ...rows] = data.values;
        
        allPlayers = rows.map(row => {
          const player = {};
          headers.forEach((header, index) => {
            player[header] = row[index] || '';
          });
          return player;
        }).filter(player => player[headers[0]] && player[headers[0]].trim());

        // Calculate rankings based on rating
        const ratingField = getRatingField();
        allPlayers.sort((a, b) => {
          const ratingA = parseFloat(a[ratingField] || '0');
          const ratingB = parseFloat(b[ratingField] || '0');
          return ratingB - ratingA;
        });

        // Add ranking to each player
        allPlayers.forEach((player, index) => {
          player.rank = index + 1;
        });

        // Add continent data
        allPlayers.forEach(player => {
          player['Continent'] = countryToContinent[player['Nationality'] || player['Country']] || '';
        });

        filteredPlayers = [...allPlayers];
        populateFilters();
        renderPlayers();
        showContent();
        
      } catch (err) {
        console.error('Error loading data:', err);
        error.innerHTML = `
          <h3 class="font-bold text-xl mb-3">❌ Data Loading Error</h3>
          <p class="text-lg">${err.message}</p>
        `;
        showError();
      }
    }
  
    function populateFilters() {
      const countries = [...new Set(allPlayers.map(p => p['Nationality'] || p['Country'] || '').filter(c => c))].sort();
      countryFilter.innerHTML = '<option value="">🌍 All Countries</option>';
      const teamCountryFilter = document.getElementById('teamCountryFilter');
      teamCountryFilter.innerHTML = '<option value="">Any Country</option>';
      
      countries.forEach(country => {
        const option = document.createElement('option');
        option.value = country;
        option.textContent = country;
        countryFilter.appendChild(option);
        
        const teamOption = option.cloneNode(true);
        teamCountryFilter.appendChild(teamOption);
      });

      const clubs = [...new Set(allPlayers.map(p => p['Club'] || '').filter(c => c))].sort();
      const teamClubFilter = document.getElementById('teamClubFilter');
      teamClubFilter.innerHTML = '<option value="">Any Club</option>';
      
      clubs.forEach(club => {
        const option = document.createElement('option');
        option.value = club;
        option.textContent = club;
        teamClubFilter.appendChild(option);
      });
    }
  
function switchTab(tab) {
  currentTab = tab;
  document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
  event.target.classList.add('active');

  // Ẩn modal, overlay, thống kê đội bóng và sơ đồ đội hình khi chuyển khỏi tab team-builder
  if (tab !== 'team-builder') {
    teamStats.classList.add('hidden');
    formationDisplay.classList.add('hidden');
    builtTeamDiv.classList.add('hidden');
    builtTeamDiv.classList.remove('show');
    document.getElementById('builtTeamOverlay').classList.remove('show');
    builtTeam = []; // Xóa dữ liệu đội bóng
  }

  if (tab === 'players') {
    playersTab.classList.remove('hidden');
    teamBuilderTab.classList.add('hidden');
    donateTab?.classList?.add('hidden');
  } else if (tab === 'team-builder') {
    playersTab.classList.add('hidden');
    teamBuilderTab.classList.remove('hidden');
    donateTab?.classList?.add('hidden');
    if (builtTeam.lengthеркви

 > 0) {
      displayBuiltTeam();
      updateTeamStats();
      displayFormation();
    }
  } else if (tab === 'donate') {
    playersTab.classList.add('hidden');
    teamBuilderTab.classList.add('hidden');
    donateTab?.classList?.remove('hidden');
  }
}

    function selectFormation(formation) {
      currentFormation = formation;
      
      // Update main formation buttons
      document.querySelectorAll('.formation-btn').forEach(btn => btn.classList.remove('active'));
      event.target.classList.add('active');
      
      // Show formation variants
      updateFormationVariants(formation);
      
      // Show formation structure (empty positions)
      displayFormation();
    }

    function selectFormationVariant(variant) {
      currentFormation = variant;
      
      // Update variant buttons
      document.querySelectorAll('#formationVariants .formation-btn').forEach(btn => btn.classList.remove('active'));
      event.target.classList.add('active');
      
      // Show formation structure (empty positions)
      displayFormation();
    }

    function updateFormationVariants(mainFormation) {
      const variantsContainer = document.getElementById('formationVariants');
      const variants = formationFamilies[mainFormation] || [];
      
      if (variants.length <= 1) {
        variantsContainer.style.display = 'none';
        return;
      }
      
      variantsContainer.style.display = 'flex';
      variantsContainer.innerHTML = '';
      
      variants.forEach((variant, index) => {
        const btn = document.createElement('button');
        btn.className = `formation-btn ${index === 0 ? 'active' : ''}`;
        btn.textContent = variant;
        btn.onclick = () => selectFormationVariant(variant);
        variantsContainer.appendChild(btn);
      });
      
      // Set first variant as current if it's different
      if (variants[0] !== currentFormation) {
        currentFormation = variants[0];
      }
    }

    function getRankClass(rank) {
      if (rank <= 10) return 'top10';
      if (rank <= 50) return 'top50';
      return '';
    }
  
    function applyFilters() {
      const searchTerm = searchInput.value.toLowerCase().trim();
      const selectedCountry = countryFilter.value.trim().toLowerCase();
      const selectedPrice = priceFilter.value;
      const selectedPosition = document.getElementById('positionFilter').value.toUpperCase();
      const selectedClub = document.getElementById('clubFilter').value.toLowerCase().trim();


      filteredPlayers = allPlayers.filter(player => {
        const matchesSearch = !searchTerm || Object.values(player).some(value => 
          value.toString().toLowerCase().includes(searchTerm)
        );

        const playerCountry = (player['Nationality'] || player['Country'] || '').toLowerCase();
        const matchesCountry = !selectedCountry || playerCountry.includes(selectedCountry);

        let matchesPrice = true;
        if (selectedPrice) {
          const priceValue = parseFloat(player['Price'] || player['Value'] || '0');
          const [min, max] = selectedPrice.split('-');
          const minPrice = parseFloat(min);
          const maxPrice = max ? parseFloat(max) : Infinity;

          if (selectedPrice.includes('+')) {
            matchesPrice = priceValue > minPrice;
          } else {
            matchesPrice = priceValue >= minPrice && priceValue < maxPrice;
          }
        }

        const playerPos = (player['Position'] || player['Pos'] || '').toUpperCase();
const matchesPosition = !selectedPosition || playerPos === selectedPosition;

const matchesClub = (player['Club'] || '').toLowerCase().includes(selectedClub);


        return matchesSearch && matchesCountry && matchesPrice && matchesPosition && matchesClub;
      });

      renderPlayers();
    }

    function renderPlayers() {
      playersGrid.innerHTML = '';
      
      if (filteredPlayers.length === 0) {
        noResults.classList.remove('hidden');
        playersGrid.classList.add('hidden');
        return;
      }
      
      noResults.classList.add('hidden');
      playersGrid.classList.remove('hidden');

      // Sort by current sort filter
      const sortFilter = document.getElementById('sortFilter').value;
      const ratingField = getRatingField();
      if (sortFilter) {
        filteredPlayers.sort((a, b) => {
          const ratingA = parseFloat(a[ratingField] || '0');
          const ratingB = parseFloat(b[ratingField] || '0');
          const priceA = parseFloat(a['Price'] || a['Value'] || '0');
          const priceB = parseFloat(b['Price'] || b['Value'] || '0');
          const nameA = a[Object.keys(a)[0]].toLowerCase();
          const nameB = b[Object.keys(b)[0]].toLowerCase();

          switch (sortFilter) {
            case 'rating-high': return ratingB - ratingA;
            case 'rating-low': return ratingA - ratingB;
            case 'price-high': return priceB - priceA;
            case 'price-low': return priceA - priceB;
            case 'name': return nameA.localeCompare(nameB);
            default: return 0;
          }
        });
      }

      filteredPlayers.forEach((player, index) => {
        const playerCard = createPlayerCard(player, index);
        playersGrid.appendChild(playerCard);
      });
    }
  
// Hàm chuẩn hóa chỉ số về thang 100
function normalizeStat(value) {
  const num = parseFloat(value) || 0;
  return Math.min(Math.max(num, 0), 100); // Đảm bảo giá trị trong khoảng 0-100
}

function createOctagonChart(ctx, labels, playerData, avgData, isGoalkeeper) {
  if (!window.Chart) {
    console.error('Chart.js chưa được tải.');
    return;
  }
  new Chart(ctx, {
    type: 'radar',
    data: {
      labels: labels,
      datasets: [
        {
          label: 'Player Stats',
          data: playerData,
          fill: true,
          backgroundColor: 'rgba(54, 162, 235, 0.2)',
          borderColor: 'rgb(54, 162, 235)',
          pointBackgroundColor: 'rgb(54, 162, 235)',
          pointBorderColor: '#fff',
          pointHoverBackgroundColor: '#fff',
          pointHoverBorderColor: 'rgb(54, 162, 235)'
        },
        {
          label: 'Average for Position',
          data: avgData,
          fill: false,
          borderColor: 'rgba(255, 99, 132, 0.8)',
          borderDash: [5, 5],
          pointBackgroundColor: 'rgba(255, 99, 132, 0.8)',
          pointBorderColor: '#fff',
          pointHoverBackgroundColor: '#fff',
          pointHoverBorderColor: 'rgba(255, 99, 132, 0.8)'
        }
      ]
    },
    options: {
      responsive: true,
      maintainAspectRatio: true,
      scales: {
        r: {
          angleLines: { display: true },
          suggestedMin: 0,
          suggestedMax: 100,
          ticks: { stepSize: 20 }
        }
      },
      plugins: {
        legend: {
          display: true,
          position: 'top',
          labels: {
            font: { size: 12 },
            color: '#333'
          }
        }
      }
    }
  });
}

function calculateAverageStats(players, position, statGroup) {
  const playersInPosition = players.filter(player => 
    (player['Position'] || player['Pos'] || '').toUpperCase() === position.toUpperCase()
  );
  
  if (playersInPosition.length === 0) {
    return statGroup.map(() => 0);
  }

  const averages = statGroup.map(stat => {
    const sum = playersInPosition.reduce((acc, player) => {
      return acc + normalizeStat(player[stat] || 0);
    }, 0);
    return normalizeStat((sum / playersInPosition.length).toFixed(1));
  });

  return averages;
}

function showPlayerPopup(player, isGoalkeeper, allPlayers) {
  const statShortLabels = {
    'Speed': 'SPE',
    'Acceleration': 'ACC',
    'Reactions (GK)': 'GKR',
    'Strength': 'STR',
    'Control': 'CON',
    'Passing': 'PAS',
    'Handling (GK)': 'GKH',
    'Tackling': 'TAC',
    'Stamina': 'STA',
    'Shooting': 'SHO'
  };

  const statGroup = isGoalkeeper
    ? ['Speed', 'Acceleration', 'Reactions (GK)', 'Strength', 'Control', 'Passing', 'Handling (GK)', 'Tackling']
    : ['Speed', 'Acceleration', 'Stamina', 'Strength', 'Control', 'Passing', 'Shooting', 'Tackling'];

  const isMobile = window.innerWidth <= 768;
  const labels = statGroup.map(stat => isMobile ? (statShortLabels[stat] || stat) : stat.replace('(GK)', '').trim());
  const playerData = statGroup.map(stat => normalizeStat(player[stat]));
  const position = player['Position'] || player['Pos'] || '';
  const avgData = calculateAverageStats(allPlayers, position, statGroup);

  // Lấy danh hiệu từ cột Honours
  const honours = player['Honours'] || 'New features update later';
const honoursList = (honours || '')
  .split(/\n|•|- |, (?=[A-Z])/)  // Tách theo xuống dòng, bullet, dấu gạch, hoặc phẩy + chữ hoa
  .map(h => h.trim())
  .filter(h => h.length > 3);

// Render tối đa 20 dòng danh hiệu
const honoursHTML = honoursList.length
  ? `<ul class="list-disc pl-5 text-gray-600">
      ${honoursList.slice(0, 20).map(honour => `<li class="py-1">${honour}</li>`).join('')}
     </ul>`
  : `<p class="text-gray-500 italic">Chưa có danh hiệu</p>`;


  const popup = document.createElement('div');
  popup.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
  popup.id = 'playerPopup';
  popup.innerHTML = `
    <div class="bg-white rounded-lg p-6 w-full max-w-3xl mx-4 max-h-[90vh] overflow-y-auto player-popup">
      <div class="flex justify-between items-center mb-4">
<h2 class="text-xl font-bold text-gray-800">${player['Name'] || player['Player Name'] || 'Unknown Player'}</h2>
        <button id="closePopup" class="text-gray-500 hover:text-gray-700 text-2xl font-bold">&times;</button>
      </div>
      <div class="flex flex-col md:flex-row gap-4">
        <!-- Bên trái: Biểu đồ bát giác -->
        <div class="w-full md:w-1/2 bg-gray-50 p-4 rounded-lg">
          <canvas id="octagonChart" width="400" height="400"></canvas>
        </div>
        <!-- Bên phải: Danh hiệu -->
        <div class="w-full md:w-1/2">
          <h3 class="text-lg font-semibold mb-2 text-gray-700">Honours</h3>
          ${honoursList.length > 0 ? `
            <ul class="list-disc pl-5 text-gray-600">
              ${honoursList.map(honour => `<li class="py-1">${honour}</li>`).join('')}
            </ul>
          ` : `
            <p class="text-gray-500 italic"></p>
          `}
        </div>
      </div>
    </div>
  `;

  document.body.appendChild(popup);

  const ctx = document.getElementById('octagonChart').getContext('2d');
  createOctagonChart(ctx, labels, playerData, avgData, isGoalkeeper);

  document.getElementById('closePopup').addEventListener('click', () => {
    popup.remove();
  });

  popup.addEventListener('click', (e) => {
    if (e.target === popup) popup.remove();
  });
}

// Hàm tạo thẻ cầu thủ với sự kiện nhấp để mở pop-up
function createPlayerCard(player, index) {
  const card = document.createElement('div');
  card.className = 'player-card fade-in cursor-pointer';
  card.style.animationDelay = `${index * 0.05}s`;

  const headers = Object.keys(player);
  const nameField = headers[0];
  const ratingField = getRatingField();

  const name = player[nameField] || 'Unknown Player';
  const rating = normalizeStat(player[ratingField] || '0');
  const numRating = parseFloat(rating);
  const country = player['Nationality'] || player['Country'] || '';
  const flagUrl = countryMap[country.toLowerCase()] || 'https://via.placeholder.com/16/000000/FFFFFF?text=?';
  const club = player['Club'] || '';
  const clubLogoUrl = player['Img Club'] || 'https://via.placeholder.com/16?text=?';
  const price = player['Price'] || player['Value'] || '';
  const position = player['Position'] || player['Pos'] || '';
  const rank = player.rank || 0;

  const isGoalkeeper = position.toLowerCase().includes('gk');

  let ratingClass = '';
  if (numRating >= 80) ratingClass = 'rating-legendary';
  else if (numRating >= 70) ratingClass = 'rating-elite';
  else if (numRating >= 60) ratingClass = 'rating-good';
  else ratingClass = 'rating-basic';

  const statGroup1 = isGoalkeeper
    ? ['Speed', 'Acceleration', 'Reactions (GK)', 'Strength']
    : ['Speed', 'Acceleration', 'Stamina', 'Strength'];

  const statGroup2 = isGoalkeeper
    ? ['Control', 'Passing', 'Handling (GK)', 'Tackling']
    : ['Control', 'Passing', 'Shooting', 'Tackling'];

  const statShortLabels = {
  'Speed': 'SPE',
  'Acceleration': 'ACC',
  'Reactions (GK)': 'GKR',
  'Strength': 'STR',
  'Control': 'CON',
  'Passing': 'PAS',
  'Handling (GK)': 'GKH',
  'Tackling': 'TAC',
  'Stamina': 'STA',
  'Shooting': 'SHO'
};

  
    const statRowHTML = group => {
    const isMobile = window.innerWidth <= 1000;
    return `
      <div class="grid grid-cols-4 md:grid-cols-4 gap-2 mb-2">
        ${group.map(stat => {
          const value = normalizeStat(player[stat] || '0');
          const isGKStat = stat.toLowerCase().includes('gk');
          const label = isMobile ? (statShortLabels[stat] || stat) : stat;

          let colorClass = '';
          if (value >= 90) colorClass = 'text-blue-500';
          else if (value >= 80) colorClass = 'text-green-500';
          else if (value >= 70) colorClass = 'text-yellow-400';
          else if (value >= 60) colorClass = 'text-yellow-200';
          else colorClass = 'text-red-500';

          return `
            <div class="stat-item ${isGKStat ? 'gk-stats' : ''}">
              <span class="stat-name">${label.replace('(GK)', '').trim()}</span>
              <span class="stat-value ${colorClass}">${value}</span>
            </div>
          `;
        }).join('')}
      </div>
    `;
  };


  card.innerHTML = `
    <div class="player-rank ${getRankClass(rank)}">#${rank}</div>
    <div class="player-info-section">
      <div class="player-name">${name}</div>
      <div class="player-details">
        ${position ? `<div class="player-info">📍 ${position}</div>` : ''}
        ${country ? `<div class="player-info">
          <img src="${flagUrl}" alt="${country} Flag" class="flag-icon" style="width:16px;height:12px;margin-right:4px;vertical-align:middle;" onerror="this.src='https://via.placeholder.com/16/000000/FFFFFF?text=?'">
          ${country}
        </div>` : ''}
        ${club ? `<div class="player-info">
          <img src="${clubLogoUrl}" alt="${club} Logo" style="width:16px;height:16px;margin-right:4px;vertical-align:middle;" onerror="this.src='https://via.placeholder.com/16?text=?'">
          ${club}
        </div>` : ''}
      </div>
    </div>
    <div class="stats-container">
      ${statRowHTML(statGroup1)}
      ${statRowHTML(statGroup2)}
    </div>
    <div class="flex flex-col items-center">
      <div class="rating-badge ${ratingClass}">
        ${rating}
      </div>
      ${price ? `<div class="player-info price">💰 ${price}${price.includes(' Coins') ? '' : ' Coins'}</div>` : ''}
    </div>
  `;

  card.addEventListener('click', () => {
    showPlayerPopup(player, isGoalkeeper, allPlayers);
  });

  return card;
}
  
    function buildTeam() {
  const priority = document.getElementById('buildPriority').value;
  const preferredCountry = document.getElementById('teamCountryFilter').value;
  const preferredClub = document.getElementById('teamClubFilter').value;
  const preferredContinent = document.getElementById('teamContinentFilter').value;

  const formation = formations[currentFormation];
  const team = [];

  console.log('Building team with formation:', currentFormation, formation);

  const allPositions = [];
  formation.lines.forEach(line => {
    line.positions.forEach(pos => allPositions.push(pos));
  });

  for (const position of allPositions) {
    let positionPlayers;

    if (['most-expensive-exact', 'cheapest-exact'].includes(priority)) {
      positionPlayers = getPlayersForExactPosition(position, preferredCountry, preferredClub, preferredContinent);
    } else if (['most-expensive-sub', 'cheapest-sub'].includes(priority)) {
      positionPlayers = getPlayersForPosition(position, preferredCountry, preferredClub, preferredContinent);
    } else {
      positionPlayers = getPlayersForExactPosition(position, preferredCountry, preferredClub, preferredContinent);
    }

    let sortedPlayers = [];

    switch (priority) {
      case 'most-expensive-sub':
      case 'most-expensive-exact':
        sortedPlayers = positionPlayers.sort((a, b) => parseFloat(b['Price'] || b['Value'] || '0') - parseFloat(a['Price'] || a['Value'] || '0'));
        break;
      case 'cheapest-sub':
      case 'cheapest-exact':
        sortedPlayers = positionPlayers.sort((a, b) => parseFloat(a['Price'] || a['Value'] || '0') - parseFloat(b['Price'] || b['Value'] || '0'));
        break;
      case 'tallest':
        sortedPlayers = positionPlayers.sort((a, b) => parseFloat(b['Height (cm)'] || '0') - parseFloat(a['Height (cm)'] || '0'));
        break;
      case 'shortest':
        sortedPlayers = positionPlayers.sort((a, b) => parseFloat(a['Height (cm)'] || '0') - parseFloat(b['Height (cm)'] || '0'));
        break;
      case 'right-foot':
        sortedPlayers = positionPlayers
          .filter(p => (p['Foot'] || '').toLowerCase().includes('right'))
          .sort((a, b) => parseFloat(b['Price'] || b['Value'] || '0') - parseFloat(a['Price'] || a['Value'] || '0'));
        break;
      case 'left-foot':
        sortedPlayers = positionPlayers
          .filter(p => (p['Foot'] || '').toLowerCase().includes('left'))
          .sort((a, b) => parseFloat(b['Price'] || b['Value'] || '0') - parseFloat(a['Price'] || a['Value'] || '0'));
        break;
      case 'both-feet':
        sortedPlayers = positionPlayers
          .filter(p => (p['Foot'] || '').toLowerCase().includes('both'))
          .sort((a, b) => parseFloat(b['Price'] || b['Value'] || '0') - parseFloat(a['Price'] || a['Value'] || '0'));
        break;
      default:
        sortedPlayers = positionPlayers.sort((a, b) => {
          const ratingA = parseFloat(a[ratingField] || '0');
          const ratingB = parseFloat(b[ratingField] || '0');
          return ratingB - ratingA;
        });
    }

    const selectedPlayer = sortedPlayers.find(player =>
      !team.some(p => p[Object.keys(player)[0]] === player[Object.keys(player)[0]])
    );

    if (selectedPlayer) {
      team.push({ ...selectedPlayer, assignedPosition: position });
      console.log(`✅ Selected ${selectedPlayer[Object.keys(selectedPlayer)[0]]} for ${position}`);
    } else {
      console.warn(`⚠️ No player found for position: ${position}`);
    }
  }

  builtTeam = team;
  displayBuiltTeam();
  updateTeamStats();
  displayFormation();
}


function getFlagURL(countryName) {
  if (!countryName) return 'https://flagcdn.com/w160/un.png';
  const normalized = countryName.trim().toLowerCase();

  // Kiểm tra trong countryMap
  const rawUrl = countryMap[normalized];

  // Nếu không có thì fallback
  if (!rawUrl) return 'https://flagcdn.com/w160/un.png';

  // Nếu là link từ Wikipedia (ví dụ England, Wales, etc), giữ nguyên
  if (rawUrl.includes('upload.wikimedia.org')) return rawUrl;

  // Nếu là link từ flagcdn w40 → đổi thành w160
  return rawUrl.replace('/w40/', '/w160/');
}


function displayFormation() {
  formationDisplay.classList.remove('hidden');
  formationField.innerHTML = '';
  document.getElementById('currentFormationTitle').textContent = currentFormation;

  const formation = formations[currentFormation];
  const positionCounter = {};

  formation.lines.forEach(line => {
    const formationLine = document.createElement('div');
    formationLine.className = `formation-line ${line.line}`;

    line.positions.forEach(position => {
      if (!positionCounter[position]) {
        positionCounter[position] = 0;
      }

      const playersInPosition = builtTeam.filter(p => p.assignedPosition === position);
      const player = playersInPosition[positionCounter[position]];
      positionCounter[position]++;

      const playerPos = document.createElement('div');
      playerPos.className = `player-position ${player ? 'filled' : ''}`;

      if (player) {
        const name = player[Object.keys(player)[0]] || 'Unknown';
        const shortName = name.length > 8
          ? (name.split(' ').length > 1 ? name.split(' ').pop() : name.substring(0, 8))
          : name;

        const country = player['Country'] || player['Nationality'] || '';
        const flagUrl = getFlagURL(country);

        playerPos.innerHTML = `
  <div class="player-grid">
    <div class="flag-image" style="background-image: url('${flagUrl}')"></div>
    <div class="name">${shortName}</div>
  </div>
`;

        playerPos.addEventListener('click', () => {
          displayPlayerDetails(player);
          document.querySelectorAll('.player-position').forEach(p => p.classList.remove('selected'));
          playerPos.classList.add('selected');
        });

        console.log(`Hiển thị ${name} (${shortName}) tại vị trí ${position} (lần xuất hiện ${positionCounter[position]-1})`);
      } else {
        playerPos.innerHTML = `<div class="position-label">${position}</div>`;
        console.log(`Vị trí trống: ${position} (lần xuất hiện ${positionCounter[position]-1})`);
      }

      formationLine.appendChild(playerPos);
    });

    formationField.appendChild(formationLine);
  });

  console.log('Hoàn tất hiển thị đội hình. Đội đã xây:', builtTeam.map(p => ({
    name: p[Object.keys(p)[0]],
    position: p.assignedPosition
  })));
}


function displayPlayerDetails(player) {
  builtTeamDiv.innerHTML = '';
  builtTeamDiv.classList.remove('hidden');
  builtTeamDiv.classList.add('show');
  document.getElementById('builtTeamOverlay').classList.add('show');

  const closeBtn = document.createElement('button');
  closeBtn.className = 'close-btn';
  closeBtn.innerHTML = '×';
  closeBtn.onclick = closePlayerDetails;
  builtTeamDiv.appendChild(closeBtn);

  const playerDetailCard = document.createElement('div');
  playerDetailCard.className = 'player-detail-card';
  
  const flagBackground = document.createElement('div');
  flagBackground.className = 'flag-background';
  const playerImageUrl = player['Img player'] || 'https://via.placeholder.com/300x400?text=No+Image'; // Lấy trực tiếp từ Sheet
  flagBackground.style.backgroundImage = `url('${playerImageUrl}')`;
  playerDetailCard.appendChild(flagBackground);

  const playerOverlay = document.createElement('div');
  playerOverlay.className = 'player-overlay';

  const overallRating = document.createElement('div');
  overallRating.className = 'overall-rating';
  const ratingField = getRatingField();
  overallRating.textContent = player[ratingField] || '83';
  playerOverlay.appendChild(overallRating);

  const heightFoot = document.createElement('div');
  heightFoot.className = 'player-detail-info height-foot';
  const nationality = player['Nationality'] || 'Unknown';
  const flagUrl = countryMap[nationality.toLowerCase()] || 'https://via.placeholder.com/16/000000/FFFFFF?text=?';
  heightFoot.innerHTML = `
    <img src="${flagUrl}" alt="${nationality} Flag" class="flag-icon" onerror="this.src='https://via.placeholder.com/16/000000/FFFFFF?text=?'">
    <div class="height-foot-column">
      <div alt="Height"> ${player['Height (cm)'] || '186'}cm</div>
      <div alt="Foot"> ${player['Foot'] || 'R'}</div>
    </div>
  `;
  playerOverlay.appendChild(heightFoot);

  const position = document.createElement('div');
  position.className = 'player-detail-info position';
  position.style.backgroundColor = '#000';
  position.style.color = '#fff';
  position.style.padding = '2px 6px';
  position.textContent = player['Position'] || 'CM';
  playerOverlay.appendChild(position);

  const stats = document.createElement('div');
  stats.className = 'player-stat-container';
const isGoalkeeper = (player['Position'] || '').toUpperCase().trim() === 'GK';
  const statShortLabels = {
    'Speed': 'SPE',
    'Acceleration': 'ACC',
    'Reactions (GK)': 'GKR',
    'Strength': 'STR',
    'Control': 'CON',
    'Passing': 'PAS',
    'Handling (GK)': 'GKH',
    'Tackling': 'TAC',
    'Stamina': 'STA',
    'Shooting': 'SHO'
  };
  const statsToShow = {
    [statShortLabels['Speed']]: player['Speed'] || '76',
    [statShortLabels['Acceleration']]: player['Acceleration'] || '77',
    [isGoalkeeper ? statShortLabels['Reactions (GK)'] : statShortLabels['Stamina']]: isGoalkeeper ? (player['Reactions (GK)'] || '85') : (player['Stamina'] || '85'),
    [statShortLabels['Strength']]: player['Strength'] || '75',
    [statShortLabels['Control']]: player['Control'] || '86',
    [statShortLabels['Passing']]: player['Passing'] || '82',
    [isGoalkeeper ? statShortLabels['Handling (GK)'] : statShortLabels['Shooting']]: isGoalkeeper ? (player['Handling (GK)'] || '79') : (player['Shooting'] || '79'),
    [statShortLabels['Tackling']]: player['Tackling'] || '78'
  };
  for (const [stat, value] of Object.entries(statsToShow)) {
  const statItem = document.createElement('div');
  statItem.className = 'player-stat-item';

  const numValue = parseFloat(value) || 0;
  let colorClass = '';

  if (numValue >= 90) colorClass = 'text-blue-500';
  else if (numValue >= 80) colorClass = 'text-green-500';
  else if (numValue >= 70) colorClass = 'text-yellow-400';
  else if (numValue >= 60) colorClass = 'text-yellow-200';
  else colorClass = 'text-red-500';

  statItem.innerHTML = `${stat} <span class="player-stat-value ${colorClass}">${value}</span>`;
  stats.appendChild(statItem);
}
  playerOverlay.appendChild(stats);

  const playerNameDiv = document.createElement('div');
  playerNameDiv.className = 'player-info-name';
  playerNameDiv.textContent = player['Name'] || 'Unknown';
  playerOverlay.appendChild(playerNameDiv);

  playerDetailCard.appendChild(playerOverlay);
  builtTeamDiv.appendChild(playerDetailCard);
}

function closePlayerDetails() {
  builtTeamDiv.classList.remove('show');
  builtTeamDiv.classList.add('hidden');
  document.getElementById('builtTeamOverlay').classList.remove('show');
  document.querySelectorAll('.player-position').forEach(p => p.classList.remove('selected'));
  // Khôi phục thông báo mặc định
  displayBuiltTeam();
}
  
    function getPlayersForExactPosition(position, preferredCountry, preferredClub, preferredContinent) {
      // Only find players with exact position match
      const filteredPlayers = allPlayers.filter(player => {
        const playerPos = (player['Position'] || player['Pos'] || '').toUpperCase();
        const playerCountry = player['Nationality'] || player['Country'] || '';
        const playerClub = player['Club'] || '';
        const playerContinent = player['Continent'] || '';
        
        // Check if player position exactly matches the target position
        const positionMatch = playerPos.includes(position.toUpperCase());
        
        // Check other criteria
        const countryMatch = !preferredCountry || playerCountry === preferredCountry;
        const clubMatch = !preferredClub || playerClub === preferredClub;
        const continentMatch = !preferredContinent || playerContinent === preferredContinent;
        
        return positionMatch && countryMatch && clubMatch && continentMatch;
      });
      
      console.log(`Found ${filteredPlayers.length} exact players for position ${position}`);
      return filteredPlayers;
    }
  
    function getPlayersForPosition(position, preferredCountry, preferredClub, preferredContinent) {
      // Use the substitution rules to find suitable players
      const searchPositions = positionSubstitutions[position.toUpperCase()] || [position];
      
      const filteredPlayers = allPlayers.filter(player => {
        const playerPos = (player['Position'] || player['Pos'] || '').toUpperCase();
        const playerCountry = player['Nationality'] || player['Country'] || '';
        const playerClub = player['Club'] || '';
        const playerContinent = player['Continent'] || '';
        
        // Check if player position matches any of the search positions
        const positionMatch = searchPositions.some(searchPos => 
          playerPos.includes(searchPos)
        );
        
        // Check other criteria
        const countryMatch = !preferredCountry || playerCountry === preferredCountry;
        const clubMatch = !preferredClub || playerClub === preferredClub;
        const continentMatch = !preferredContinent || playerContinent === preferredContinent;
        
        return positionMatch && countryMatch && clubMatch && continentMatch;
      });
      
      // Sort by position priority (exact match first)
      filteredPlayers.sort((a, b) => {
        const posA = (a['Position'] || a['Pos'] || '').toUpperCase();
        const posB = (b['Position'] || b['Pos'] || '').toUpperCase();
        const targetPos = position.toUpperCase();
        
        // Exact match gets highest priority
        if (posA.includes(targetPos) && !posB.includes(targetPos)) return -1;
        if (!posA.includes(targetPos) && posB.includes(targetPos)) return 1;
        
        return 0;
      });
      
      console.log(`Found ${filteredPlayers.length} players for position ${position} (with substitutions)`);
      return filteredPlayers;
    }
  
    function getRatingField() {
      const headers = Object.keys(allPlayers[0] || {});
      return headers.find(h => h.toLowerCase().includes('rating') || h.toLowerCase().includes('ovr')) || headers[1];
    }
  
function displayBuiltTeam() {
  builtTeamDiv.innerHTML = '';
  builtTeamDiv.classList.remove('show');
  builtTeamDiv.classList.add('hidden');
  document.getElementById('builtTeamOverlay').classList.remove('show');

  if (builtTeam.length === 0) {
    builtTeamDiv.classList.remove('hidden');
    builtTeamDiv.innerHTML = `
      <div class="no-results">
        <div class="no-results-icon">⚠️</div>
        <h3 class="text-2xl font-bold mb-3">Không thể xây dựng đội</h3>
        <p class="text-lg">Không thể xây dựng đội với tiêu chí hiện tại</p>
      </div>
    `;
    return;
  }

  builtTeamDiv.classList.remove('hidden');
  builtTeamDiv.innerHTML = `
    <div class="no-results">
      <h3 class="text-2xl font-bold mb-3 text-white">Đội hình ${currentFormation} của bạn</h3>
      <p class="text-lg">Nhấp vào một cầu thủ trong sơ đồ đội hình để xem chi tiết.</p>
    </div>
  `;
}

  // Hiển thị thông báo mặc định sau khi xây dựng đội
  builtTeamDiv.innerHTML = `
    <div class="no-results">
      <h3 class="text-2xl font-bold mb-3 text-white">Đội hình ${currentFormation} của bạn</h3>
      <p class="text-lg">Nhấp vào một cầu thủ trong sơ đồ đội hình để xem chi tiết.</p>
    </div>
  `;

  
    function updateTeamStats() {
      if (builtTeam.length === 0) {
        teamStats.classList.add('hidden');
        return;
      }

      function resetTeamBuilder() {
  // Reset built team
  builtTeam = [];
  
  // Hide formation display
  formationDisplay.classList.add('hidden');
  
  // Hide built team display
  builtTeamDiv.classList.add('hidden');
  builtTeamDiv.innerHTML = '';
  
  // Hide team stats
  teamStats.classList.add('hidden');
  
  // Reset formation to default
  currentFormation = '4-3-3';
  
  // Reset formation buttons to default state
  document.querySelectorAll('.formation-btn').forEach(btn => {
    btn.classList.remove('active');
    if (btn.textContent === '4-3-3') {
      btn.classList.add('active');
    }
  });
  
  // Update formation variants
  updateFormationVariants('4-3-3');
  
  console.log('Team builder reset completed');
}


      teamStats.classList.remove('hidden');

      const ratingField = getRatingField();
      const ratings = builtTeam.map(p => parseFloat(p[ratingField] || '0'));
      const costs = builtTeam.map(p => parseFloat(p['Price'] || p['Value'] || '0'));
      const countries = [...new Set(builtTeam.map(p => p['Nationality'] || p['Country']).filter(c => c))];
      const clubs = [...new Set(builtTeam.map(p => p['Club']).filter(c => c))];

      const avgRating = ratings.reduce((a, b) => a + b, 0) / ratings.length;
      const totalCost = costs.reduce((a, b) => a + b, 0);

      document.getElementById('teamRating').textContent = avgRating.toFixed(1);
      document.getElementById('teamCost').textContent = totalCost.toFixed(0) ;
      document.getElementById('teamCountries').textContent = countries.length;
      document.getElementById('teamClubs').textContent = clubs.length;
    }
  
    function showContent() {
      loading.classList.add('hidden');
      error.classList.add('hidden');
      playersGrid.classList.remove('hidden');
    }
  
    function showError() {
      loading.classList.add('hidden');
      error.classList.remove('hidden');
      playersGrid.classList.add('hidden');
    }

    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwdwAPuIlNbZfCblOJSTiqrVkMHbIZHdbHSX6tDGifGEmw_QBz-j-tpYQUad7G4CDXE/exec'; // CẬP NHẬT URL NÀY

document.addEventListener('DOMContentLoaded', function() {
    console.log('Page loaded, initializing form...');
document.getElementById('position').addEventListener('change', function () {
  const isGK = this.value === 'GK';

// Cặp stamina <-> reactions
const input1 = document.getElementById('attrInput1');
const label1 = document.getElementById('attrLabel1');
const value1 = document.getElementById('attrValue1');

label1.textContent = isGK ? 'Reactions (GK)' : 'Stamina';
input1.name = isGK ? 'reactions' : 'stamina';
// KHÔNG thay đổi input1.id

value1.className = isGK ? 'player-range-value gk-value' : 'player-range-value';
// KHÔNG thay đổi value1.id

// Cặp shooting <-> handling
const input2 = document.getElementById('attrInput2');
const label2 = document.getElementById('attrLabel2');
const value2 = document.getElementById('attrValue2');

label2.textContent = isGK ? 'Handling (GK)' : 'Shooting';
input2.name = isGK ? 'handling' : 'shooting';
// KHÔNG thay đổi input2.id

value2.className = isGK ? 'player-range-value gk-value' : 'player-range-value';
// KHÔNG thay đổi value2.id
});
    
    const donateTab = document.getElementById('donateTab');
    if (donateTab) {
        console.log('donateTab found, kept hidden by default');
    }
    
    const rangeInputs = document.querySelectorAll('.player-range-input');
    console.log('Found range inputs:', rangeInputs.length);
    
rangeInputs.forEach(input => {
    const valueDisplay = input.parentElement.querySelector('.player-range-value');
    
    input.addEventListener('input', function() {
        if (valueDisplay) {
            valueDisplay.textContent = this.value;
        }
        console.log(`Range ${input.id} changed to:`, this.value);
    });

    if (valueDisplay) {
        valueDisplay.textContent = input.value;
    }
});


    const allInputs = document.querySelectorAll('.player-form-input, .player-form-select, .player-range-input');
    console.log('Found all inputs:', allInputs.length);
    
    allInputs.forEach(input => {
        input.addEventListener('change', function() {
            console.log(`Input ${this.id || this.name} changed to:`, this.value);
        });
    });
});

document.getElementById('playerForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    console.log('=== FORM SUBMISSION STARTED ===');
    
    if (!confirm('Are you sure you want to submit this player data?')) return;
    
    const submitBtn = document.querySelector('.player-submit-btn');
    const originalText = submitBtn.textContent;
    
    submitBtn.textContent = 'Creating Player...';
    submitBtn.disabled = true;
    submitBtn.style.opacity = '0.7';
    
    try {
        const formData = new FormData(this);
        const playerData = {
            timestamp: new Date().toLocaleString('vi-VN')
        };
        
        for (let [key, value] of formData.entries()) {
            playerData[key] = value;
            console.log(`Form field ${key}:`, value);
        }
        
        const rangeInputs = document.querySelectorAll('.player-range-input');
        rangeInputs.forEach(input => {
            if (input.name) {
                playerData[input.name] = input.value;
                console.log(`Range ${input.name}:`, input.value);
            }
        });
        
        console.log('=== FINAL PLAYER DATA ===');
        console.log(JSON.stringify(playerData, null, 2));
        
        if (!playerData.name || !playerData.position) {
            throw new Error('Name and Position are required fields');
        }
        
        console.log('=== SENDING TO GOOGLE APPS SCRIPT ===');
        console.log('URL:', SCRIPT_URL);
        
        // Thử với CORS trước
        try {
            const response = await fetch(SCRIPT_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(playerData)
            });
            
            if (!response.ok) {
                throw new Error(`Server error: ${response.status}`);
            }
            
            const result = await response.json();
            
            if (result.result === 'success') {
                submitBtn.textContent = 'Player Created! ✅';
                submitBtn.style.background = 'linear-gradient(135deg, #10b981 0%, #059669 100%)';
                
                this.reset();
                
                rangeInputs.forEach(input => {
                    input.value = 50;
                    const valueDisplay = document.getElementById(input.id + 'Value');
                    if (valueDisplay) {
                        valueDisplay.textContent = '50';
                    }
                });
                
                showNotification(`Player profile created! (Row ${result.rowNumber})`, 'success');
            } else {
                throw new Error(result.message || 'Unknown server error');
            }
        } catch (error) {
            console.log('CORS fetch failed, trying no-cors...');
            // Thử lại với no-cors nếu CORS thất bại
            const response = await fetch(SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(playerData)
            });
            // Với no-cors, không có phản hồi chi tiết, giả định thành công
            submitBtn.textContent = 'Player Created! ✅';
            submitBtn.style.background = 'linear-gradient(135deg, #10b981 0%, #059669 100%)';
            
            this.reset();
            
            rangeInputs.forEach(input => {
                input.value = 50;
                const valueDisplay = document.getElementById(input.id + 'Value');
                if (valueDisplay) {
                    valueDisplay.textContent = '50';
                }
            });
            
            showNotification('Player profile sent!', 'success');
        }
    } catch (error) {
        console.error('=== SUBMISSION ERROR ===');
        console.error('Error:', error);
        
        submitBtn.textContent = 'Error! Try Again';
        submitBtn.style.background = 'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)';
        
        let errorMessage = 'Error creating player: ';
        if (error.message.includes('required fields')) {
            errorMessage += 'Please fill in all required fields.';
        } else if (error.message.includes('NetworkError') || error.message.includes('Failed to fetch')) {
            errorMessage += 'Network error. Check your internet connection or Apps Script URL.';
        } else if (error.message.includes('Server error')) {
            errorMessage += 'Server error. Please check Apps Script deployment.';
        } else {
            errorMessage += error.message;
        }
        
        showNotification(errorMessage, 'error');
    }
    
    setTimeout(() => {
        submitBtn.textContent = originalText;
        submitBtn.disabled = false;
        submitBtn.style.opacity = '1';
        submitBtn.style.background = 'linear-gradient(135deg, #22c55e 0%, #16a34a 100%)';
    }, 3000);
});

function showNotification(message, type = 'success') {
    console.log(`Notification (${type}):`, message);
    
    const existingNotification = document.querySelector('.notification');
    if (existingNotification) {
        existingNotification.remove();
    }
    
    const notification = document.createElement('div');
    notification.className = `notification notification-${type}`;
    notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 10000;
        padding: 15px 20px;
        border-radius: 8px;
        color: white;
        font-weight: 500;
        max-width: 400px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        background: ${type === 'success' ? 'linear-gradient(135deg, #10b981, #059669)' : 'linear-gradient(135deg, #ef4444, #dc2626)'};
        animation: slideIn 0.3s ease-out;
    `;
    
    notification.innerHTML = `
        <div style="display: flex; align-items: center; gap: 10px;">
            <span style="font-size: 18px;">${type === 'success' ? '✅' : '❌'}</span>
            <span style="flex: 1;">${message}</span>
            <button onclick="this.parentElement.parentElement.remove()" 
                    style="background: none; border: none; color: white; font-size: 20px; cursor: pointer; padding: 0;">×</button>
        </div>
    `;
    
    const style = document.createElement('style');
    style.textContent = `
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
    `;
    document.head.appendChild(style);
    
    document.body.appendChild(notification);
    
    setTimeout(() => {
        if (notification.parentElement) {
            notification.style.animation = 'slideIn 0.3s ease-out reverse';
            setTimeout(() => notification.remove(), 300);
        }
    }, 7000);
}

function debugFormData() {
    const form = document.getElementById('playerForm');
    const formData = new FormData(form);
    const data = {};
    
    for (let [key, value] of formData.entries()) {
        data[key] = value;
    }
    
    console.log('Current form data:', data);
    return data;
}
    
    document.getElementById('position').addEventListener('change', function () {
  const isGK = this.value === 'GK';

  // Thủ môn
  document.getElementById('reactionsGroup').style.display = isGK ? 'block' : 'none';
  document.getElementById('handlingGroup').style.display = isGK ? 'block' : 'none';

  // Cầu thủ thường
  document.getElementById('staminaGroup').style.display = isGK ? 'none' : 'block';
  document.getElementById('shootingGroup').style.display = isGK ? 'none' : 'block';
});

  
    // Event listeners
    searchInput.addEventListener('input', applyFilters);
    countryFilter.addEventListener('input', applyFilters);
    priceFilter.addEventListener('change', applyFilters);
    document.getElementById('positionFilter').addEventListener('change', applyFilters);
    document.getElementById('sortFilter').addEventListener('change', applyFilters);
    document.getElementById('clubFilter').addEventListener('input', applyFilters);

    clearFilters.addEventListener('click', () => {
      searchInput.value = '';
      countryFilter.value = '';
      priceFilter.value = '';
      document.getElementById('positionFilter').value = '';
      document.getElementById('sortFilter').value = 'rating-high';
      applyFilters();
    });

    buildTeamBtn.addEventListener('click', buildTeam);
  
    // Initialize with 4-3-3 and show formation immediately
    window.onload = () => {
      loadData();
      updateFormationVariants('4-3-3');
    };
  </script>
</body>
</html>
