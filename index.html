<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>DLS 2025 - Player Stats & Team Builder</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #000000 0%, #1a1a1a 25%, #0f1419 50%, #1a1a1a 75%, #000000 100%);
      min-height: 100vh;
      position: relative;
      overflow-x: hidden;
      color: #ffffff;
    }

    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: 
        radial-gradient(circle at 30% 20%, rgba(34, 197, 94, 0.15) 0%, transparent 50%),
        radial-gradient(circle at 70% 80%, rgba(16, 185, 129, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 20% 70%, rgba(5, 150, 105, 0.1) 0%, transparent 50%);
      pointer-events: none;
      z-index: -1;
    }

.hero-section {
  background: linear-gradient(135deg, rgba(0, 0, 0, 0.5), rgba(15, 20, 25, 0.4));
  backdrop-filter: blur(12px);
  border: 1px solid rgba(34, 197, 94, 0.15);
  border-radius: 20px;
  padding: 2rem;
  margin-bottom: 2rem;
  position: relative;
  overflow: hidden;
  text-align: center;
}

.hero-section::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(45deg, rgba(34, 197, 94, 0.05), rgba(16, 185, 129, 0.05));
  animation: pulse 4s ease-in-out infinite;
  z-index: 0;
}

@keyframes pulse {
  0%, 100% { opacity: 0.3; }
  50% { opacity: 0.7; }
}

.hero-title {
  font-size: 2.25rem; /* nh·ªè h∆°n tr∆∞·ªõc */
  font-weight: 800;
  background: linear-gradient(135deg, #22c55e, #10b981, #059669);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  margin-bottom: 0.5rem;
  position: relative;
  z-index: 1;
}

.hero-subtitle {
  font-size: 1rem; /* g·ªçn h∆°n */
  font-weight: 300;
  color: rgba(255, 255, 255, 0.65);
  position: relative;
  z-index: 1;
}


    .nav-tabs {
      display: flex;
      gap: 1rem;
      margin-bottom: 2rem;
      justify-content: center;
    }

    .nav-tab {
      background: rgba(0, 0, 0, 0.6);
      border: 1px solid rgba(34, 197, 94, 0.2);
      border-radius: 12px;
      padding: 1rem 2rem;
      color: rgba(255, 255, 255, 0.7);
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 600;
    }

    .nav-tab.active {
      background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
      color: white;
      border-color: #22c55e;
    }

    .nav-tab:hover:not(.active) {
      border-color: rgba(34, 197, 94, 0.5);
      color: rgba(255, 255, 255, 0.9);
    }

    .filters-section {
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(34, 197, 94, 0.2);
      border-radius: 20px;
      padding: 2rem;
      margin-bottom: 2rem;
    }

    .filter-group {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      align-items: center;
    }

    .filter-input, .filter-select {
      background: rgba(0, 0, 0, 0.7);
      border: 1px solid rgba(34, 197, 94, 0.3);
      border-radius: 12px;
      padding: 0.75rem 1rem;
      color: white;
      font-weight: 500;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
    }

    .filter-input:focus, .filter-select:focus {
      outline: none;
      border-color: #22c55e;
      box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.2);
    }

    .filter-input::placeholder {
      color: rgba(255, 255, 255, 0.5);
    }

    .filter-select option {
      background: #1a1a1a;
      color: white;
    }

    .clear-filters, .build-team-btn {
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      color: white;
      border: none;
      border-radius: 12px;
      padding: 0.75rem 1.5rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .build-team-btn {
      background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
    }

    .clear-filters:hover, .build-team-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(239, 68, 68, 0.4);
    }

    .build-team-btn:hover {
      box-shadow: 0 8px 25px rgba(34, 197, 94, 0.4);
    }

    .player-card {
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(34, 197, 94, 0.2);
      border-radius: 20px;
      padding: 1.5rem;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
      display: flex;
      align-items: center;
      gap: 1.5rem;
      min-height: 140px;
    }

    .player-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, rgba(34, 197, 94, 0.1), rgba(16, 185, 129, 0.1));
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .player-card:hover::before {
      opacity: 1;
    }

    .player-card:hover {
      transform: translateY(-4px);
      border-color: rgba(34, 197, 94, 0.5);
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4);
    }

    .player-rank {
      background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
      color: #000;
      font-weight: 900;
      font-size: 1.2rem;
      padding: 0.5rem 1rem;
      border-radius: 15px;
      text-align: center;
      min-width: 60px;
      box-shadow: 0 4px 15px rgba(251, 191, 36, 0.4);
      flex-shrink: 0;
      position: relative;
      z-index: 2;
    }

    .player-rank.top10 {
      background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
      color: white;
      box-shadow: 0 4px 15px rgba(220, 38, 38, 0.4);
    }

    .player-rank.top50 {
      background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%);
      color: white;
      box-shadow: 0 4px 15px rgba(124, 58, 237, 0.4);
    }

    .player-info-section {
      flex: 1;
      min-width: 0;
      position: relative;
      z-index: 1;
    }

    .player-name {
      font-size: 1.5rem;
      font-weight: 700;
      color: white;
      margin-bottom: 0.5rem;
      word-wrap: break-word;
      line-height: 1.3;
    }

    .player-details {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      margin-bottom: 1rem;
    }

    .player-info {
      font-size: 0.875rem;
      color: rgba(255, 255, 255, 0.6);
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }

    .rating-badge {
      background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
      color: white;
      font-weight: 900;
      font-size: 2rem;
      padding: 1rem 1.5rem;
      border-radius: 20px;
      text-align: center;
      min-width: 100px;
      box-shadow: 0 8px 25px rgba(34, 197, 94, 0.3);
      flex-shrink: 0;
      position: relative;
      z-index: 1;
    }

    .rating-legendary {
      background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
      box-shadow: 0 8px 25px rgba(251, 191, 36, 0.4);
    }

    .rating-elite {
      background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
      box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
    }

    .rating-good {
      background: linear-gradient(135deg, #cd7f32 0%, #b8860b 100%);
      box-shadow: 0 8px 25px rgba(205, 127, 50, 0.4);
    }

    .rating-basic {
      background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
      color: #374151;
      box-shadow: 0 8px 25px rgba(156, 163, 175, 0.4);
    }

    .stats-container {
      flex: 2;
      position: relative;
      z-index: 1;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 0.75rem;
    }

    .stat-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.5rem 0.75rem;
      background: rgba(34, 197, 94, 0.1);
      border-radius: 10px;
      border: 1px solid rgba(34, 197, 94, 0.2);
    }

    .stat-name {
      font-weight: 600;
      color: rgba(255, 255, 255, 0.8);
      font-size: 0.8rem;
    }

    .stat-value {
      font-weight: 700;
      color: white;
      font-size: 0.9rem;
    }

    .gk-stats {
      border-color: rgba(59, 130, 246, 0.3);
      background: rgba(59, 130, 246, 0.1);
    }

    /* Team Builder Styles */
    .team-builder-section {
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(34, 197, 94, 0.2);
      border-radius: 20px;
      padding: 2rem;
      margin-bottom: 2rem;
    }

    .formation-selector {
      display: flex;
      gap: 1rem;
      margin-bottom: 2rem;
      flex-wrap: wrap;
    }

    .formation-btn {
      background: rgba(0, 0, 0, 0.7);
      border: 1px solid rgba(34, 197, 94, 0.3);
      border-radius: 12px;
      padding: 0.75rem 1.5rem;
      color: white;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 600;
    }

    .formation-btn.active {
      background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
      border-color: #22c55e;
    }

    .formation-btn:hover:not(.active) {
      border-color: rgba(34, 197, 94, 0.5);
    }

    .team-criteria {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    .criteria-item {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      min-height: 80px;
    }

    .criteria-label {
      font-weight: 600;
      color: rgba(255, 255, 255, 0.9);
      font-size: 1rem;
      white-space: nowrap;
      overflow: visible;
      line-height: 1.4;
    }

    .team-stats {
      background: rgba(34, 197, 94, 0.1);
      border: 1px solid rgba(34, 197, 94, 0.2);
      border-radius: 16px;
      padding: 1.5rem;
      margin-bottom: 2rem;
    }

    .team-stats h3 {
      color: #22c55e;
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 1rem;
      text-align: center;
    }

    .team-stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 1rem;
    }

    .team-stat {
      text-align: center;
      padding: 0.75rem;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 10px;
    }

    .team-stat-value {
      font-size: 1.5rem;
      font-weight: 700;
      color: #22c55e;
    }

    .team-stat-label {
      font-size: 0.875rem;
      color: rgba(255, 255, 255, 0.7);
      margin-top: 0.25rem;
    }

    /* Formation Display */
    .formation-container {
      background: 
        linear-gradient(135deg, rgba(34, 197, 94, 0.1) 0%, rgba(16, 185, 129, 0.05) 100%),
        linear-gradient(45deg, 
          rgba(34, 197, 94, 0.03) 25%, 
          transparent 25%, 
          transparent 75%, 
          rgba(34, 197, 94, 0.03) 75%);
      background-size: 100% 100%, 40px 40px;
      border: 2px solid rgba(34, 197, 94, 0.3);
      border-radius: 24px;
      padding: 2rem;
      margin: 2rem 0;
      position: relative;
      overflow: hidden;
    }

    .formation-container::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 0;
      right: 0;
      height: 2px;
      background: linear-gradient(90deg, transparent, rgba(34, 197, 94, 0.4), transparent);
      transform: translateY(-50%);
    }

    .formation-container::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 120px;
      height: 120px;
      border: 2px solid rgba(34, 197, 94, 0.3);
      border-radius: 50%;
      transform: translate(-50%, -50%);
    }

    .formation-display {
      display: flex;
      flex-direction: column;
      gap: 2rem;
      align-items: center;
      position: relative;
      z-index: 10;
    }

    .formation-line {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 1.5rem;
      flex-wrap: wrap;
    }

    .formation-line.defense {
      order: 1;
    }

    .formation-line.midfield {
      order: 2;
    }

    .formation-line.attack {
      order: 3;
    }

    .player-position {
      width: 80px;
      height: 80px;
      border-radius: 12px;
      background: linear-gradient(135deg, rgba(0, 0, 0, 0.7) 0%, rgba(31, 41, 55, 0.8) 100%);
      border: 3px solid rgba(34, 197, 94, 0.6);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 600;
      font-size: 0.7rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
      backdrop-filter: blur(10px);
      padding: 0.25rem;
      line-height: 1.1;
    }

    .player-position:hover {
      transform: translateY(-4px) scale(1.05);
      border-color: #22c55e;
      box-shadow: 0 10px 30px rgba(34, 197, 94, 0.4);
    }

    .player-position.filled {
      background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
      border-color: #ffffff;
    }

    .player-position .name {
      font-size: 0.7rem;
      font-weight: 700;
      text-overflow: ellipsis;
      overflow: hidden;
      white-space: nowrap;
      width: 100%;
      text-align: center;
      padding: 0 0.25rem;
      line-height: 1.1;
    }

    .player-position .position-label {
      font-size: 0.65rem;
      font-weight: 600;
      color: rgba(255, 255, 255, 0.8);
      line-height: 1.1;
    }

    .loading-spinner {
      border: 3px solid rgba(34, 197, 94, 0.3);
      border-top: 3px solid #22c55e;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
      margin: 2rem auto;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .no-results {
      text-align: center;
      padding: 4rem 2rem;
      color: rgba(255, 255, 255, 0.6);
    }

    .no-results-icon {
      font-size: 4rem;
      margin-bottom: 1rem;
    }

    .error-message {
      background: rgba(239, 68, 68, 0.1);
      border: 1px solid rgba(239, 68, 68, 0.3);
      border-radius: 16px;
      padding: 2rem;
      margin: 2rem 0;
      color: #fca5a5;
      text-align: center;
    }

    .fade-in {
      animation: fadeIn 0.6s ease-out forwards;
      opacity: 0;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .hidden {
      display: none !important;
    }

    /* Donate Section Styles */
.donate-container {
  background: rgba(0, 0, 0, 0.6);
  border: 1px solid rgba(34, 197, 94, 0.2);
  border-radius: 20px;
  padding: 2rem;
  text-align: center;
  backdrop-filter: blur(20px);
  margin-bottom: 2rem;
}

.donate-title {
  font-size: 1.5rem;
  font-weight: 700;
  color: #22c55e;
  margin-bottom: 1.5rem;
}

.qr-wrapper {
  display: flex;
  justify-content: center;
  gap: 2rem;
  flex-wrap: wrap;
}

.qr-box {
  background: rgba(0, 0, 0, 0.7);
  border: 1px solid rgba(34, 197, 94, 0.2);
  border-radius: 16px;
  padding: 1rem;
  text-align: center;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
  transition: transform 0.3s ease;
}

.qr-box img {
  width: 160px;
  height: auto;
  border-radius: 8px;
  margin-bottom: 0.5rem;
}

.qr-box p {
  color: rgba(255, 255, 255, 0.8);
  font-weight: 500;
  font-size: 1rem;
}

.qr-box:hover {
  transform: translateY(-4px);
  border-color: #22c55e;
  box-shadow: 0 8px 30px rgba(34, 197, 94, 0.3);
}

#builtTeam {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background-color: #fff;
  padding: 10px;
  border-radius: 10px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
  z-index: 1000;
  width: 300px;
  text-align: center;
  font-family: Arial, sans-serif;
  display: none;
  background: linear-gradient(to bottom, #f5e050, #d2b400);
  color: #000;
  overflow: hidden;
}

#builtTeam.show {
  display: block;
}

#builtTeamOverlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.5);
  z-index: 999;
  display: none;
}

#builtTeamOverlay.show {
  display: block;
}

.close-btn {
  position: absolute;
  top: 5px;
  right: 5px;
  background-color: #ff4444;
  color: white;
  border: none;
  border-radius: 50%;
  width: 30px;
  height: 30px;
  font-size: 18px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 10; /* Th√™m z-index cao ƒë·ªÉ n√∫t hi·ªÉn th·ªã tr√™n t·∫•t c·∫£ */
}

.close-btn:hover {
  background-color: #cc0000;
}

.player-detail-card {
  position: relative;
  width: 100%;
  height: 400px;
  background: no-repeat center;
  background-size: cover;
  border: 2px solid #000;
  overflow: hidden;
}

.flag-background {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-size: cover;
  z-index: 1; /* Z-index th·∫•p cho l√° c·ªù */
}

.player-overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(to bottom, rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.7));
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  padding: 10px;
  z-index: 2; /* Z-index trung b√¨nh cho overlay */
}

.overall-rating {
  font-size: 24px;
  font-weight: bold;
  color: #fff;
  background: #ffd700;
  border: 2px solid #000;
  border-radius: 50%;
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  position: absolute;
  top: 10px;
  left: 10px;
  z-index: 3; /* Z-index cho rating */
}

.player-stat-container {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 5px;
  position: absolute;
  bottom: 50px;
  left: 50%;
  transform: translateX(-50%);
  width: 90%;
  z-index: 3; /* Z-index cho stats */
}

.player-stat-item {
  background-color: rgba(255, 255, 255, 0.8);
  padding: 2px 6px;
  border-radius: 3px;
  font-size: 12px;
  color: #000;
  display: flex;
  align-items: center;
  width: 55px;
}

.player-stat-value {
  font-weight: bold;
  margin-left: 3px;
}

.player-info-name {
  font-size: 18px;
  font-weight: bold;
  background: #ffd700;
  padding: 5px;
  border-top: 2px solid #000;
  position: absolute;
  bottom: 0;
  left: 0;
  width: 100%;
  text-align: center;
  z-index: 3; /* Z-index cho t√™n */
}

.player-detail-info {
  font-size: 12px;
  color: #fff;
  display: flex;
  align-items: center;
  gap: 5px;
}

.height-foot {
  position: absolute;
  display: grid;
  top: 85px;
  left: 10px;
  z-index: 3; /* Z-index cho th√¥ng tin chi·ªÅu cao */
  width: 40px;
}

.height-foot-column {
  display: grid;
 text-align: center;
  align-items: center;
  justify-content: center;
}

.height-foot-column div {
  display: flex;
  align-items: center;
  gap: 5px;
   width: 40px;
       justify-content: center;

}

.flag-icon {
 width: 40px;
}

.position {
  position: absolute;
  top: 55px;
  width: 40px; /* √î nh·ªè h∆°n */
  text-align: center;
  align-items: center;
  justify-content: center;
  z-index: 3; /* Z-index cho v·ªã tr√≠ */
}

    /* Responsive Design */
/* Responsive Design - Mobile First */
@media (max-width: 768px) {

  /* Tabs */
  .nav-tabs {
    flex-direction: column;
    gap: 0.5rem;
    padding: 0 1rem;
  }

  .nav-tab {
    width: 100%;
    padding: 0.75rem 1rem;
    font-size: 0.95rem;
    text-align: center;
  }

  /* Filters */
  .filters-section {
    padding: 1rem;
    margin-bottom: 1rem;
  }

  .filter-group {
    flex-direction: column;
    gap: 0.75rem;
  }

  /* Formation Selector */
  .formation-selector {
    flex-direction: column;
    gap: 0.75rem;
  }

  .formation-btn {
    width: 100%;
    font-size: 0.9rem;
    padding: 0.5rem 1rem;
  }

  /* Team Builder */
  .team-builder-section {
    padding: 1.25rem 1rem;
  }

  .team-criteria {
    grid-template-columns: 1fr;
    gap: 1rem;
  }

  .criteria-label {
    font-size: 0.9rem;
  }

  .team-stats {
    padding: 1rem;
  }

  .team-stats h3 {
    font-size: 1.25rem;
  }

  .team-stats-grid {
    grid-template-columns: repeat(2, 1fr);
    gap: 0.75rem;
  }

  .team-stat {
    padding: 0.5rem;
  }

  .team-stat-value {
    font-size: 1.25rem;
  }

  /* Formation Display */
  .formation-container {
    padding: 1.25rem 1rem;
    margin: 1rem 0;
    border-radius: 16px;
  }

  .formation-container::before {
    height: 1px;
  }

  .formation-container::after {
    width: 80px;
    height: 80px;
    border-width: 1.5px;
  }

  .formation-display {
    gap: 1.25rem;
  }

  .formation-line {
    gap: 1rem;
    flex-wrap: wrap;
  }

  .player-position {
    width: 60px;
    height: 60px;
    font-size: 0.6rem;
    padding: 0.25rem;
    border-radius: 10px;
  }

  .player-position .name,
  .player-position .position-label {
    font-size: 0.55rem;
  }

  /* Player Card */
  .player-card {
    flex-direction: column;
    align-items: center;
    text-align: center;
    padding: 1rem;
    gap: 0.75rem;
  }

  .player-rank {
    font-size: 0.9rem;
    padding: 0.25rem 0.5rem;
    border-radius: 6px;
  }

  .player-info-section {
    flex-direction: column;
    align-items: center;
    text-align: center;
  }

  .stats-container {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    width: 100%;
    gap: 0.5rem;
    margin-top: 0.5rem;
  }

  .stat-item {
    padding: 0.5rem;
    font-size: 0.75rem;
  }

  .rating-badge {
    font-size: 1.25rem;
    padding: 0.5rem 1rem;
    border-radius: 10px;
    margin-top: 0.5rem;
  }

  /* Donate */
  .qr-wrapper {
    flex-direction: column;
    gap: 1rem;
  }

  .qr-box img {
    width: 100%;
    max-width: 200px;
  }

  /* Modal */
  #builtTeam {
    width: 90%;
    padding: 1rem;
    font-size: 0.95rem;
  }

  .close-btn {
    width: 24px;
    height: 24px;
    font-size: 14px;
  }

}


  </style>
</head>
<body>
<div class="container mx-auto px-4 py-8 max-w-7xl">
  <!-- Hero Section -->
  <div class="hero-section">
    <h1 class="hero-title">DLS 2025</h1> 
    <p class="hero-subtitle">Players Data & Build Formation</p> 
  </div>



    <!-- Navigation Tabs -->
<div class="nav-tabs">
  <div class="nav-tab active" onclick="switchTab('players', this)">
    üîç Players Database
  </div>
  <div class="nav-tab" onclick="switchTab('team-builder', this)">
    ‚öΩ Team Builder
  </div>
  <div class="nav-tab" onclick="switchTab('donate', this)">
    üíñ Donate
  </div>
</div>

    <!-- Players Tab -->
    <div id="playersTab">
      <!-- Filters Section -->
      <div class="filters-section">
        <div class="filter-group">
          <input 
            type="text" 
            id="searchInput" 
            placeholder="üîç Search players..." 
            class="filter-input flex-1 min-w-64"
          />
          
          <input 
            type="text"
            id="countryFilter"
            placeholder="üåç Filter by Country..."
            class="filter-input"
          />

          <select id="positionFilter" class="filter-select">
            <option value="">‚öΩ All Positions</option>
            <option value="GK">GK - Goalkeeper</option>
            <option value="CB">CB - Center Back</option>
            <option value="LB">LB - Left Back</option>
            <option value="RB">RB - Right Back</option>
            <option value="LWB">LWB - Left Wing Back</option>
            <option value="RWB">RWB - Right Wing Back</option>
            <option value="DM">DM - Defensive Midfielder</option>
            <option value="CM">CM - Central Midfielder</option>
            <option value="AM">AM - Attacking Midfielder</option>
            <option value="LM">LM - Left Midfielder</option>
            <option value="RM">RM - Right Midfielder</option>
            <option value="LW">LW - Left Winger</option>
            <option value="RW">RW - Right Winger</option>
            <option value="CF">CF - Center Forward</option>
            <option value="SS">SS - Second Striker</option>
          </select>

          <select id="priceFilter" class="filter-select">
            <option value="">üí∞ All Prices</option>
            <option value="0-100">Under 100</option>
            <option value="100-500">100 - 500</option>
            <option value="500-1000">500 - 1000</option>
            <option value="1000-1500">1000 - 1500</option>
            <option value="1500-2000">1500 - 2000</option>
            <option value="2000-2500">2000 - 2500</option>
            <option value="2500+">Over 2500</option>
          </select>

          <select id="sortFilter" class="filter-select">
            <option value="rating-high">üîÑ Rating (High to Low)</option>
            <option value="rating-low">Rating (Low to High)</option>
            <option value="price-high">Price (High to Low)</option>
            <option value="price-low">Price (Low to High)</option>
            <option value="name">Name (A-Z)</option>
          </select>
          
          <button id="clearFilters" class="clear-filters">
            Clear Filters
          </button>
        </div>
      </div>

      <!-- Players Grid -->
      <div id="playersGrid" class="flex flex-col gap-4 hidden"></div>
    </div>

    <!-- Team Builder Tab -->
    <div id="teamBuilderTab" class="hidden">
      <div class="team-builder-section">
        <h2 class="text-3xl font-bold text-center mb-6 text-white">üèÜ Build Your Ultimate Team</h2>
        
        <!-- Formation Selector -->
        <div class="formation-selector">
          <button class="formation-btn active" onclick="selectFormation('4-3-3')">4-3-3</button>
          <button class="formation-btn" onclick="selectFormation('4-4-2')">4-4-2</button>
          <button class="formation-btn" onclick="selectFormation('4-5-1')">4-5-1</button>
          <button class="formation-btn" onclick="selectFormation('5-3-2')">5-3-2</button>
          <button class="formation-btn" onclick="selectFormation('5-2-3')">5-2-3</button>
          <button class="formation-btn" onclick="selectFormation('5-4-1')">5-4-1</button>
          <button class="formation-btn" onclick="selectFormation('3-5-2')">3-5-2</button>
          <button class="formation-btn" onclick="selectFormation('3-4-3')">3-4-3</button>
        </div>

        <!-- Formation Variants -->
        <div id="formationVariants" class="formation-selector" style="margin-top: 1rem; border-top: 1px solid rgba(34, 197, 94, 0.2); padding-top: 1rem;">
          <!-- Variants will be populated by JavaScript -->
        </div>

        <!-- Team Building Criteria -->
<div class="team-criteria">
  <div class="criteria-item">
    <label class="criteria-label">üéØ Priority</label>
<select id="buildPriority" class="filter-select">
<option value="most-expensive-sub">Most Expensive (with substitutions)</option>
<option value="cheapest-sub">Cheapest (with substitutions)</option>
<option value="most-expensive-exact">Most Expensive (exact position)</option>
<option value="cheapest-exact">Cheapest (exact position)</option>
<option value="tallest">Tallest Height</option>
<option value="shortest">Shortest Height</option>
<option value="right-foot">Right Footed</option>
<option value="left-foot">Left Footed</option>
<option value="both-feet">Both-Footed</option>
</select>
  </div>
</div>

          
          <div class="criteria-item">
            <label class="criteria-label">üí∞ Budget (Millions)</label>
            <input type="number" id="budgetLimit" placeholder="Enter budget..." class="filter-input" />
          </div>
          
          <div class="criteria-item">
            <label class="criteria-label">üåç Country Preference</label>
            <select id="teamCountryFilter" class="filter-select">
              <option value="">Any Country</option>
            </select>
          </div>
          
          <div class="criteria-item">
            <label class="criteria-label">üèüÔ∏è Club Preference</label>
            <select id="teamClubFilter" class="filter-select">
              <option value="">Any Club</option>
            </select>
          </div>
          
          <div class="criteria-item">
            <label class="criteria-label">üåê Continent Preference</label>
            <select id="teamContinentFilter" class="filter-select">
              <option value="">Any Continent</option>
              <option value="Africa">Africa</option>
              <option value="Asia">Asia</option>
              <option value="Europe">Europe</option>
              <option value="North America">North America</option>
              <option value="South America">South America</option>
              <option value="Oceania">Oceania</option>
            </select>
          </div>
        </div>

        <div class="text-center">
          <button id="buildTeamBtn" class="build-team-btn text-lg px-6 py-3">
            üöÄ Build Team
          </button>
        </div>
      </div>

      <!-- Team Stats -->
      <div id="teamStats" class="team-stats hidden">
        <h3>üìä Team Statistics</h3>
        <div class="team-stats-grid">
          <div class="team-stat">
            <div class="team-stat-value" id="teamRating">0</div>
            <div class="team-stat-label">Average Rating</div>
          </div>
          <div class="team-stat">
            <div class="team-stat-value" id="teamCost">0M</div>
            <div class="team-stat-label">Total Cost</div>
          </div>
          <div class="team-stat">
            <div class="team-stat-value" id="teamCountries">0</div>
            <div class="team-stat-label">Countries</div>
          </div>
          <div class="team-stat">
            <div class="team-stat-value" id="teamClubs">0</div>
            <div class="team-stat-label">Clubs</div>
          </div>
        </div>
      </div>

      <!-- Formation Display -->
      <div id="formationDisplay" class="formation-container hidden">
        <h3 class="text-2xl font-bold text-center mb-4 text-white">
          üèÜ Your <span id="currentFormationTitle">4-3-3</span> Team
        </h3>
        <div class="formation-display" id="formationField">
          <!-- Formation will be populated by JavaScript -->
        </div>
      </div>

      <!-- Built Team Display -->
       <div id="builtTeamOverlay" class="hidden"></div>
      <div id="builtTeam" class="flex flex-col gap-4 hidden"></div>
    </div>

    <!-- Loading State -->
    <div id="loading" class="text-center">
      <div class="loading-spinner"></div>
      <p class="text-gray-400 mt-4 text-lg">Loading player data...</p>
    </div>

    <!-- Error State -->
    <div id="error" class="error-message hidden">
      <h3 class="font-bold text-xl mb-3">‚ùå Data Loading Error</h3>
      <p class="text-lg">Unable to connect to Google Sheets. Please check your network connection.</p>
    </div>

    <!-- No Results -->
    <div id="noResults" class="no-results hidden">
      <div class="no-results-icon">üîç</div>
      <h3 class="text-2xl font-bold mb-3">No Players Found</h3>
      <p class="text-lg">Try adjusting your filters or search terms</p>
    </div>

    <div id="donateTab" class="hidden">
  <div class="donate-container">
    <h2 class="donate-title">Support my update work if you want<br>Thanks bros for helping me earn more money to support my family.</h2>
    <div class="qr-wrapper">
      <div class="qr-box">
        <img src="momo-qr.jpg" alt="QR MoMo" />
        <p>MoMo</p>
      </div>
      <div class="qr-box">
        <img src="bank-qr.jpg" alt="QR Ng√¢n h√†ng" />
        <p>Visa Banking</p>
      </div>
    </div>
  </div>
</div>
  </div>

  <script>
    const sheetId = "11AlXgZFlKkASFkvcgp1cxcu72aL7nfR74BjNes--gNw";
    const apiKey = "AIzaSyCI6bXgK-_l0bU1F0bJaYH-idxAuNQW1YM";
    const range = "players!A1:Z1000";
    const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${range}?key=${apiKey}`;
  
    let allPlayers = [];
    let filteredPlayers = [];
    let currentTab = 'players';
    let currentFormation = '4-3-3';
    let builtTeam = [];
  
    const statLabels = {
  SPE: "Speed",
  ACC: "Acceleration",
  GKR: "Reactions (GK)",
  STR: "Strength",
  CON: "Control",
  PAS: "Passing",
  GKH: "Handling (GK)",
  TAC: "Tackling",
  STA: "Stamina",
  SHO: "Shooting"
};

// ƒê·ªãnh nghƒ©a countryMap (n√™n ƒë·∫∑t ngo√†i h√†m ho·∫∑c trong file script chung)
const countryMap = {
  'afghanistan': 'https://flagcdn.com/w40/af.png',
  'albania': 'https://flagcdn.com/w40/al.png',
  'algeria': 'https://flagcdn.com/w40/dz.png',
  'andorra': 'https://flagcdn.com/w40/ad.png',
  'angola': 'https://flagcdn.com/w40/ao.png',
  'anguilla': 'https://flagcdn.com/w40/ai.png',
  'antigua and barbuda': 'https://flagcdn.com/w40/ag.png',
  'argentina': 'https://flagcdn.com/w40/ar.png',
  'armenia': 'https://flagcdn.com/w40/am.png',
  'aruba': 'https://flagcdn.com/w40/aw.png',
  'australia': 'https://flagcdn.com/w40/au.png',
  'austria': 'https://flagcdn.com/w40/at.png',
  'azerbaijan': 'https://flagcdn.com/w40/az.png',
  'bahamas': 'https://flagcdn.com/w40/bs.png',
  'bahrain': 'https://flagcdn.com/w40/bh.png',
  'bangladesh': 'https://flagcdn.com/w40/bd.png',
  'barbados': 'https://flagcdn.com/w40/bb.png',
  'belarus': 'https://flagcdn.com/w40/by.png',
  'belgium': 'https://flagcdn.com/w40/be.png',
  'belize': 'https://flagcdn.com/w40/bz.png',
  'benin': 'https://flagcdn.com/w40/bj.png',
  'bermuda': 'https://flagcdn.com/w40/bm.png',
  'bhutan': 'https://flagcdn.com/w40/bt.png',
  'bolivia': 'https://flagcdn.com/w40/bo.png',
  'bosnia and herzegovina': 'https://flagcdn.com/w40/ba.png',
  'botswana': 'https://flagcdn.com/w40/bw.png',
  'brazil': 'https://flagcdn.com/w40/br.png',
  'british virgin islands': 'https://flagcdn.com/w40/vg.png',
  'brunei': 'https://flagcdn.com/w40/bn.png',
  'bulgaria': 'https://flagcdn.com/w40/bg.png',
  'burkina faso': 'https://flagcdn.com/w40/bf.png',
  'burundi': 'https://flagcdn.com/w40/bi.png',
  'cabo verde': 'https://flagcdn.com/w40/cv.png',
  'cambodia': 'https://flagcdn.com/w40/kh.png',
  'cameroon': 'https://flagcdn.com/w40/cm.png',
  'canada': 'https://flagcdn.com/w40/ca.png',
  'cayman islands': 'https://flagcdn.com/w40/ky.png',
  'central african republic': 'https://flagcdn.com/w40/cf.png',
  'chad': 'https://flagcdn.com/w40/td.png',
  'chile': 'https://flagcdn.com/w40/cl.png',
  'china pr': 'https://flagcdn.com/w40/cn.png',
  'chinese taipei (taiwan)': 'https://flagcdn.com/w40/tw.png',
  'colombia': 'https://flagcdn.com/w40/co.png',
  'comoros': 'https://flagcdn.com/w40/km.png',
  'congo': 'https://flagcdn.com/w40/cg.png',
  'dr congo': 'https://flagcdn.com/w40/cd.png',
  'cook islands': 'https://flagcdn.com/w40/ck.png',
  'costa rica': 'https://flagcdn.com/w40/cr.png',
  'c√¥te d\'ivoire': 'https://flagcdn.com/w40/ci.png',
  'croatia': 'https://flagcdn.com/w40/hr.png',
  'cuba': 'https://flagcdn.com/w40/cu.png',
  'cura√ßao': 'https://flagcdn.com/w40/cw.png',
  'cyprus': 'https://flagcdn.com/w40/cy.png',
  'czech republic': 'https://flagcdn.com/w40/cz.png',
  'denmark': 'https://flagcdn.com/w40/dk.png',
  'djibouti': 'https://flagcdn.com/w40/dj.png',
  'dominica': 'https://flagcdn.com/w40/dm.png',
  'dominican republic': 'https://flagcdn.com/w40/do.png',
  'ecuador': 'https://flagcdn.com/w40/ec.png',
  'egypt': 'https://flagcdn.com/w40/eg.png',
  'el salvador': 'https://flagcdn.com/w40/sv.png',
  'england': 'https://flagcdn.com/w40/gb.png',
  'equatorial guinea': 'https://flagcdn.com/w40/gq.png',
  'eritrea': 'https://flagcdn.com/w40/er.png',
  'estonia': 'https://flagcdn.com/w40/ee.png',
  'eswatini': 'https://flagcdn.com/w40/sz.png',
  'ethiopia': 'https://flagcdn.com/w40/et.png',
  'faroe islands': 'https://flagcdn.com/w40/fo.png',
  'fiji': 'https://flagcdn.com/w40/fj.png',
  'finland': 'https://flagcdn.com/w40/fi.png',
  'france': 'https://flagcdn.com/w40/fr.png',
  'gabon': 'https://flagcdn.com/w40/ga.png',
  'gambia': 'https://flagcdn.com/w40/gm.png',
  'georgia': 'https://flagcdn.com/w40/ge.png',
  'germany': 'https://flagcdn.com/w40/de.png',
  'ghana': 'https://flagcdn.com/w40/gh.png',
  'gibraltar': 'https://flagcdn.com/w40/gi.png',
  'greece': 'https://flagcdn.com/w40/gr.png',
  'grenada': 'https://flagcdn.com/w40/gd.png',
  'guam': 'https://flagcdn.com/w40/gu.png',
  'guatemala': 'https://flagcdn.com/w40/gt.png',
  'guinea': 'https://flagcdn.com/w40/gn.png',
  'guinea-bissau': 'https://flagcdn.com/w40/gw.png',
  'guyana': 'https://flagcdn.com/w40/gy.png',
  'haiti': 'https://flagcdn.com/w40/ht.png',
  'honduras': 'https://flagcdn.com/w40/hn.png',
  'hong kong': 'https://flagcdn.com/w40/hk.png',
  'hungary': 'https://flagcdn.com/w40/hu.png',
  'iceland': 'https://flagcdn.com/w40/is.png',
  'india': 'https://flagcdn.com/w40/in.png',
  'indonesia': 'https://flagcdn.com/w40/id.png',
  'iran': 'https://flagcdn.com/w40/ir.png',
  'iraq': 'https://flagcdn.com/w40/iq.png',
  'ireland': 'https://flagcdn.com/w40/ie.png',
  'israel': 'https://flagcdn.com/w40/il.png',
  'italy': 'https://flagcdn.com/w40/it.png',
  'jamaica': 'https://flagcdn.com/w40/jm.png',
  'japan': 'https://flagcdn.com/w40/jp.png',
  'jordan': 'https://flagcdn.com/w40/jo.png',
  'kazakhstan': 'https://flagcdn.com/w40/kz.png',
  'kenya': 'https://flagcdn.com/w40/ke.png',
  'kiribati': 'https://flagcdn.com/w40/ki.png',
  'north korea': 'https://flagcdn.com/w40/kp.png',
  'south korea': 'https://flagcdn.com/w40/kr.png',
  'kosovo': 'https://flagcdn.com/w40/xk.png',
  'kuwait': 'https://flagcdn.com/w40/kw.png',
  'kyrgyz republic': 'https://flagcdn.com/w40/kg.png',
  'laos': 'https://flagcdn.com/w40/la.png',
  'latvia': 'https://flagcdn.com/w40/lv.png',
  'lebanon': 'https://flagcdn.com/w40/lb.png',
  'lesotho': 'https://flagcdn.com/w40/ls.png',
  'liberia': 'https://flagcdn.com/w40/lr.png',
  'libya': 'https://flagcdn.com/w40/ly.png',
  'liechtenstein': 'https://flagcdn.com/w40/li.png',
  'lithuania': 'https://flagcdn.com/w40/lt.png',
  'luxembourg': 'https://flagcdn.com/w40/lu.png',
  'macau': 'https://flagcdn.com/w40/mo.png',
  'madagascar': 'https://flagcdn.com/w40/mg.png',
  'malawi': 'https://flagcdn.com/w40/mw.png',
  'malaysia': 'https://flagcdn.com/w40/my.png',
  'maldives': 'https://flagcdn.com/w40/mv.png',
  'mali': 'https://flagcdn.com/w40/ml.png',
  'malta': 'https://flagcdn.com/w40/mt.png',
  'marshall islands': 'https://flagcdn.com/w40/mh.png',
  'mauritania': 'https://flagcdn.com/w40/mr.png',
  'mauritius': 'https://flagcdn.com/w40/mu.png',
  'mexico': 'https://flagcdn.com/w40/mx.png',
  'micronesia': 'https://flagcdn.com/w40/fm.png',
  'moldova': 'https://flagcdn.com/w40/md.png',
  'monaco': 'https://flagcdn.com/w40/mc.png',
  'mongolia': 'https://flagcdn.com/w40/mn.png',
  'montenegro': 'https://flagcdn.com/w40/me.png',
  'morocco': 'https://flagcdn.com/w40/ma.png',
  'mozambique': 'https://flagcdn.com/w40/mz.png',
  'myanmar': 'https://flagcdn.com/w40/mm.png',
  'namibia': 'https://flagcdn.com/w40/na.png',
  'nauru': 'https://flagcdn.com/w40/nr.png',
  'nepal': 'https://flagcdn.com/w40/np.png',
  'netherlands': 'https://flagcdn.com/w40/nl.png',
  'new caledonia': 'https://flagcdn.com/w40/nc.png',
  'new zealand': 'https://flagcdn.com/w40/nz.png',
  'nicaragua': 'https://flagcdn.com/w40/ni.png',
  'niger': 'https://flagcdn.com/w40/ne.png',
  'nigeria': 'https://flagcdn.com/w40/ng.png',
  'north macedonia': 'https://flagcdn.com/w40/mk.png',
  'northern ireland': 'https://flagcdn.com/w40/gb.png',
  'norway': 'https://flagcdn.com/w40/no.png',
  'oman': 'https://flagcdn.com/w40/om.png',
  'pakistan': 'https://flagcdn.com/w40/pk.png',
  'palestine': 'https://flagcdn.com/w40/ps.png',
  'panama': 'https://flagcdn.com/w40/pa.png',
  'papua new guinea': 'https://flagcdn.com/w40/pg.png',
  'paraguay': 'https://flagcdn.com/w40/py.png',
  'peru': 'https://flagcdn.com/w40/pe.png',
  'philippines': 'https://flagcdn.com/w40/ph.png',
  'poland': 'https://flagcdn.com/w40/pl.png',
  'portugal': 'https://flagcdn.com/w40/pt.png',
  'puerto rico': 'https://flagcdn.com/w40/pr.png',
  'qatar': 'https://flagcdn.com/w40/qa.png',
  'romania': 'https://flagcdn.com/w40/ro.png',
  'russia': 'https://flagcdn.com/w40/ru.png',
  'rwanda': 'https://flagcdn.com/w40/rw.png',
  'samoa': 'https://flagcdn.com/w40/ws.png',
  'san marino': 'https://flagcdn.com/w40/sm.png',
  's√£o tom√© and pr√≠ncipe': 'https://flagcdn.com/w40/st.png',
  'saudi arabia': 'https://flagcdn.com/w40/sa.png',
  'scotland': 'https://flagcdn.com/w40/gb.png',
  'senegal': 'https://flagcdn.com/w40/sn.png',
  'serbia': 'https://flagcdn.com/w40/rs.png',
  'seychelles': 'https://flagcdn.com/w40/sc.png',
  'sierra leone': 'https://flagcdn.com/w40/sl.png',
  'singapore': 'https://flagcdn.com/w40/sg.png',
  'slovakia': 'https://flagcdn.com/w40/sk.png',
  'slovenia': 'https://flagcdn.com/w40/si.png',
  'solomon islands': 'https://flagcdn.com/w40/sb.png',
  'somalia': 'https://flagcdn.com/w40/so.png',
  'south africa': 'https://flagcdn.com/w40/za.png',
  'south sudan': 'https://flagcdn.com/w40/ss.png',
  'spain': 'https://flagcdn.com/w40/es.png',
  'sri lanka': 'https://flagcdn.com/w40/lk.png',
  'st. kitts and nevis': 'https://flagcdn.com/w40/kn.png',
  'st. lucia': 'https://flagcdn.com/w40/lc.png',
  'st. vincent / grenadines': 'https://flagcdn.com/w40/vc.png',
  'sudan': 'https://flagcdn.com/w40/sd.png',
  'suriname': 'https://flagcdn.com/w40/sr.png',
  'sweden': 'https://flagcdn.com/w40/se.png',
  'switzerland': 'https://flagcdn.com/w40/ch.png',
  'syria': 'https://flagcdn.com/w40/sy.png',
  'tajikistan': 'https://flagcdn.com/w40/tj.png',
  'tanzania': 'https://flagcdn.com/w40/tz.png',
  'thailand': 'https://flagcdn.com/w40/th.png',
  'timor-leste': 'https://flagcdn.com/w40/tl.png',
  'togo': 'https://flagcdn.com/w40/tg.png',
  'tonga': 'https://flagcdn.com/w40/to.png',
  'trinidad and tobago': 'https://flagcdn.com/w40/tt.png',
  'tunisia': 'https://flagcdn.com/w40/tn.png',
  'turkey': 'https://flagcdn.com/w40/tr.png',
  'turkmenistan': 'https://flagcdn.com/w40/tm.png',
  'tuvalu': 'https://flagcdn.com/w40/tv.png',
  'uganda': 'https://flagcdn.com/w40/ug.png',
  'ukraine': 'https://flagcdn.com/w40/ua.png',
  'united arab emirates': 'https://flagcdn.com/w40/ae.png',
  'united states': 'https://flagcdn.com/w40/us.png',
  'uruguay': 'https://flagcdn.com/w40/uy.png',
  'uzbekistan': 'https://flagcdn.com/w40/uz.png',
  'vanuatu': 'https://flagcdn.com/w40/vu.png',
  'vatican': 'https://flagcdn.com/w40/va.png',
  'venezuela': 'https://flagcdn.com/w40/ve.png',
  'vietnam': 'https://flagcdn.com/w40/vn.png',
  'wales': 'https://flagcdn.com/w40/gb.png',
  'yemen': 'https://flagcdn.com/w40/ye.png',
  'zambia': 'https://flagcdn.com/w40/zm.png',
  'zimbabwe': 'https://flagcdn.com/w40/zw.png'
};

    // Formation configurations with positions and variants
    const formations = {
      // 4-4-2 Family
      '4-4-2': {
        lines: [
          { positions: ['GK'], line: 'defense' },
          { positions: ['LB', 'CB', 'CB', 'RB'], line: 'defense' },
          { positions: ['LM', 'CM', 'CM', 'RM'], line: 'midfield' },
          { positions: ['ST', 'ST'], line: 'attack' }
        ]
      },
      '4-1-2-1-2': {
        lines: [
          { positions: ['GK'], line: 'defense' },
          { positions: ['LB', 'CB', 'CB', 'RB'], line: 'defense' },
          { positions: ['DM'], line: 'midfield' },
          { positions: ['CM', 'CM'], line: 'midfield' },
          { positions: ['AM'], line: 'midfield' },
          { positions: ['CF', 'CF'], line: 'attack' }
        ]
      },
      '4-3-1-2': {
        lines: [
          { positions: ['GK'], line: 'defense' },
          { positions: ['LB', 'CB', 'CB', 'RB'], line: 'defense' },
          { positions: ['CM', 'CM', 'CM'], line: 'midfield' },
          { positions: ['AM'], line: 'midfield' },
          { positions: ['CF', 'CF'], line: 'attack' }
        ]
      },
      '4-2-2-2': {
        lines: [
          { positions: ['GK'], line: 'defense' },
          { positions: ['LB', 'CB', 'CB', 'RB'], line: 'defense' },
          { positions: ['DM', 'DM'], line: 'midfield' },
          { positions: ['AM', 'AM'], line: 'midfield' },
          { positions: ['CF', 'CF'], line: 'attack' }
        ]
      },
      '4-4-1-1': {
        lines: [
          { positions: ['GK'], line: 'defense' },
          { positions: ['LB', 'CB', 'CB', 'RB'], line: 'defense' },
          { positions: ['LM', 'CM', 'CM', 'RM'], line: 'midfield' },
          { positions: ['SS'], line: 'midfield' },
          { positions: ['CF'], line: 'attack' }
        ]
      },
      '4-1-3-2': {
        lines: [
          { positions: ['GK'], line: 'defense' },
          { positions: ['LB', 'CB', 'CB', 'RB'], line: 'defense' },
          { positions: ['DM'], line: 'midfield' },
          { positions: ['LM', 'AM', 'RM'], line: 'midfield' },
          { positions: ['CF', 'CF'], line: 'attack' }
        ]
      },

      // 4-5-1 Family
      '4-5-1': {
        lines: [
          { positions: ['GK'], line: 'defense' },
          { positions: ['LB', 'CB', 'CB', 'RB'], line: 'defense' },
          { positions: ['LM', 'CM', 'CM', 'CM', 'RM'], line: 'midfield' },
          { positions: ['CF'], line: 'attack' }
        ]
      },
      '4-1-4-1': {
        lines: [
          { positions: ['GK'], line: 'defense' },
          { positions: ['LB', 'CB', 'CB', 'RB'], line: 'defense' },
          { positions: ['DM'], line: 'midfield' },
          { positions: ['LM', 'CM', 'CM', 'RM'], line: 'midfield' },
          { positions: ['CF'], line: 'attack' }
        ]
      },
      '4-2-3-1': {
        lines: [
          { positions: ['GK'], line: 'defense' },
          { positions: ['LB', 'CB', 'CB', 'RB'], line: 'defense' },
          { positions: ['DM', 'DM'], line: 'midfield' },
          { positions: ['LW', 'AM', 'RW'], line: 'midfield' },
          { positions: ['CF'], line: 'attack' }
        ]
      },
      '4-3-2-1': {
        lines: [
          { positions: ['GK'], line: 'defense' },
          { positions: ['LB', 'CB', 'CB', 'RB'], line: 'defense' },
          { positions: ['CM', 'CM', 'CM'], line: 'midfield' },
          { positions: ['LW', 'RW'], line: 'midfield' },
          { positions: ['CF'], line: 'attack' }
        ]
      },

      // 4-3-3 Family
      '4-3-3': {
        lines: [
          { positions: ['GK'], line: 'defense' },
          { positions: ['LB', 'CB', 'CB', 'RB'], line: 'defense' },
          { positions: ['CM', 'CM', 'CM'], line: 'midfield' },
          { positions: ['LW', 'CF', 'RW'], line: 'attack' }
        ]
      },
      '4-1-2-3': {
        lines: [
          { positions: ['GK'], line: 'defense' },
          { positions: ['LB', 'CB', 'CB', 'RB'], line: 'defense' },
          { positions: ['DM'], line: 'midfield' },
          { positions: ['CM', 'CM'], line: 'midfield' },
          { positions: ['LW', 'CF', 'RW'], line: 'attack' }
        ]
      },
      '4-2-1-3': {
        lines: [
          { positions: ['GK'], line: 'defense' },
          { positions: ['LB', 'CB', 'CB', 'RB'], line: 'defense' },
          { positions: ['DM', 'DM'], line: 'midfield' },
          { positions: ['AM'], line: 'midfield' },
          { positions: ['LW', 'CF', 'RW'], line: 'attack' }
        ]
      },

      // 5-3-2 Family
      '5-3-2': {
        lines: [
          { positions: ['GK'], line: 'defense' },
          { positions: ['LWB', 'CB', 'CB', 'CB', 'RWB'], line: 'defense' },
          { positions: ['CM', 'CM', 'CM'], line: 'midfield' },
          { positions: ['CF', 'CF'], line: 'attack' }
        ]
      },
      '5-2-1-2': {
        lines: [
          { positions: ['GK'], line: 'defense' },
          { positions: ['LWB', 'CB', 'CB', 'CB', 'RWB'], line: 'defense' },
          { positions: ['DM', 'DM'], line: 'midfield' },
          { positions: ['AM'], line: 'midfield' },
          { positions: ['CF', 'CF'], line: 'attack' }
        ]
      },

      // 5-2-3 Family
      '5-2-3': {
        lines: [
          { positions: ['GK'], line: 'defense' },
          { positions: ['LWB', 'CB', 'CB', 'CB', 'RWB'], line: 'defense' },
          { positions: ['DM', 'DM'], line: 'midfield' },
          { positions: ['LW', 'CF', 'RW'], line: 'attack' }
        ]
      },
      '5-2-2-1': {
        lines: [
          { positions: ['GK'], line: 'defense' },
          { positions: ['LWB', 'CB', 'CB', 'CB', 'RWB'], line: 'defense' },
          { positions: ['DM', 'DM'], line: 'midfield' },
          { positions: ['LW', 'RW'], line: 'midfield' },
          { positions: ['CF'], line: 'attack' }
        ]
      },

      // 5-4-1 Family
      '5-4-1': {
        lines: [
          { positions: ['GK'], line: 'defense' },
          { positions: ['LWB', 'CB', 'CB', 'CB', 'RWB'], line: 'defense' },
          { positions: ['LM', 'CM', 'CM', 'RM'], line: 'midfield' },
          { positions: ['CF'], line: 'attack' }
        ]
      },
      '5-1-2-1-1': {
        lines: [
          { positions: ['GK'], line: 'defense' },
          { positions: ['LWB', 'CB', 'CB', 'CB', 'RWB'], line: 'defense' },
          { positions: ['DM'], line: 'midfield' },
          { positions: ['CM', 'CM'], line: 'midfield' },
          { positions: ['AM'], line: 'midfield' },
          { positions: ['CF'], line: 'attack' }
        ]
      },

      // 3-5-2 Family
      '3-5-2': {
        lines: [
          { positions: ['GK'], line: 'defense' },
          { positions: ['CB', 'CB', 'CB'], line: 'defense' },
          { positions: ['LWB', 'CM', 'CM', 'CM', 'RWB'], line: 'midfield' },
          { positions: ['CF', 'CF'], line: 'attack' }
        ]
      },
      '3-2-3-2': {
        lines: [
          { positions: ['GK'], line: 'defense' },
          { positions: ['CB', 'CB', 'CB'], line: 'defense' },
          { positions: ['DM', 'DM'], line: 'midfield' },
          { positions: ['LM', 'AM', 'RM'], line: 'midfield' },
          { positions: ['CF', 'CF'], line: 'attack' }
        ]
      },
      '3-1-4-2': {
        lines: [
          { positions: ['GK'], line: 'defense' },
          { positions: ['CB', 'CB', 'CB'], line: 'defense' },
          { positions: ['DM'], line: 'midfield' },
          { positions: ['LM', 'CM', 'CM', 'RM'], line: 'midfield' },
          { positions: ['CF', 'CF'], line: 'attack' }
        ]
      },
      '3-4-1-2': {
        lines: [
          { positions: ['GK'], line: 'defense' },
          { positions: ['CB', 'CB', 'CB'], line: 'defense' },
          { positions: ['LM', 'CM', 'CM', 'RM'], line: 'midfield' },
          { positions: ['AM'], line: 'midfield' },
          { positions: ['CF', 'CF'], line: 'attack' }
        ]
      },
      '3-5-1-1': {
        lines: [
          { positions: ['GK'], line: 'defense' },
          { positions: ['CB', 'CB', 'CB'], line: 'defense' },
          { positions: ['LWB', 'CM', 'CM', 'CM', 'RWB'], line: 'midfield' },
          { positions: ['SS'], line: 'midfield' },
          { positions: ['CF'], line: 'attack' }
        ]
      },

      // 3-4-3 Family
      '3-4-3': {
        lines: [
          { positions: ['GK'], line: 'defense' },
          { positions: ['CB', 'CB', 'CB'], line: 'defense' },
          { positions: ['LM', 'CM', 'CM', 'RM'], line: 'midfield' },
          { positions: ['LW', 'CF', 'RW'], line: 'attack' }
        ]
      },
      '3-4-2-1': {
        lines: [
          { positions: ['GK'], line: 'defense' },
          { positions: ['CB', 'CB', 'CB'], line: 'defense' },
          { positions: ['LM', 'CM', 'CM', 'RM'], line: 'midfield' },
          { positions: ['LW', 'RW'], line: 'midfield' },
          { positions: ['CF'], line: 'attack' }
        ]
      },
      '3-1-2-1-3': {
        lines: [
          { positions: ['GK'], line: 'defense' },
          { positions: ['CB', 'CB', 'CB'], line: 'defense' },
          { positions: ['DM'], line: 'midfield' },
          { positions: ['CM', 'CM'], line: 'midfield' },
          { positions: ['AM'], line: 'midfield' },
          { positions: ['LW', 'CF', 'RW'], line: 'attack' }
        ]
      },
      '3-3-1-3': {
        lines: [
          { positions: ['GK'], line: 'defense' },
          { positions: ['CB', 'CB', 'CB'], line: 'defense' },
          { positions: ['LM', 'CM', 'RM'], line: 'midfield' },
          { positions: ['AM'], line: 'midfield' },
          { positions: ['LW', 'CF', 'RW'], line: 'attack' }
        ]
      }
    };

    // Formation families for variant selection
    const formationFamilies = {
      '4-4-2': ['4-4-2', '4-1-2-1-2', '4-3-1-2', '4-2-2-2', '4-4-1-1', '4-1-3-2'],
      '4-5-1': ['4-5-1', '4-1-4-1', '4-2-3-1', '4-3-2-1'],
      '4-3-3': ['4-3-3', '4-1-2-3', '4-2-1-3'],
      '5-3-2': ['5-3-2', '5-2-1-2'],
      '5-2-3': ['5-2-3', '5-2-2-1'],
      '5-4-1': ['5-4-1', '5-1-2-1-1'],
      '3-5-2': ['3-5-2', '3-2-3-2', '3-1-4-2', '3-4-1-2', '3-5-1-1'],
      '3-4-3': ['3-4-3', '3-4-2-1', '3-1-2-1-3', '3-3-1-3']
    };
  
    // Enhanced position mappings with flexible substitution rules
    const positionSubstitutions = {
      // Left side positions can substitute for each other
      'LW': ['LW', 'LWB', 'LM'],
      'LWB': ['LWB', 'LW', 'LB', 'LM'],
      'LB': ['LB', 'LWB'],
      'LM': ['LM', 'LW', 'LWB'],
      
      // Right side positions can substitute for each other  
      'RW': ['RW', 'RWB', 'RM'],
      'RWB': ['RWB', 'RW', 'RB', 'RM'],
      'RB': ['RB', 'RWB'],
      'RM': ['RM', 'RW', 'RWB'],
      
      // Midfield positions can substitute for each other
      'CM': ['CM', 'DM', 'AM'],
      'AM': ['AM', 'CM', 'SS'],
      'DM': ['DM', 'CM'],
      
      // Forward positions can substitute for each other
      'CF': ['CF', 'SS'],
      'SS': ['SS', 'CF', 'AM'],
      
      // Goalkeeper and center back are position-specific
      'GK': ['GK'],
      'CB': ['CB']
    };

    // Country to continent mapping
    const countryToContinent = {
      'Algeria': 'Africa', 'Angola': 'Africa', 'Benin': 'Africa', 'Botswana': 'Africa', 'Burkina Faso': 'Africa',
      'Burundi': 'Africa', 'Cabo Verde': 'Africa', 'Cameroon': 'Africa', 'Central African Republic': 'Africa',
      'Chad': 'Africa', 'Comoros': 'Africa', 'Congo': 'Africa', 'Djibouti': 'Africa', 'Egypt': 'Africa',
      'Equatorial Guinea': 'Africa', 'Eritrea': 'Africa', 'Eswatini': 'Africa', 'Ethiopia': 'Africa',
      'Gabon': 'Africa', 'Gambia': 'Africa', 'Ghana': 'Africa', 'Guinea': 'Africa', 'Guinea-Bissau': 'Africa',
      'Ivory Coast': 'Africa', 'Kenya': 'Africa', 'Lesotho': 'Africa', 'Liberia': 'Africa', 'Libya': 'Africa',
      'Madagascar': 'Africa', 'Malawi': 'Africa', 'Mali': 'Africa', 'Mauritania': 'Africa', 'Mauritius': 'Africa',
      'Morocco': 'Africa', 'Mozambique': 'Africa', 'Namibia': 'Africa', 'Niger': 'Africa', 'Nigeria': 'Africa',
      'Rwanda': 'Africa', 'Senegal': 'Africa', 'Seychelles': 'Africa', 'Sierra Leone': 'Africa', 'Somalia': 'Africa',
      'South Africa': 'Africa', 'South Sudan': 'Africa', 'Sudan': 'Africa', 'Tanzania': 'Africa', 'Togo': 'Africa',
      'Tunisia': 'Africa', 'Uganda': 'Africa', 'Zambia': 'Africa', 'Zimbabwe': 'Africa',

      'Afghanistan': 'Asia', 'Azerbaijan': 'Asia', 'Bahrain': 'Asia', 'Bangladesh': 'Asia',
      'Bhutan': 'Asia', 'Brunei': 'Asia', 'Cambodia': 'Asia', 'China': 'Asia', 'Cyprus': 'Asia',
      'East Timor': 'Asia', 'Georgia': 'Asia', 'India': 'Asia', 'Indonesia': 'Asia', 'Iran': 'Asia',
      'Iraq': 'Asia', 'Israel': 'Asia', 'Japan': 'Asia', 'Jordan': 'Asia', 'Kazakhstan': 'Asia',
      'Kuwait': 'Asia', 'Kyrgyzstan': 'Asia', 'Laos': 'Asia', 'Lebanon': 'Asia', 'Malaysia': 'Asia',
      'Maldives': 'Asia', 'Mongolia': 'Asia', 'Myanmar': 'Asia', 'Nepal': 'Asia', 'North Korea': 'Asia',
      'Oman': 'Asia', 'Pakistan': 'Asia', 'Palestine': 'Asia', 'Philippines': 'Asia', 'Qatar': 'Asia',
      'Russia': 'Asia', 'Saudi Arabia': 'Asia', 'Singapore': 'Asia', 'South Korea': 'Asia', 'Sri Lanka': 'Asia',
      'Syria': 'Asia', 'Tajikistan': 'Asia', 'Thailand': 'Asia', 'Turkmenistan': 'Asia',
      'United Arab Emirates': 'Asia', 'Uzbekistan': 'Asia', 'Vietnam': 'Asia', 'Yemen': 'Asia',

      'Albania': 'Europe', 'Andorra': 'Europe', 'Austria': 'Europe', 'Belarus': 'Europe', 'Belgium': 'Europe',
      'Bosnia and Herzegovina': 'Europe', 'Bulgaria': 'Europe', 'Croatia': 'Europe', 'Czech Republic': 'Europe',
      'Denmark': 'Europe', 'Estonia': 'Europe', 'Finland': 'Europe', 'France': 'Europe', 'Germany': 'Europe',
      'Greece': 'Europe', 'Hungary': 'Europe', 'Iceland': 'Europe', 'Ireland': 'Europe', 'Italy': 'Europe',
      'Latvia': 'Europe', 'Liechtenstein': 'Europe', 'Lithuania': 'Europe', 'Luxembourg': 'Europe',
      'Malta': 'Europe', 'Moldova': 'Europe', 'Monaco': 'Europe', 'Montenegro': 'Europe', 'Netherlands': 'Europe',
      'North Macedonia': 'Europe', 'Norway': 'Europe', 'Poland': 'Europe', 'Portugal': 'Europe',
      'Romania': 'Europe', 'San Marino': 'Europe', 'Serbia': 'Europe', 'Slovakia': 'Europe', 'Slovenia': 'Europe',
      'Spain': 'Europe', 'Sweden': 'Europe', 'Switzerland': 'Europe', 'Ukraine': 'Europe', 'United Kingdom': 'Europe',
      'Vatican City': 'Europe', 'England': 'Europe', 'Scotland': 'Europe', 'Wales': 'Europe', 'Turkey': 'Europe', 'Armenia': 'Europe',

      'Antigua and Barbuda': 'North America', 'Bahamas': 'North America', 'Barbados': 'North America',
      'Belize': 'North America', 'Canada': 'North America', 'Costa Rica': 'North America', 'Cuba': 'North America',
      'Dominica': 'North America', 'Dominican Republic': 'North America', 'El Salvador': 'North America',
      'Grenada': 'North America', 'Guatemala': 'North America', 'Haiti': 'North America', 'Honduras': 'North America',
      'Jamaica': 'North America', 'Mexico': 'North America', 'Nicaragua': 'North America', 'Panama': 'North America',
      'Saint Kitts and Nevis': 'North America', 'Saint Lucia': 'North America', 'Saint Vincent and the Grenadines': 'North America',
      'Trinidad and Tobago': 'North America', 'United States': 'North America',

      'Argentina': 'South America', 'Bolivia': 'South America', 'Brazil': 'South America', 'Chile': 'South America',
      'Colombia': 'South America', 'Ecuador': 'South America', 'Guyana': 'South America', 'Paraguay': 'South America',
      'Peru': 'South America', 'Suriname': 'South America', 'Uruguay': 'South America', 'Venezuela': 'South America',

      'Australia': 'Oceania', 'Fiji': 'Oceania', 'Kiribati': 'Oceania', 'Marshall Islands': 'Oceania',
      'Micronesia': 'Oceania', 'Nauru': 'Oceania', 'New Zealand': 'Oceania', 'Palau': 'Oceania',
      'Papua New Guinea': 'Oceania', 'Samoa': 'Oceania', 'Solomon Islands': 'Oceania', 'Tonga': 'Oceania',
      'Tuvalu': 'Oceania', 'Vanuatu': 'Oceania'
    };
  
    // DOM Elements
    const loading = document.getElementById('loading');
    const error = document.getElementById('error');
    const playersGrid = document.getElementById('playersGrid');
    const noResults = document.getElementById('noResults');
    const searchInput = document.getElementById('searchInput');
    const countryFilter = document.getElementById('countryFilter');
    const priceFilter = document.getElementById('priceFilter');
    const clearFilters = document.getElementById('clearFilters');
    const playersTab = document.getElementById('playersTab');
    const teamBuilderTab = document.getElementById('teamBuilderTab');
    const donateTab = document.getElementById('donateTab');
    const buildTeamBtn = document.getElementById('buildTeamBtn');
    const builtTeamDiv = document.getElementById('builtTeam');
    const teamStats = document.getElementById('teamStats');
    const formationDisplay = document.getElementById('formationDisplay');
    const formationField = document.getElementById('formationField');
  
    async function loadData() {
      try {
        const response = await fetch(url);
        
        if (!response.ok) {
          const errorText = await response.text();
          throw new Error(`Network error: ${response.status} ${response.statusText} - ${errorText}`);
        }
  
        const data = await response.json();
        if (!data.values || data.values.length === 0) {
          throw new Error('No data found in the selected range');
        }
  
        const [headers, ...rows] = data.values;
        
        allPlayers = rows.map(row => {
          const player = {};
          headers.forEach((header, index) => {
            player[header] = row[index] || '';
          });
          return player;
        }).filter(player => player[headers[0]] && player[headers[0]].trim());

        // Calculate rankings based on rating
        const ratingField = getRatingField();
        allPlayers.sort((a, b) => {
          const ratingA = parseFloat(a[ratingField] || '0');
          const ratingB = parseFloat(b[ratingField] || '0');
          return ratingB - ratingA;
        });

        // Add ranking to each player
        allPlayers.forEach((player, index) => {
          player.rank = index + 1;
        });

        // Add continent data
        allPlayers.forEach(player => {
          player['Continent'] = countryToContinent[player['Nationality'] || player['Country']] || '';
        });

        filteredPlayers = [...allPlayers];
        populateFilters();
        renderPlayers();
        showContent();
        
      } catch (err) {
        console.error('Error loading data:', err);
        error.innerHTML = `
          <h3 class="font-bold text-xl mb-3">‚ùå Data Loading Error</h3>
          <p class="text-lg">${err.message}</p>
        `;
        showError();
      }
    }
  
    function populateFilters() {
      const countries = [...new Set(allPlayers.map(p => p['Nationality'] || p['Country'] || '').filter(c => c))].sort();
      countryFilter.innerHTML = '<option value="">üåç All Countries</option>';
      const teamCountryFilter = document.getElementById('teamCountryFilter');
      teamCountryFilter.innerHTML = '<option value="">Any Country</option>';
      
      countries.forEach(country => {
        const option = document.createElement('option');
        option.value = country;
        option.textContent = country;
        countryFilter.appendChild(option);
        
        const teamOption = option.cloneNode(true);
        teamCountryFilter.appendChild(teamOption);
      });

      const clubs = [...new Set(allPlayers.map(p => p['Club'] || '').filter(c => c))].sort();
      const teamClubFilter = document.getElementById('teamClubFilter');
      teamClubFilter.innerHTML = '<option value="">Any Club</option>';
      
      clubs.forEach(club => {
        const option = document.createElement('option');
        option.value = club;
        option.textContent = club;
        teamClubFilter.appendChild(option);
      });
    }
  
function switchTab(tab) {
  currentTab = tab;
  document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
  event.target.classList.add('active');

  // ·∫®n modal, overlay, th·ªëng k√™ ƒë·ªôi b√≥ng v√† s∆° ƒë·ªì ƒë·ªôi h√¨nh khi chuy·ªÉn kh·ªèi tab team-builder
  if (tab !== 'team-builder') {
    teamStats.classList.add('hidden');
    formationDisplay.classList.add('hidden');
    builtTeamDiv.classList.add('hidden');
    builtTeamDiv.classList.remove('show');
    document.getElementById('builtTeamOverlay').classList.remove('show');
    builtTeam = []; // X√≥a d·ªØ li·ªáu ƒë·ªôi b√≥ng
  }

  if (tab === 'players') {
    playersTab.classList.remove('hidden');
    teamBuilderTab.classList.add('hidden');
    donateTab?.classList?.add('hidden');
  } else if (tab === 'team-builder') {
    playersTab.classList.add('hidden');
    teamBuilderTab.classList.remove('hidden');
    donateTab?.classList?.add('hidden');
    if (builtTeam.length–µ—Ä–∫–≤–∏

 > 0) {
      displayBuiltTeam();
      updateTeamStats();
      displayFormation();
    }
  } else if (tab === 'donate') {
    playersTab.classList.add('hidden');
    teamBuilderTab.classList.add('hidden');
    donateTab?.classList?.remove('hidden');
  }
}

    function selectFormation(formation) {
      currentFormation = formation;
      
      // Update main formation buttons
      document.querySelectorAll('.formation-btn').forEach(btn => btn.classList.remove('active'));
      event.target.classList.add('active');
      
      // Show formation variants
      updateFormationVariants(formation);
      
      // Show formation structure (empty positions)
      displayFormation();
    }

    function selectFormationVariant(variant) {
      currentFormation = variant;
      
      // Update variant buttons
      document.querySelectorAll('#formationVariants .formation-btn').forEach(btn => btn.classList.remove('active'));
      event.target.classList.add('active');
      
      // Show formation structure (empty positions)
      displayFormation();
    }

    function updateFormationVariants(mainFormation) {
      const variantsContainer = document.getElementById('formationVariants');
      const variants = formationFamilies[mainFormation] || [];
      
      if (variants.length <= 1) {
        variantsContainer.style.display = 'none';
        return;
      }
      
      variantsContainer.style.display = 'flex';
      variantsContainer.innerHTML = '';
      
      variants.forEach((variant, index) => {
        const btn = document.createElement('button');
        btn.className = `formation-btn ${index === 0 ? 'active' : ''}`;
        btn.textContent = variant;
        btn.onclick = () => selectFormationVariant(variant);
        variantsContainer.appendChild(btn);
      });
      
      // Set first variant as current if it's different
      if (variants[0] !== currentFormation) {
        currentFormation = variants[0];
      }
    }

    function getRankClass(rank) {
      if (rank <= 10) return 'top10';
      if (rank <= 50) return 'top50';
      return '';
    }
  
    function applyFilters() {
      const searchTerm = searchInput.value.toLowerCase().trim();
      const selectedCountry = countryFilter.value.trim().toLowerCase();
      const selectedPrice = priceFilter.value;
      const selectedPosition = document.getElementById('positionFilter').value.toUpperCase();

      filteredPlayers = allPlayers.filter(player => {
        const matchesSearch = !searchTerm || Object.values(player).some(value => 
          value.toString().toLowerCase().includes(searchTerm)
        );

        const playerCountry = (player['Nationality'] || player['Country'] || '').toLowerCase();
        const matchesCountry = !selectedCountry || playerCountry.includes(selectedCountry);

        let matchesPrice = true;
        if (selectedPrice) {
          const priceValue = parseFloat(player['Price'] || player['Value'] || '0');
          const [min, max] = selectedPrice.split('-');
          const minPrice = parseFloat(min);
          const maxPrice = max ? parseFloat(max) : Infinity;

          if (selectedPrice.includes('+')) {
            matchesPrice = priceValue > minPrice;
          } else {
            matchesPrice = priceValue >= minPrice && priceValue < maxPrice;
          }
        }

        const playerPos = (player['Position'] || player['Pos'] || '').toUpperCase();
const matchesPosition = !selectedPosition || playerPos === selectedPosition;


        return matchesSearch && matchesCountry && matchesPrice && matchesPosition;
      });

      renderPlayers();
    }

    function renderPlayers() {
      playersGrid.innerHTML = '';
      
      if (filteredPlayers.length === 0) {
        noResults.classList.remove('hidden');
        playersGrid.classList.add('hidden');
        return;
      }
      
      noResults.classList.add('hidden');
      playersGrid.classList.remove('hidden');

      // Sort by current sort filter
      const sortFilter = document.getElementById('sortFilter').value;
      const ratingField = getRatingField();
      if (sortFilter) {
        filteredPlayers.sort((a, b) => {
          const ratingA = parseFloat(a[ratingField] || '0');
          const ratingB = parseFloat(b[ratingField] || '0');
          const priceA = parseFloat(a['Price'] || a['Value'] || '0');
          const priceB = parseFloat(b['Price'] || b['Value'] || '0');
          const nameA = a[Object.keys(a)[0]].toLowerCase();
          const nameB = b[Object.keys(b)[0]].toLowerCase();

          switch (sortFilter) {
            case 'rating-high': return ratingB - ratingA;
            case 'rating-low': return ratingA - ratingB;
            case 'price-high': return priceB - priceA;
            case 'price-low': return priceA - priceB;
            case 'name': return nameA.localeCompare(nameB);
            default: return 0;
          }
        });
      }

      filteredPlayers.forEach((player, index) => {
        const playerCard = createPlayerCard(player, index);
        playersGrid.appendChild(playerCard);
      });
    }
  
function createPlayerCard(player, index) {
  const card = document.createElement('div');
  card.className = 'player-card fade-in';
  card.style.animationDelay = `${index * 0.05}s`;

  const headers = Object.keys(player);
  const nameField = headers[0];
  const ratingField = getRatingField();

  const name = player[nameField] || 'Unknown Player';
  const rating = player[ratingField] || '0';
  const numRating = parseFloat(rating);
  const country = player['Nationality'] || player['Country'] || '';
  const club = player['Club'] || '';
  const price = player['Price'] || player['Value'] || '';
  const position = player['Position'] || player['Pos'] || '';
  const rank = player.rank || 0;

  const isGoalkeeper = position.toLowerCase().includes('gk');

  let ratingClass = '';
  if (numRating >= 80) ratingClass = 'rating-legendary';
  else if (numRating >= 70) ratingClass = 'rating-elite';
  else if (numRating >= 60) ratingClass = 'rating-good';
  else ratingClass = 'rating-basic';

  const statGroup1 = isGoalkeeper
    ? ['Speed', 'Acceleration', 'Reactions (GK)', 'Strength']
    : ['Speed', 'Acceleration', 'Stamina', 'Strength'];

  const statGroup2 = isGoalkeeper
    ? ['Control', 'Passing', 'Handling (GK)', 'Tackling']
    : ['Control', 'Passing', 'Shooting', 'Tackling'];

  // ‚úÖ Th√™m b·∫£ng vi·∫øt t·∫Øt
  const statShortLabels = {
    'Speed': 'SPE',
    'Acceleration': 'ACC',
    'Reactions (GK)': 'GKR',
    'Strength': 'STR',
    'Control': 'CON',
    'Passing': 'PAS',
    'Handling (GK)': 'GKH',
    'Tackling': 'TAC',
    'Stamina': 'STA',
    'Shooting': 'SHO'
  };

  // ‚úÖ C·∫≠p nh·∫≠t statRowHTML ƒë·ªÉ h·ªó tr·ª£ mobile
  const statRowHTML = group => {
    const isMobile = window.innerWidth <= 768;
    return `
      <div class="grid grid-cols-2 md:grid-cols-4 gap-2 mb-2">
        ${group.map(stat => {
          const value = player[stat] || '0';
          const isGKStat = stat.toLowerCase().includes('gk');
          const label = isMobile ? (statShortLabels[stat] || stat) : stat;
          return `
            <div class="stat-item ${isGKStat ? 'gk-stats' : ''}">
              <span class="stat-name">${label.replace('(GK)', '').trim()}</span>
              <span class="stat-value">${value}</span>
            </div>
          `;
        }).join('')}
      </div>
    `;
  };


      card.innerHTML = `
        <div class="player-rank ${getRankClass(rank)}">#${rank}</div>

        <div class="player-info-section">
          <div class="player-name">${name}</div>
          <div class="player-details">
            ${position ? `<div class="player-info">üìç ${position}</div>` : ''}
            ${country ? `<div class="player-info">üåç ${country}</div>` : ''}
            ${club ? `<div class="player-info">üèüÔ∏è ${club}</div>` : ''}
          </div>
        </div>

        <div class="stats-container">
          ${statRowHTML(statGroup1)}
          ${statRowHTML(statGroup2)}
        </div>
        
        <div class="flex flex-col items-center">
          <div class="rating-badge ${ratingClass}">
            ${rating}
          </div>
           ${price ? `<div class="player-info price">üí∞ ${price}${price.includes('M') ? '' : 'M'}</div>` : ''}
        </div>
      `;

      return card;
    }
  
    function buildTeam() {
      const priority = document.getElementById('buildPriority').value;
      const budget = parseFloat(document.getElementById('budgetLimit').value) || Infinity;
      const preferredCountry = document.getElementById('teamCountryFilter').value;
      const preferredClub = document.getElementById('teamClubFilter').value;
      const preferredContinent = document.getElementById('teamContinentFilter').value;

      const formation = formations[currentFormation];
      const team = [];
      let totalCost = 0;

      console.log('Building team with formation:', currentFormation, formation);

      // Flatten formation structure for easier processing
      const allPositions = [];
      formation.lines.forEach(line => {
        line.positions.forEach(pos => {
          allPositions.push(pos);
        });
      });

      console.log('All positions needed:', allPositions);

      for (const position of allPositions) {
        let positionPlayers;
        
        // Determine which players to search based on priority
 if ([
  'most-expensive-exact',
  'cheapest-exact'
].includes(priority)) {
  positionPlayers = getPlayersForExactPosition(position, preferredCountry, preferredClub, preferredContinent);
} else if ([
  'most-expensive-sub',
  'cheapest-sub'
].includes(priority)) {
  positionPlayers = getPlayersForPosition(position, preferredCountry, preferredClub, preferredContinent);
} else {
  positionPlayers = getPlayersForExactPosition(position, preferredCountry, preferredClub, preferredContinent);
}

        
switch (priority) {
  case 'most-expensive-sub':
  case 'most-expensive-exact':
    sortedPlayers = positionPlayers.sort((a, b) => parseFloat(b['Price'] || b['Value'] || '0') - parseFloat(a['Price'] || a['Value'] || '0'));
    break;

  case 'cheapest-sub':
  case 'cheapest-exact':
    sortedPlayers = positionPlayers.sort((a, b) => parseFloat(a['Price'] || a['Value'] || '0') - parseFloat(b['Price'] || b['Value'] || '0'));
    break;

  case 'tallest':
    sortedPlayers = positionPlayers.sort((a, b) => parseFloat(b['Height (cm)'] || '0') - parseFloat(a['Height (cm)'] || '0'));
    break;

  case 'shortest':
    sortedPlayers = positionPlayers.sort((a, b) => parseFloat(a['Height (cm)'] || '0') - parseFloat(b['Height (cm)'] || '0'));
    break;

case 'right-foot':
  sortedPlayers = positionPlayers
    .filter(p => (p['Foot'] || '').toLowerCase().includes('right'))
    .sort((a, b) => parseFloat(b['Price'] || b['Value'] || '0') - parseFloat(a['Price'] || a['Value'] || '0'));
  break;

case 'left-foot':
  sortedPlayers = positionPlayers
    .filter(p => (p['Foot'] || '').toLowerCase().includes('left'))
    .sort((a, b) => parseFloat(b['Price'] || b['Value'] || '0') - parseFloat(a['Price'] || a['Value'] || '0'));
  break;

case 'both-feet':
  sortedPlayers = positionPlayers
    .filter(p => (p['Foot'] || '').toLowerCase().includes('both'))
    .sort((a, b) => parseFloat(b['Price'] || b['Value'] || '0') - parseFloat(a['Price'] || a['Value'] || '0'));
  break;

  default:
    sortedPlayers = positionPlayers.sort((a, b) => {
      const ratingA = parseFloat(a[ratingField] || '0');
      const ratingB = parseFloat(b[ratingField] || '0');
      return ratingB - ratingA;
    });
}


        let selectedPlayer = null;
        
        for (const player of sortedPlayers) {
          const playerCost = parseFloat(player['Price'] || player['Value'] || '0');
          
          // Check if player is already selected
          if (team.some(p => p[Object.keys(player)[0]] === player[Object.keys(player)[0]])) {
            continue;
          }

          if (totalCost + playerCost <= budget) {
            selectedPlayer = { ...player, assignedPosition: position };
            totalCost += playerCost;
            break;
          }
        }

        if (selectedPlayer) {
          team.push(selectedPlayer);
          console.log(`Selected player for ${position}:`, selectedPlayer[Object.keys(selectedPlayer)[0]]);
        } else {
          // Fallback: find cheapest available player for this position
          const cheapestPlayer = sortedPlayers.find(p => 
            !team.some(tp => tp[Object.keys(p)[0]] === p[Object.keys(p)[0]])
          );
          if (cheapestPlayer) {
            const playerCost = parseFloat(cheapestPlayer['Price'] || cheapestPlayer['Value'] || '0');
            const fallbackPlayer = { ...cheapestPlayer, assignedPosition: position };
            team.push(fallbackPlayer);
            totalCost += playerCost;
            console.log(`Selected fallback player for ${position}:`, cheapestPlayer[Object.keys(cheapestPlayer)[0]]);
          } else {
            console.log(`No player found for position: ${position}`);
          }
        }
      }

      console.log('Final team:', team);
      console.log('Team positions:', team.map(p => ({ name: p[Object.keys(p)[0]], position: p.assignedPosition })));
      
      builtTeam = team;
      displayBuiltTeam();
      updateTeamStats();
      displayFormation();
    }

function displayFormation() {
  formationDisplay.classList.remove('hidden');
  formationField.innerHTML = '';
  document.getElementById('currentFormationTitle').textContent = currentFormation;

  const formation = formations[currentFormation];
  
  const positionCounter = {};
  
  formation.lines.forEach((line, lineIndex) => {
    const formationLine = document.createElement('div');
    formationLine.className = `formation-line ${line.line}`;
    
    line.positions.forEach((position, posIndex) => {
      if (!positionCounter[position]) {
        positionCounter[position] = 0;
      }
      
      const playersInPosition = builtTeam.filter(p => p.assignedPosition === position);
      const player = playersInPosition[positionCounter[position]];
      positionCounter[position]++;
      
      const playerPos = document.createElement('div');
      playerPos.className = `player-position ${player ? 'filled' : ''}`;
      
      if (player) {
        const name = player[Object.keys(player)[0]] || 'Unknown';
        const shortName = name.length > 8 ? 
          (name.split(' ').length > 1 ? name.split(' ').pop() : name.substring(0, 8)) : 
          name;
        
        playerPos.innerHTML = `
          <div class="name">${shortName}</div>
        `;
        playerPos.addEventListener('click', () => {
          displayPlayerDetails(player);
          document.querySelectorAll('.player-position').forEach(p => p.classList.remove('selected'));
          playerPos.classList.add('selected');
        });
        
        console.log(`Hi·ªÉn th·ªã ${name} (${shortName}) t·∫°i v·ªã tr√≠ ${position} (l·∫ßn xu·∫•t hi·ªán ${positionCounter[position]-1})`);
      } else {
        playerPos.innerHTML = `
          <div class="position-label">${position}</div>
        `;
        console.log(`V·ªã tr√≠ tr·ªëng: ${position} (l·∫ßn xu·∫•t hi·ªán ${positionCounter[position]-1})`);
      }
      
      formationLine.appendChild(playerPos);
    });
    
    formationField.appendChild(formationLine);
  });
  
  console.log('Ho√†n t·∫•t hi·ªÉn th·ªã ƒë·ªôi h√¨nh. ƒê·ªôi ƒë√£ x√¢y:', builtTeam.map(p => ({ 
    name: p[Object.keys(p)[0]], 
    position: p.assignedPosition 
  })));
}

function displayPlayerDetails(player) {
  builtTeamDiv.innerHTML = '';
  builtTeamDiv.classList.remove('hidden');
  builtTeamDiv.classList.add('show');
  document.getElementById('builtTeamOverlay').classList.add('show');

  const closeBtn = document.createElement('button');
  closeBtn.className = 'close-btn';
  closeBtn.innerHTML = '√ó';
  closeBtn.onclick = closePlayerDetails;
  builtTeamDiv.appendChild(closeBtn);

  const playerDetailCard = document.createElement('div');
  playerDetailCard.className = 'player-detail-card';
  
  const flagBackground = document.createElement('div');
  flagBackground.className = 'flag-background';
  const playerImageUrl = player['Img player'] || 'https://via.placeholder.com/300x400?text=No+Image'; // L·∫•y tr·ª±c ti·∫øp t·ª´ Sheet
  flagBackground.style.backgroundImage = `url('${playerImageUrl}')`;
  playerDetailCard.appendChild(flagBackground);

  const playerOverlay = document.createElement('div');
  playerOverlay.className = 'player-overlay';

  const overallRating = document.createElement('div');
  overallRating.className = 'overall-rating';
  const ratingField = getRatingField();
  overallRating.textContent = player[ratingField] || '83';
  playerOverlay.appendChild(overallRating);

  const heightFoot = document.createElement('div');
  heightFoot.className = 'player-detail-info height-foot';
  const nationality = player['Nationality'] || 'Unknown';
  const flagUrl = countryMap[nationality.toLowerCase()] || 'https://via.placeholder.com/16/000000/FFFFFF?text=?';
  heightFoot.innerHTML = `
    <img src="${flagUrl}" alt="${nationality} Flag" class="flag-icon" onerror="this.src='https://via.placeholder.com/16/000000/FFFFFF?text=?'">
    <div class="height-foot-column">
      <div alt="Height"> ${player['Height (cm)'] || '186'}cm</div>
      <div alt="Foot"> ${player['Foot'] || 'R'}</div>
    </div>
  `;
  playerOverlay.appendChild(heightFoot);

  const position = document.createElement('div');
  position.className = 'player-detail-info position';
  position.style.backgroundColor = '#000';
  position.style.color = '#fff';
  position.style.padding = '2px 6px';
  position.textContent = player['Position'] || 'CM';
  playerOverlay.appendChild(position);

  const stats = document.createElement('div');
  stats.className = 'player-stat-container';
const isGoalkeeper = (player['Position'] || '').toUpperCase().trim() === 'GK';
  const statShortLabels = {
    'Speed': 'SPE',
    'Acceleration': 'ACC',
    'Reactions (GK)': 'GKR',
    'Strength': 'STR',
    'Control': 'CON',
    'Passing': 'PAS',
    'Handling (GK)': 'GKH',
    'Tackling': 'TAC',
    'Stamina': 'STA',
    'Shooting': 'SHO'
  };
  const statsToShow = {
    [statShortLabels['Speed']]: player['Speed'] || '76',
    [statShortLabels['Acceleration']]: player['Acceleration'] || '77',
    [isGoalkeeper ? statShortLabels['Reactions (GK)'] : statShortLabels['Stamina']]: isGoalkeeper ? (player['Reactions (GK)'] || '85') : (player['Stamina'] || '85'),
    [statShortLabels['Strength']]: player['Strength'] || '75',
    [statShortLabels['Control']]: player['Control'] || '86',
    [statShortLabels['Passing']]: player['Passing'] || '82',
    [isGoalkeeper ? statShortLabels['Handling (GK)'] : statShortLabels['Shooting']]: isGoalkeeper ? (player['Handling (GK)'] || '79') : (player['Shooting'] || '79'),
    [statShortLabels['Tackling']]: player['Tackling'] || '78'
  };
  for (const [stat, value] of Object.entries(statsToShow)) {
    const statItem = document.createElement('div');
    statItem.className = 'player-stat-item';
    statItem.innerHTML = `${stat} <span class="player-stat-value">${value}</span>`;
    stats.appendChild(statItem);
  }
  playerOverlay.appendChild(stats);

  const playerNameDiv = document.createElement('div');
  playerNameDiv.className = 'player-info-name';
  playerNameDiv.textContent = player['Name'] || 'Unknown';
  playerOverlay.appendChild(playerNameDiv);

  playerDetailCard.appendChild(playerOverlay);
  builtTeamDiv.appendChild(playerDetailCard);
}

function closePlayerDetails() {
  builtTeamDiv.classList.remove('show');
  builtTeamDiv.classList.add('hidden');
  document.getElementById('builtTeamOverlay').classList.remove('show');
  document.querySelectorAll('.player-position').forEach(p => p.classList.remove('selected'));
  // Kh√¥i ph·ª•c th√¥ng b√°o m·∫∑c ƒë·ªãnh
  displayBuiltTeam();
}
  
    function getPlayersForExactPosition(position, preferredCountry, preferredClub, preferredContinent) {
      // Only find players with exact position match
      const filteredPlayers = allPlayers.filter(player => {
        const playerPos = (player['Position'] || player['Pos'] || '').toUpperCase();
        const playerCountry = player['Nationality'] || player['Country'] || '';
        const playerClub = player['Club'] || '';
        const playerContinent = player['Continent'] || '';
        
        // Check if player position exactly matches the target position
        const positionMatch = playerPos.includes(position.toUpperCase());
        
        // Check other criteria
        const countryMatch = !preferredCountry || playerCountry === preferredCountry;
        const clubMatch = !preferredClub || playerClub === preferredClub;
        const continentMatch = !preferredContinent || playerContinent === preferredContinent;
        
        return positionMatch && countryMatch && clubMatch && continentMatch;
      });
      
      console.log(`Found ${filteredPlayers.length} exact players for position ${position}`);
      return filteredPlayers;
    }
  
    function getPlayersForPosition(position, preferredCountry, preferredClub, preferredContinent) {
      // Use the substitution rules to find suitable players
      const searchPositions = positionSubstitutions[position.toUpperCase()] || [position];
      
      const filteredPlayers = allPlayers.filter(player => {
        const playerPos = (player['Position'] || player['Pos'] || '').toUpperCase();
        const playerCountry = player['Nationality'] || player['Country'] || '';
        const playerClub = player['Club'] || '';
        const playerContinent = player['Continent'] || '';
        
        // Check if player position matches any of the search positions
        const positionMatch = searchPositions.some(searchPos => 
          playerPos.includes(searchPos)
        );
        
        // Check other criteria
        const countryMatch = !preferredCountry || playerCountry === preferredCountry;
        const clubMatch = !preferredClub || playerClub === preferredClub;
        const continentMatch = !preferredContinent || playerContinent === preferredContinent;
        
        return positionMatch && countryMatch && clubMatch && continentMatch;
      });
      
      // Sort by position priority (exact match first)
      filteredPlayers.sort((a, b) => {
        const posA = (a['Position'] || a['Pos'] || '').toUpperCase();
        const posB = (b['Position'] || b['Pos'] || '').toUpperCase();
        const targetPos = position.toUpperCase();
        
        // Exact match gets highest priority
        if (posA.includes(targetPos) && !posB.includes(targetPos)) return -1;
        if (!posA.includes(targetPos) && posB.includes(targetPos)) return 1;
        
        return 0;
      });
      
      console.log(`Found ${filteredPlayers.length} players for position ${position} (with substitutions)`);
      return filteredPlayers;
    }
  
    function getRatingField() {
      const headers = Object.keys(allPlayers[0] || {});
      return headers.find(h => h.toLowerCase().includes('rating') || h.toLowerCase().includes('ovr')) || headers[1];
    }
  
function displayBuiltTeam() {
  builtTeamDiv.innerHTML = '';
  builtTeamDiv.classList.remove('show');
  builtTeamDiv.classList.add('hidden');
  document.getElementById('builtTeamOverlay').classList.remove('show');

  if (builtTeam.length === 0) {
    builtTeamDiv.classList.remove('hidden');
    builtTeamDiv.innerHTML = `
      <div class="no-results">
        <div class="no-results-icon">‚ö†Ô∏è</div>
        <h3 class="text-2xl font-bold mb-3">Kh√¥ng th·ªÉ x√¢y d·ª±ng ƒë·ªôi</h3>
        <p class="text-lg">Kh√¥ng th·ªÉ x√¢y d·ª±ng ƒë·ªôi v·ªõi ti√™u ch√≠ hi·ªán t·∫°i</p>
      </div>
    `;
    return;
  }

  builtTeamDiv.classList.remove('hidden');
  builtTeamDiv.innerHTML = `
    <div class="no-results">
      <h3 class="text-2xl font-bold mb-3 text-white">ƒê·ªôi h√¨nh ${currentFormation} c·ªßa b·∫°n</h3>
      <p class="text-lg">Nh·∫•p v√†o m·ªôt c·∫ßu th·ªß trong s∆° ƒë·ªì ƒë·ªôi h√¨nh ƒë·ªÉ xem chi ti·∫øt.</p>
    </div>
  `;
}

  // Hi·ªÉn th·ªã th√¥ng b√°o m·∫∑c ƒë·ªãnh sau khi x√¢y d·ª±ng ƒë·ªôi
  builtTeamDiv.innerHTML = `
    <div class="no-results">
      <h3 class="text-2xl font-bold mb-3 text-white">ƒê·ªôi h√¨nh ${currentFormation} c·ªßa b·∫°n</h3>
      <p class="text-lg">Nh·∫•p v√†o m·ªôt c·∫ßu th·ªß trong s∆° ƒë·ªì ƒë·ªôi h√¨nh ƒë·ªÉ xem chi ti·∫øt.</p>
    </div>
  `;

  
    function updateTeamStats() {
      if (builtTeam.length === 0) {
        teamStats.classList.add('hidden');
        return;
      }

      function resetTeamBuilder() {
  // Reset built team
  builtTeam = [];
  
  // Hide formation display
  formationDisplay.classList.add('hidden');
  
  // Hide built team display
  builtTeamDiv.classList.add('hidden');
  builtTeamDiv.innerHTML = '';
  
  // Hide team stats
  teamStats.classList.add('hidden');
  
  // Reset formation to default
  currentFormation = '4-3-3';
  
  // Reset formation buttons to default state
  document.querySelectorAll('.formation-btn').forEach(btn => {
    btn.classList.remove('active');
    if (btn.textContent === '4-3-3') {
      btn.classList.add('active');
    }
  });
  
  // Update formation variants
  updateFormationVariants('4-3-3');
  
  console.log('Team builder reset completed');
}


      teamStats.classList.remove('hidden');

      const ratingField = getRatingField();
      const ratings = builtTeam.map(p => parseFloat(p[ratingField] || '0'));
      const costs = builtTeam.map(p => parseFloat(p['Price'] || p['Value'] || '0'));
      const countries = [...new Set(builtTeam.map(p => p['Nationality'] || p['Country']).filter(c => c))];
      const clubs = [...new Set(builtTeam.map(p => p['Club']).filter(c => c))];

      const avgRating = ratings.reduce((a, b) => a + b, 0) / ratings.length;
      const totalCost = costs.reduce((a, b) => a + b, 0);

      document.getElementById('teamRating').textContent = avgRating.toFixed(1);
      document.getElementById('teamCost').textContent = totalCost.toFixed(0) + 'M';
      document.getElementById('teamCountries').textContent = countries.length;
      document.getElementById('teamClubs').textContent = clubs.length;
    }
  
    function showContent() {
      loading.classList.add('hidden');
      error.classList.add('hidden');
      playersGrid.classList.remove('hidden');
    }
  
    function showError() {
      loading.classList.add('hidden');
      error.classList.remove('hidden');
      playersGrid.classList.add('hidden');
    }
  
    // Event listeners
    searchInput.addEventListener('input', applyFilters);
    countryFilter.addEventListener('input', applyFilters);
    priceFilter.addEventListener('change', applyFilters);
    document.getElementById('positionFilter').addEventListener('change', applyFilters);
    document.getElementById('sortFilter').addEventListener('change', applyFilters);
    
    clearFilters.addEventListener('click', () => {
      searchInput.value = '';
      countryFilter.value = '';
      priceFilter.value = '';
      document.getElementById('positionFilter').value = '';
      document.getElementById('sortFilter').value = 'rating-high';
      applyFilters();
    });

    buildTeamBtn.addEventListener('click', buildTeam);
  
    // Initialize with 4-3-3 and show formation immediately
    window.onload = () => {
      loadData();
      updateFormationVariants('4-3-3');
    };
  </script>
</body>
</html>
